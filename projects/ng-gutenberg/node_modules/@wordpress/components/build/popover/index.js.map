{"version":3,"sources":["@wordpress/components/src/popover/index.js"],"names":["FocusManaged","children","SLOT_NAME","useThrottledWindowScrollOrResize","handler","ignoredScrollableRef","refreshHandle","throttledRefresh","event","window","cancelAnimationFrame","type","current","contains","target","requestAnimationFrame","addEventListener","removeEventListener","useAnchor","anchorRef","contentRef","anchorRect","getAnchorRect","anchor","setAnchor","refreshAnchorRect","newAnchor","rect","parentNode","getBoundingClientRect","getComputedStyle","paddingTop","paddingBottom","topPad","parseInt","bottomPad","x","left","y","top","width","height","right","bottom","didAnchorRectChange","intervalHandle","setInterval","clearInterval","useInitialContentSize","ref","contentSize","setContentSize","contentRect","usePopoverPosition","position","expandOnMobile","popoverLeft","popoverTop","yAxis","xAxis","contentHeight","contentWidth","isMobile","popoverPosition","setPopoverPosition","refreshPopoverPosition","newPopoverPosition","useFocusContentOnMount","focusOnMount","focusTimeout","setTimeout","firstTabbable","focus","tabbable","find","clearTimeout","Popover","headerTitle","onClose","onKeyDown","className","noArrow","range","animate","onClickOutside","onFocusOutside","contentProps","isReadyToAnimate","setIsReadyToAnimate","maybeClose","keyCode","ESCAPE","stopPropagation","handleOnFocusOutside","clickEvent","MouseEvent","error","document","createEvent","initMouseEvent","Object","defineProperty","get","relatedTarget","alternative","yAxisMapping","xAxisMapping","animateYAxis","animateXAxis","classes","content","origin","animateClassName","undefined","visibility","maxHeight","maxWidth","getSlot","PopoverContainer","Slot"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { useRef, useState, useEffect } from '@wordpress/element';\nimport { focus } from '@wordpress/dom';\nimport { ESCAPE } from '@wordpress/keycodes';\nimport isShallowEqual from '@wordpress/is-shallow-equal';\nimport deprecated from '@wordpress/deprecated';\n\n/**\n * Internal dependencies\n */\nimport { computePopoverPosition } from './utils';\nimport withFocusReturn from '../higher-order/with-focus-return';\nimport withConstrainedTabbing from '../higher-order/with-constrained-tabbing';\nimport PopoverDetectOutside from './detect-outside';\nimport IconButton from '../icon-button';\nimport ScrollLock from '../scroll-lock';\nimport IsolatedEventContainer from '../isolated-event-container';\nimport { Slot, Fill, Consumer } from '../slot-fill';\nimport Animate from '../animate';\n\nconst FocusManaged = withConstrainedTabbing( withFocusReturn( ( { children } ) => children ) );\n\n/**\n * Name of slot in which popover should fill.\n *\n * @type {string}\n */\nconst SLOT_NAME = 'Popover';\n\n/**\n * Hook used trigger an event handler once the window is resized or scrolled.\n *\n * @param {Function} handler              Event handler.\n * @param {Object}   ignoredScrollableRef scroll events inside this element are ignored.\n */\nfunction useThrottledWindowScrollOrResize( handler, ignoredScrollableRef ) {\n\t// Refresh anchor rect on resize\n\tuseEffect( () => {\n\t\tlet refreshHandle;\n\t\tconst throttledRefresh = ( event ) => {\n\t\t\twindow.cancelAnimationFrame( refreshHandle );\n\t\t\tif ( ignoredScrollableRef && event && event.type === 'scroll' && ignoredScrollableRef.current.contains( event.target ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\trefreshHandle = window.requestAnimationFrame( handler );\n\t\t};\n\n\t\twindow.addEventListener( 'resize', throttledRefresh );\n\t\twindow.addEventListener( 'scroll', throttledRefresh, true );\n\n\t\treturn () => {\n\t\t\twindow.removeEventListener( 'resize', throttledRefresh );\n\t\t\twindow.removeEventListener( 'scroll', throttledRefresh, true );\n\t\t};\n\t}, [] );\n}\n\n/**\n * Hook used to compute and update the anchor position properly.\n *\n * @param {Object} anchorRef       reference to the popover anchor element.\n * @param {Object} contentRef      reference to the popover content element.\n * @param {Object} anchorRect      anchor Rect prop used to override the computed value.\n * @param {Function} getAnchorRect function used to override the anchor value computation algorithm.\n *\n * @return {Object} Anchor position.\n */\nfunction useAnchor( anchorRef, contentRef, anchorRect, getAnchorRect ) {\n\tconst [ anchor, setAnchor ] = useState( null );\n\tconst refreshAnchorRect = () => {\n\t\tif ( ! anchorRef.current ) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet newAnchor;\n\t\tif ( anchorRect ) {\n\t\t\tnewAnchor = anchorRect;\n\t\t} else if ( getAnchorRect ) {\n\t\t\tnewAnchor = getAnchorRect( anchorRef.current );\n\t\t} else {\n\t\t\tconst rect = anchorRef.current.parentNode.getBoundingClientRect();\n\t\t\t// subtract padding\n\t\t\tconst { paddingTop, paddingBottom } = window.getComputedStyle( anchorRef.current.parentNode );\n\t\t\tconst topPad = parseInt( paddingTop, 10 );\n\t\t\tconst bottomPad = parseInt( paddingBottom, 10 );\n\t\t\tnewAnchor = {\n\t\t\t\tx: rect.left,\n\t\t\t\ty: rect.top + topPad,\n\t\t\t\twidth: rect.width,\n\t\t\t\theight: rect.height - topPad - bottomPad,\n\t\t\t\tleft: rect.left,\n\t\t\t\tright: rect.right,\n\t\t\t\ttop: rect.top + topPad,\n\t\t\t\tbottom: rect.bottom - bottomPad,\n\t\t\t};\n\t\t}\n\n\t\tconst didAnchorRectChange = ! isShallowEqual( newAnchor, anchor );\n\t\tif ( didAnchorRectChange ) {\n\t\t\tsetAnchor( newAnchor );\n\t\t}\n\t};\n\tuseEffect( refreshAnchorRect, [ anchorRect, getAnchorRect ] );\n\tuseEffect( () => {\n\t\tif ( ! anchorRect ) {\n\t\t\t/*\n\t\t\t* There are sometimes we need to reposition or resize the popover that are not\n\t\t\t* handled by the resize/scroll window events (i.e. CSS changes in the layout\n\t\t\t* that changes the position of the anchor).\n\t\t\t*\n\t\t\t* For these situations, we refresh the popover every 0.5s\n\t\t\t*/\n\t\t\tconst intervalHandle = setInterval( refreshAnchorRect, 500 );\n\n\t\t\treturn () => clearInterval( intervalHandle );\n\t\t}\n\t}, [ anchorRect ] );\n\n\tuseThrottledWindowScrollOrResize( refreshAnchorRect, contentRef );\n\n\treturn anchor;\n}\n\n/**\n * Hook used to compute the initial size of an element.\n * The popover applies styling to limit the height of the element,\n * we only care about the initial size.\n *\n * @param {Object} ref Reference to the popover content element.\n *\n * @return {Object} Content size.\n */\nfunction useInitialContentSize( ref ) {\n\tconst [ contentSize, setContentSize ] = useState( null );\n\tuseEffect( () => {\n\t\tconst contentRect = ref.current.getBoundingClientRect();\n\t\tsetContentSize( {\n\t\t\twidth: contentRect.width,\n\t\t\theight: contentRect.height,\n\t\t} );\n\t}, [] );\n\n\treturn contentSize;\n}\n\n/**\n * Hook used to compute and update the position of the popover\n * based on the anchor position and the content size.\n *\n * @param {Object} anchor          Anchor Position.\n * @param {Object} contentSize     Content Size.\n * @param {string} position        Position prop.\n * @param {boolean} expandOnMobile Whether to show the popover full width on mobile.\n * @param {Object} contentRef      Reference to the popover content element.\n *\n * @return {Object} Popover position.\n */\nfunction usePopoverPosition( anchor, contentSize, position, expandOnMobile, contentRef ) {\n\tconst [ popoverPosition, setPopoverPosition ] = useState( {\n\t\tpopoverLeft: null,\n\t\tpopoverTop: null,\n\t\tyAxis: 'top',\n\t\txAxis: 'center',\n\t\tcontentHeight: null,\n\t\tcontentWidth: null,\n\t\tisMobile: false,\n\t} );\n\tconst refreshPopoverPosition = () => {\n\t\tif ( ! anchor || ! contentSize ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst newPopoverPosition = computePopoverPosition(\n\t\t\tanchor,\n\t\t\tcontentSize,\n\t\t\tposition,\n\t\t\texpandOnMobile\n\t\t);\n\n\t\tif (\n\t\t\tpopoverPosition.yAxis !== newPopoverPosition.yAxis ||\n\t\t\tpopoverPosition.xAxis !== newPopoverPosition.xAxis ||\n\t\t\tpopoverPosition.popoverLeft !== newPopoverPosition.popoverLeft ||\n\t\t\tpopoverPosition.popoverTop !== newPopoverPosition.popoverTop ||\n\t\t\tpopoverPosition.contentHeight !== newPopoverPosition.contentHeight ||\n\t\t\tpopoverPosition.contentWidth !== newPopoverPosition.contentWidth ||\n\t\t\tpopoverPosition.isMobile !== newPopoverPosition.isMobile\n\t\t) {\n\t\t\tsetPopoverPosition( newPopoverPosition );\n\t\t}\n\t};\n\tuseEffect( refreshPopoverPosition, [ anchor, contentSize ] );\n\tuseThrottledWindowScrollOrResize( refreshPopoverPosition, contentRef );\n\n\treturn popoverPosition;\n}\n\n/**\n * Hook used to focus the first tabbable element on mount.\n *\n * @param {boolean|string} focusOnMount Focus on mount mode.\n * @param {Object} contentRef           Reference to the popover content element.\n */\nfunction useFocusContentOnMount( focusOnMount, contentRef ) {\n\t// Focus handling\n\tuseEffect( () => {\n\t\t/*\n\t\t * Without the setTimeout, the dom node is not being focused. Related:\n\t\t * https://stackoverflow.com/questions/35522220/react-ref-with-focus-doesnt-work-without-settimeout-my-example\n\t\t *\n\t\t * TODO: Treat the cause, not the symptom.\n\t\t */\n\t\tconst focusTimeout = setTimeout( () => {\n\t\t\tif ( ! focusOnMount || ! contentRef.current ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( focusOnMount === 'firstElement' ) {\n\t\t\t// Find first tabbable node within content and shift focus, falling\n\t\t\t// back to the popover panel itself.\n\t\t\t\tconst firstTabbable = focus.tabbable.find( contentRef.current )[ 0 ];\n\t\t\t\tif ( firstTabbable ) {\n\t\t\t\t\tfirstTabbable.focus();\n\t\t\t\t} else {\n\t\t\t\t\tcontentRef.current.focus();\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( focusOnMount === 'container' ) {\n\t\t\t// Focus the popover panel itself so items in the popover are easily\n\t\t\t// accessed via keyboard navigation.\n\t\t\t\tcontentRef.current.focus();\n\t\t\t}\n\t\t}, 0 );\n\n\t\treturn () => clearTimeout( focusTimeout );\n\t}, [] );\n}\n\nconst Popover = ( {\n\theaderTitle,\n\tonClose,\n\tonKeyDown,\n\tchildren,\n\tclassName,\n\tnoArrow = false,\n\t// Disable reason: We generate the `...contentProps` rest as remainder\n\t// of props which aren't explicitly handled by this component.\n\t/* eslint-disable no-unused-vars */\n\tposition = 'top',\n\trange,\n\tfocusOnMount = 'firstElement',\n\tanchorRect,\n\tgetAnchorRect,\n\texpandOnMobile,\n\tanimate = true,\n\tonClickOutside,\n\tonFocusOutside,\n\t/* eslint-enable no-unused-vars */\n\t...contentProps\n} ) => {\n\tconst anchorRef = useRef( null );\n\tconst contentRef = useRef( null );\n\n\t// Animation\n\tconst [ isReadyToAnimate, setIsReadyToAnimate ] = useState( false );\n\n\t// Anchor position\n\tconst anchor = useAnchor( anchorRef, contentRef, anchorRect, getAnchorRect );\n\n\t// Content size\n\tconst contentSize = useInitialContentSize( contentRef );\n\tuseEffect( () => {\n\t\tif ( contentSize ) {\n\t\t\tsetIsReadyToAnimate( true );\n\t\t}\n\t}, [ contentSize ] );\n\n\t// Compute the position\n\tconst popoverPosition = usePopoverPosition(\n\t\tanchor,\n\t\tcontentSize,\n\t\tposition,\n\t\texpandOnMobile,\n\t\tcontentRef\n\t);\n\n\tuseFocusContentOnMount( focusOnMount, contentRef );\n\n\t// Event handlers\n\tconst maybeClose = ( event ) => {\n\t\t// Close on escape\n\t\tif ( event.keyCode === ESCAPE && onClose ) {\n\t\t\tevent.stopPropagation();\n\t\t\tonClose();\n\t\t}\n\n\t\t// Preserve original content prop behavior\n\t\tif ( onKeyDown ) {\n\t\t\tonKeyDown( event );\n\t\t}\n\t};\n\n\t/**\n\t * Shims an onFocusOutside callback to be compatible with a deprecated\n\t * onClickOutside prop function, if provided.\n\t *\n\t * @param {FocusEvent} event Focus event from onFocusOutside.\n\t */\n\tfunction handleOnFocusOutside( event ) {\n\t\t// Defer to given `onFocusOutside` if specified. Call `onClose` only if\n\t\t// both `onFocusOutside` and `onClickOutside` are unspecified. Doing so\n\t\t// assures backwards-compatibility for prior `onClickOutside` default.\n\t\tif ( onFocusOutside ) {\n\t\t\tonFocusOutside( event );\n\t\t\treturn;\n\t\t} else if ( ! onClickOutside ) {\n\t\t\tif ( onClose ) {\n\t\t\t\tonClose();\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\t// Simulate MouseEvent using FocusEvent#relatedTarget as emulated click\n\t\t// target. MouseEvent constructor is unsupported in Internet Explorer.\n\t\tlet clickEvent;\n\t\ttry {\n\t\t\tclickEvent = new window.MouseEvent( 'click' );\n\t\t} catch ( error ) {\n\t\t\tclickEvent = document.createEvent( 'MouseEvent' );\n\t\t\tclickEvent.initMouseEvent( 'click', true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null );\n\t\t}\n\n\t\tObject.defineProperty( clickEvent, 'target', {\n\t\t\tget: () => event.relatedTarget,\n\t\t} );\n\n\t\tdeprecated( 'Popover onClickOutside prop', {\n\t\t\talternative: 'onFocusOutside',\n\t\t} );\n\n\t\tonClickOutside( clickEvent );\n\t}\n\n\t// Compute the animation position\n\tconst yAxisMapping = {\n\t\ttop: 'bottom',\n\t\tbottom: 'top',\n\t};\n\tconst xAxisMapping = {\n\t\tleft: 'right',\n\t\tright: 'left',\n\t};\n\tconst animateYAxis = yAxisMapping[ popoverPosition.yAxis ] || 'middle';\n\tconst animateXAxis = xAxisMapping[ popoverPosition.xAxis ] || 'center';\n\n\tconst classes = classnames(\n\t\t'components-popover',\n\t\tclassName,\n\t\t'is-' + popoverPosition.yAxis,\n\t\t'is-' + popoverPosition.xAxis,\n\t\t{\n\t\t\t'is-mobile': popoverPosition.isMobile,\n\t\t\t'is-without-arrow': noArrow || (\n\t\t\t\tpopoverPosition.xAxis === 'center' &&\n\t\t\t\tpopoverPosition.yAxis === 'middle'\n\t\t\t),\n\t\t}\n\t);\n\n\t// Disable reason: We care to capture the _bubbled_ events from inputs\n\t// within popover as inferring close intent.\n\n\tlet content = (\n\t\t<PopoverDetectOutside onFocusOutside={ handleOnFocusOutside }>\n\t\t\t<Animate\n\t\t\t\ttype={ animate && isReadyToAnimate ? 'appear' : null }\n\t\t\t\toptions={ { origin: animateYAxis + ' ' + animateXAxis } }\n\t\t\t>\n\t\t\t\t{ ( { className: animateClassName } ) => (\n\t\t\t\t\t<IsolatedEventContainer\n\t\t\t\t\t\tclassName={ classnames( classes, animateClassName ) }\n\t\t\t\t\t\tstyle={ {\n\t\t\t\t\t\t\ttop: ! popoverPosition.isMobile && popoverPosition.popoverTop ? popoverPosition.popoverTop + 'px' : undefined,\n\t\t\t\t\t\t\tleft: ! popoverPosition.isMobile && popoverPosition.popoverLeft ? popoverPosition.popoverLeft + 'px' : undefined,\n\t\t\t\t\t\t\tvisibility: contentSize ? undefined : 'hidden',\n\t\t\t\t\t\t} }\n\t\t\t\t\t\t{ ...contentProps }\n\t\t\t\t\t\tonKeyDown={ maybeClose }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ popoverPosition.isMobile && (\n\t\t\t\t\t\t\t<div className=\"components-popover__header\">\n\t\t\t\t\t\t\t\t<span className=\"components-popover__header-title\">\n\t\t\t\t\t\t\t\t\t{ headerTitle }\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<IconButton className=\"components-popover__close\" icon=\"no-alt\" onClick={ onClose } />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t) }\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tref={ contentRef }\n\t\t\t\t\t\t\tclassName=\"components-popover__content\"\n\t\t\t\t\t\t\tstyle={ {\n\t\t\t\t\t\t\t\tmaxHeight: ! popoverPosition.isMobile && popoverPosition.contentHeight ? popoverPosition.contentHeight + 'px' : undefined,\n\t\t\t\t\t\t\t\tmaxWidth: ! popoverPosition.isMobile && popoverPosition.contentWidth ? popoverPosition.contentWidth + 'px' : undefined,\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\ttabIndex=\"-1\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{ children }\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</IsolatedEventContainer>\n\t\t\t\t) }\n\t\t\t</Animate>\n\t\t</PopoverDetectOutside>\n\t);\n\n\t// Apply focus to element as long as focusOnMount is truthy; false is\n\t// the only \"disabled\" value.\n\tif ( focusOnMount ) {\n\t\tcontent = <FocusManaged>{ content }</FocusManaged>;\n\t}\n\n\treturn (\n\t\t<Consumer>\n\t\t\t{ ( { getSlot } ) => {\n\t\t\t\t// In case there is no slot context in which to render,\n\t\t\t\t// default to an in-place rendering.\n\t\t\t\tif ( getSlot && getSlot( SLOT_NAME ) ) {\n\t\t\t\t\tcontent = <Fill name={ SLOT_NAME }>{ content }</Fill>;\n\t\t\t\t}\n\n\t\t\t\treturn (\n\t\t\t\t\t<span ref={ anchorRef }>\n\t\t\t\t\t\t{ content }\n\t\t\t\t\t\t{ popoverPosition.isMobile && expandOnMobile && <ScrollLock /> }\n\t\t\t\t\t</span>\n\t\t\t\t);\n\t\t\t} }\n\t\t</Consumer>\n\t);\n};\n\nconst PopoverContainer = Popover;\n\nPopoverContainer.Slot = () => <Slot bubblesVirtually name={ SLOT_NAME } />;\n\nexport default PopoverContainer;\n"]}