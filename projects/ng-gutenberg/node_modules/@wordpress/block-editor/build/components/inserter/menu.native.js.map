{"version":3,"sources":["@wordpress/block-editor/src/components/inserter/menu.native.js"],"names":["InserterMenu","subscriptionParentMediaAppend","payload","props","onSelect","name","mediaType","initialAttributes","id","mediaId","mediaUrl","onOpen","remove","onClose","bottomSheetWidth","BottomSheet","getWidth","styles","modalItem","itemPaddingLeft","paddingLeft","itemPaddingRight","paddingRight","content","containerPaddingLeft","containerPaddingRight","itemWidth","modalIconWrapper","width","itemTotalWidth","containerTotalWidth","Math","floor","showInsertionPoint","hideInsertionPoint","numberOfColumns","calculateNumberOfColumns","bottomPadding","contentBottomPadding","onDismiss","items","rowSeparator","item","touchableArea","title","modalIcon","icon","src","fill","modalItemLabel","Component","select","clientId","isAppender","rootClientId","getInserterItems","getBlockName","getBlockRootClientId","getBlockSelectionEnd","getChildBlockNames","destinationRootClientId","end","undefined","destinationRootBlockName","rootChildBlocks","dispatch","ownProps","getInsertionIndex","getBlock","getBlockIndex","getBlockOrder","isPostTitleSelected","length","index","replaceBlocks","insertBlock","getSelectedBlock","selectedBlock","insertedBlock","withInstanceId"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { FlatList, View, Text, TouchableHighlight } from 'react-native';\nimport { subscribeMediaAppend } from 'react-native-gutenberg-bridge';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport {\n\tcreateBlock,\n\tisUnmodifiedDefaultBlock,\n} from '@wordpress/blocks';\nimport { withDispatch, withSelect } from '@wordpress/data';\nimport { withInstanceId, compose } from '@wordpress/compose';\nimport { BottomSheet, Icon } from '@wordpress/components';\n\n/**\n * Internal dependencies\n */\nimport styles from './style.scss';\n\nexport class InserterMenu extends Component {\n\tcomponentDidMount() {\n\t\tthis.subscriptionParentMediaAppend = subscribeMediaAppend( ( payload ) => {\n\t\t\tthis.props.onSelect( {\n\t\t\t\tname: 'core/' + payload.mediaType,\n\t\t\t\tinitialAttributes: {\n\t\t\t\t\tid: payload.mediaId,\n\t\t\t\t\t[ payload.mediaType === 'image' ? 'url' : 'src' ]: payload.mediaUrl,\n\t\t\t\t},\n\t\t\t} );\n\t\t} );\n\t\tthis.onOpen();\n\t}\n\n\tcomponentWillUnmount() {\n\t\tif ( this.subscriptionParentMediaAppend ) {\n\t\t\tthis.subscriptionParentMediaAppend.remove();\n\t\t}\n\t\tthis.onClose();\n\t}\n\n\tcalculateNumberOfColumns() {\n\t\tconst bottomSheetWidth = BottomSheet.getWidth();\n\t\tconst { paddingLeft: itemPaddingLeft, paddingRight: itemPaddingRight } = styles.modalItem;\n\t\tconst { paddingLeft: containerPaddingLeft, paddingRight: containerPaddingRight } = styles.content;\n\t\tconst { width: itemWidth } = styles.modalIconWrapper;\n\t\tconst itemTotalWidth = itemWidth + itemPaddingLeft + itemPaddingRight;\n\t\tconst containerTotalWidth = bottomSheetWidth - ( containerPaddingLeft + containerPaddingRight );\n\t\treturn Math.floor( containerTotalWidth / itemTotalWidth );\n\t}\n\n\tonOpen() {\n\t\tthis.props.showInsertionPoint();\n\t}\n\n\tonClose() {\n\t\tthis.props.hideInsertionPoint();\n\t}\n\n\trender() {\n\t\tconst numberOfColumns = this.calculateNumberOfColumns();\n\t\tconst bottomPadding = styles.contentBottomPadding;\n\n\t\treturn (\n\t\t\t<BottomSheet\n\t\t\t\tisVisible={ true }\n\t\t\t\tonClose={ this.props.onDismiss }\n\t\t\t\tcontentStyle={ [ styles.content, bottomPadding ] }\n\t\t\t\thideHeader\n\t\t\t>\n\t\t\t\t<FlatList\n\t\t\t\t\tscrollEnabled={ false }\n\t\t\t\t\tkey={ `InserterUI-${ numberOfColumns }` } //re-render when numberOfColumns changes\n\t\t\t\t\tkeyboardShouldPersistTaps=\"always\"\n\t\t\t\t\tnumColumns={ numberOfColumns }\n\t\t\t\t\tdata={ this.props.items }\n\t\t\t\t\tItemSeparatorComponent={ () =>\n\t\t\t\t\t\t<View style={ styles.rowSeparator } />\n\t\t\t\t\t}\n\t\t\t\t\tkeyExtractor={ ( item ) => item.name }\n\t\t\t\t\trenderItem={ ( { item } ) =>\n\t\t\t\t\t\t<TouchableHighlight\n\t\t\t\t\t\t\tstyle={ styles.touchableArea }\n\t\t\t\t\t\t\tunderlayColor=\"transparent\"\n\t\t\t\t\t\t\tactiveOpacity={ .5 }\n\t\t\t\t\t\t\taccessibilityLabel={ item.title }\n\t\t\t\t\t\t\tonPress={ () => this.props.onSelect( item ) }>\n\t\t\t\t\t\t\t<View style={ styles.modalItem }>\n\t\t\t\t\t\t\t\t<View style={ styles.modalIconWrapper }>\n\t\t\t\t\t\t\t\t\t<View style={ styles.modalIcon }>\n\t\t\t\t\t\t\t\t\t\t<Icon icon={ item.icon.src } fill={ styles.modalIcon.fill } size={ styles.modalIcon.width } />\n\t\t\t\t\t\t\t\t\t</View>\n\t\t\t\t\t\t\t\t</View>\n\t\t\t\t\t\t\t\t<Text style={ styles.modalItemLabel }>{ item.title }</Text>\n\t\t\t\t\t\t\t</View>\n\t\t\t\t\t\t</TouchableHighlight>\n\t\t\t\t\t}\n\t\t\t\t/>\n\t\t\t</BottomSheet>\n\t\t);\n\t}\n}\n\nexport default compose(\n\twithSelect( ( select, { clientId, isAppender, rootClientId } ) => {\n\t\tconst {\n\t\t\tgetInserterItems,\n\t\t\tgetBlockName,\n\t\t\tgetBlockRootClientId,\n\t\t\tgetBlockSelectionEnd,\n\t\t} = select( 'core/block-editor' );\n\t\tconst {\n\t\t\tgetChildBlockNames,\n\t\t} = select( 'core/blocks' );\n\n\t\tlet destinationRootClientId = rootClientId;\n\t\tif ( ! destinationRootClientId && ! clientId && ! isAppender ) {\n\t\t\tconst end = getBlockSelectionEnd();\n\t\t\tif ( end ) {\n\t\t\t\tdestinationRootClientId = getBlockRootClientId( end ) || undefined;\n\t\t\t}\n\t\t}\n\t\tconst destinationRootBlockName = getBlockName( destinationRootClientId );\n\n\t\treturn {\n\t\t\trootChildBlocks: getChildBlockNames( destinationRootBlockName ),\n\t\t\titems: getInserterItems( destinationRootClientId ),\n\t\t\tdestinationRootClientId,\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch, ownProps, { select } ) => {\n\t\tconst {\n\t\t\tshowInsertionPoint,\n\t\t\thideInsertionPoint,\n\t\t} = dispatch( 'core/block-editor' );\n\n\t\t// To avoid duplication, getInsertionIndex is extracted and used in two event handlers\n\t\t// This breaks the withDispatch not containing any logic rule.\n\t\t// Since it's a function only called when the event handlers are called,\n\t\t// it's fine to extract it.\n\t\t// eslint-disable-next-line no-restricted-syntax\n\t\tfunction getInsertionIndex() {\n\t\t\tconst {\n\t\t\t\tgetBlock,\n\t\t\t\tgetBlockIndex,\n\t\t\t\tgetBlockSelectionEnd,\n\t\t\t\tgetBlockOrder,\n\t\t\t} = select( 'core/block-editor' );\n\t\t\tconst {\n\t\t\t\tisPostTitleSelected,\n\t\t\t} = select( 'core/editor' );\n\t\t\tconst { clientId, destinationRootClientId, isAppender } = ownProps;\n\n\t\t\t// if post title is selected insert as first block\n\t\t\tif ( isPostTitleSelected() ) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\t// If the clientId is defined, we insert at the position of the block.\n\t\t\tif ( clientId ) {\n\t\t\t\treturn getBlockIndex( clientId, destinationRootClientId );\n\t\t\t}\n\n\t\t\t// If there a selected block,\n\t\t\tconst end = getBlockSelectionEnd();\n\t\t\tif ( ! isAppender && end ) {\n\t\t\t\t// and the last selected block is unmodified (empty), it will be replaced\n\t\t\t\tif ( isUnmodifiedDefaultBlock( getBlock( end ) ) ) {\n\t\t\t\t\treturn getBlockIndex( end, destinationRootClientId );\n\t\t\t\t}\n\n\t\t\t\t// we insert after the selected block.\n\t\t\t\treturn getBlockIndex( end, destinationRootClientId ) + 1;\n\t\t\t}\n\n\t\t\t// Otherwise, we insert at the end of the current rootClientId\n\t\t\treturn getBlockOrder( destinationRootClientId ).length;\n\t\t}\n\n\t\treturn {\n\t\t\tshowInsertionPoint() {\n\t\t\t\tconst index = getInsertionIndex();\n\t\t\t\tshowInsertionPoint( ownProps.destinationRootClientId, index );\n\t\t\t},\n\t\t\thideInsertionPoint,\n\t\t\tonSelect( item ) {\n\t\t\t\tconst {\n\t\t\t\t\treplaceBlocks,\n\t\t\t\t\tinsertBlock,\n\t\t\t\t} = dispatch( 'core/block-editor' );\n\t\t\t\tconst {\n\t\t\t\t\tgetSelectedBlock,\n\t\t\t\t} = select( 'core/block-editor' );\n\t\t\t\tconst { isAppender } = ownProps;\n\t\t\t\tconst { name, initialAttributes } = item;\n\t\t\t\tconst selectedBlock = getSelectedBlock();\n\t\t\t\tconst insertedBlock = createBlock( name, initialAttributes );\n\t\t\t\tif ( ! isAppender && selectedBlock && isUnmodifiedDefaultBlock( selectedBlock ) ) {\n\t\t\t\t\treplaceBlocks( selectedBlock.clientId, insertedBlock );\n\t\t\t\t} else {\n\t\t\t\t\tinsertBlock(\n\t\t\t\t\t\tinsertedBlock,\n\t\t\t\t\t\tgetInsertionIndex(),\n\t\t\t\t\t\townProps.destinationRootClientId\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\townProps.onSelect();\n\t\t\t},\n\t\t};\n\t} ),\n\twithInstanceId,\n)( InserterMenu );\n"]}