{"version":3,"sources":["@wordpress/block-editor/src/components/block-list/index.native.js"],"names":["innerToolbarHeight","BlockList","arguments","renderItem","bind","renderAddBlockSeparator","renderBlockListFooter","renderDefaultBlockAppender","onCaretVerticalPositionChange","scrollViewInnerRef","addBlockToEndOfPost","shouldFlatListPreventAutomaticScroll","newBlock","props","insertBlock","blockCount","isFullyBordered","styles","blockHolderFullBordered","blockHolderSemiBordered","targetId","caretY","previousCaretY","KeyboardAwareFlatList","handleCaretVerticalPositionChange","scrollViewRef","ref","isBlockInsertionPointVisible","rootClientId","blockContainerFocused","blockHolderBorderStyle","borderColor","flex","clearSelectedBlock","Platform","OS","removeClippedSubviews","list","blockClientIds","identity","title","header","block","clientId","item","index","shouldShowBlockAtIndex","shouldShowInsertionPoint","blockHolderFocused","containerStyleAddHere","lineStyleAddHere","labelStyleAddHere","paragraphBlock","blockListFooter","Component","select","getBlockCount","getBlockIndex","getBlockOrder","getSelectedBlockClientId","getBlockInsertionPoint","selectedBlockClientId","insertionPoint","blockInsertionPointIsVisible","selectedBlockIndex","shouldHideBlockAtIndex","dispatch","replaceBlock"],"mappings":";;;;;;;;;AASA;;;;;;;;;;;;;;;;AANA;;AACA;;AAMA;;AACA;;AACA;;AACA;;AACA;;AAKA;;AACA;;AACA;;AArBA;;;;AAMA;;;;AAUA;;;AAOA,IAAMA,kBAAkB,GAAG,EAA3B;;IAEaC,S;;;;;AACZ,uBAAc;AAAA;;AAAA;AACb,gHAAUC,SAAV;AAEA,UAAKC,UAAL,GAAkB,MAAKA,UAAL,CAAgBC,IAAhB,6CAAlB;AACA,UAAKC,uBAAL,GAA+B,MAAKA,uBAAL,CAA6BD,IAA7B,6CAA/B;AACA,UAAKE,qBAAL,GAA6B,MAAKA,qBAAL,CAA2BF,IAA3B,6CAA7B;AACA,UAAKG,0BAAL,GAAkC,MAAKA,0BAAL,CAAgCH,IAAhC,6CAAlC;AACA,UAAKI,6BAAL,GAAqC,MAAKA,6BAAL,CAAmCJ,IAAnC,6CAArC;AACA,UAAKK,kBAAL,GAA0B,MAAKA,kBAAL,CAAwBL,IAAxB,6CAA1B;AACA,UAAKM,mBAAL,GAA2B,MAAKA,mBAAL,CAAyBN,IAAzB,6CAA3B;AACA,UAAKO,oCAAL,GAA4C,MAAKA,oCAAL,CAA0CP,IAA1C,6CAA5C;AAVa;AAWb;;;;wCAEoBQ,Q,EAAW;AAC/B,WAAKC,KAAL,CAAWC,WAAX,CAAwBF,QAAxB,EAAkC,KAAKC,KAAL,CAAWE,UAA7C;AACA;;;6CAEwB;AACxB,aAAO,KAAKF,KAAL,CAAWG,eAAX,GAA6BC,eAAOC,uBAApC,GAA8DD,eAAOE,uBAA5E;AACA;;;kDAE8BC,Q,EAAUC,M,EAAQC,c,EAAiB;AACjEC,wCAAsBC,iCAAtB,CAAyD,KAAKC,aAA9D,EAA6EL,QAA7E,EAAuFC,MAAvF,EAA+FC,cAA/F;AACA;;;uCAEmBI,G,EAAM;AACzB,WAAKD,aAAL,GAAqBC,GAArB;AACA;;;2DAEsC;AACtC,aAAO,KAAKb,KAAL,CAAWc,4BAAlB;AACA;;;iDAE4B;AAC5B,aACC,4BAAC,+BAAD,QACC,4BAAC,6BAAD;AACC,QAAA,YAAY,EAAG,KAAKd,KAAL,CAAWe,YAD3B;AAEC,QAAA,cAAc,EAAG,CAChBX,eAAOY,qBADS,EAEhB,KAAKC,sBAAL,EAFgB,EAGhB;AAAEC,UAAAA,WAAW,EAAE;AAAf,SAHgB;AAFlB,QADD,CADD;AAYA;;;6BAEQ;AACR,aACC,4BAAC,iBAAD;AACC,QAAA,KAAK,EAAG;AAAEC,UAAAA,IAAI,EAAE;AAAR,SADT;AAEC,QAAA,qBAAqB,EAAG,KAAKnB,KAAL,CAAWoB;AAFpC,SAIC,4BAAC,iCAAD,6BACQC,sBAASC,EAAT,KAAgB,SAAhB,GAA4B;AAAEC,QAAAA,qBAAqB,EAAE;AAAzB,OAA5B,GAA+D,EADvE;AAC8E;AAC7E,QAAA,kBAAkB,EAAC,YAFpB;AAGC,QAAA,QAAQ,EAAG,KAAK3B,kBAHjB;AAIC,QAAA,iBAAiB,EAAGT,kBAAkB,GAAG,EAJ1C;AAKC,QAAA,yBAAyB,EAAC,QAL3B;AAMC,QAAA,KAAK,EAAGiB,eAAOoB,IANhB;AAOC,QAAA,IAAI,EAAG,KAAKxB,KAAL,CAAWyB,cAPnB;AAQC,QAAA,SAAS,EAAG,CAAE,KAAKzB,KAAL,CAAWG,eAAb,CARb;AASC,QAAA,YAAY,EAAGuB,gBAThB;AAUC,QAAA,UAAU,EAAG,KAAKpC,UAVnB;AAWC,QAAA,4BAA4B,EAAG,KAAKQ,oCAXrC;AAYC,QAAA,KAAK,EAAG,KAAKE,KAAL,CAAW2B,KAZpB;AAaC,QAAA,mBAAmB,EAAG,KAAK3B,KAAL,CAAW4B,MAblC;AAcC,QAAA,kBAAkB,EAAG,KAAKlC,0BAd3B;AAeC,QAAA,mBAAmB,EAAG,KAAKD;AAf5B,SAJD,CADD;AAwBA;;;kCAEcoC,K,EAAQ;AACtB,UAAK,CAAEA,KAAP,EAAe;AACd,eAAO,KAAP;AACA;;AACD,aAAO,sCAA0BA,KAA1B,CAAP;AACA;;;qCAEuC;AAAA,UAApBC,QAAoB,QAA1BC,IAA0B;AAAA,UAAVC,KAAU,QAAVA,KAAU;AAAA,wBACsB,KAAKhC,KAD3B;AAAA,UAC/BiC,sBAD+B,eAC/BA,sBAD+B;AAAA,UACPC,wBADO,eACPA,wBADO;AAEvC,aACC,4BAAC,+BAAD,QACGA,wBAAwB,CAAEJ,QAAF,CAAxB,IAAwC,KAAKtC,uBAAL,EAD3C,EAEGyC,sBAAsB,CAAED,KAAF,CAAtB,IACD,4BAAC,cAAD;AACC,QAAA,GAAG,EAAGF,QADP;AAEC,QAAA,SAAS,EAAG,KAFb;AAGC,QAAA,QAAQ,EAAGA,QAHZ;AAIC,QAAA,YAAY,EAAG,KAAK9B,KAAL,CAAWe,YAJ3B;AAKC,QAAA,6BAA6B,EAAG,KAAKpB,6BALtC;AAMC,QAAA,WAAW,EAAG,KAAKsB,sBAAL,EANf;AAOC,QAAA,kBAAkB,EAAGb,eAAO+B,kBAAP,CAA0BjB;AAPhD,QAHF,CADD;AAeA;;;8CAEyB;AACzB,aACC,4BAAC,iBAAD;AAAM,QAAA,KAAK,EAAGd,eAAOgC;AAArB,SACC,4BAAC,iBAAD;AAAM,QAAA,KAAK,EAAGhC,eAAOiC;AAArB,QADD,EAEC,4BAAC,iBAAD;AAAM,QAAA,KAAK,EAAGjC,eAAOkC;AAArB,SAA4C,cAAI,gBAAJ,CAA5C,CAFD,EAGC,4BAAC,iBAAD;AAAM,QAAA,KAAK,EAAGlC,eAAOiC;AAArB,QAHD,CADD;AAOA;;;4CAEuB;AAAA;;AACvB,UAAME,cAAc,GAAG,yBAAa,gBAAb,CAAvB;AACA,aACC,4BAAC,qCAAD;AAA0B,QAAA,OAAO,EAAG,mBAAM;AACzC,UAAA,MAAI,CAAC1C,mBAAL,CAA0B0C,cAA1B;AACA;AAFD,SAGC,4BAAC,iBAAD;AAAM,QAAA,KAAK,EAAGnC,eAAOoC;AAArB,QAHD,CADD;AAOA;;;EAzH6BC,kB;;;;eA4HhB,sBAAS,CACvB,sBAAY,UAAEC,MAAF,SAAgC;AAAA,MAApB3B,YAAoB,SAApBA,YAAoB;;AAAA,gBAQvC2B,MAAM,CAAE,mBAAF,CARiC;AAAA,MAE1CC,aAF0C,WAE1CA,aAF0C;AAAA,MAG1CC,aAH0C,WAG1CA,aAH0C;AAAA,MAI1CC,aAJ0C,WAI1CA,aAJ0C;AAAA,MAK1CC,wBAL0C,WAK1CA,wBAL0C;AAAA,MAM1CC,sBAN0C,WAM1CA,sBAN0C;AAAA,MAO1CjC,4BAP0C,WAO1CA,4BAP0C;;AAU3C,MAAMkC,qBAAqB,GAAGF,wBAAwB,EAAtD;AACA,MAAMrB,cAAc,GAAGoB,aAAa,CAAE9B,YAAF,CAApC;AACA,MAAMkC,cAAc,GAAGF,sBAAsB,EAA7C;AACA,MAAMG,4BAA4B,GAAGpC,4BAA4B,EAAjE;;AACA,MAAMoB,wBAAwB,GAAG,SAA3BA,wBAA2B,CAAEJ,QAAF,EAAgB;AAChD,WACCoB,4BAA4B,IAC5BD,cAAc,CAAClC,YAAf,KAAgCA,YADhC,IAEAU,cAAc,CAAEwB,cAAc,CAACjB,KAAjB,CAAd,KAA2CF,QAH5C;AAKA,GAND;;AAQA,MAAMqB,kBAAkB,GAAGP,aAAa,CAAEI,qBAAF,CAAxC;;AACA,MAAMf,sBAAsB,GAAG,SAAzBA,sBAAyB,CAAED,KAAF,EAAa;AAC3C,QAAMoB,sBAAsB,GAC3BF,4BAA4B,IAC5B;AACAlB,IAAAA,KAAK,KAAKiB,cAAc,CAACjB,KAFzB,IAGA;AACAA,IAAAA,KAAK,KAAKmB,kBALX;AAOA,WAAO,CAAEC,sBAAT;AACA,GATD;;AAWA,SAAO;AACN3B,IAAAA,cAAc,EAAdA,cADM;AAENvB,IAAAA,UAAU,EAAEyC,aAAa,CAAE5B,YAAF,CAFnB;AAGND,IAAAA,4BAA4B,EAAEA,4BAA4B,EAHpD;AAINmB,IAAAA,sBAAsB,EAAtBA,sBAJM;AAKNC,IAAAA,wBAAwB,EAAxBA,wBALM;AAMNc,IAAAA,qBAAqB,EAArBA;AANM,GAAP;AAQA,CA1CD,CADuB,EA4CvB,wBAAc,UAAEK,QAAF,EAAgB;AAAA,kBAKzBA,QAAQ,CAAE,mBAAF,CALiB;AAAA,MAE5BpD,WAF4B,aAE5BA,WAF4B;AAAA,MAG5BqD,YAH4B,aAG5BA,YAH4B;AAAA,MAI5BlC,kBAJ4B,aAI5BA,kBAJ4B;;AAO7B,SAAO;AACNA,IAAAA,kBAAkB,EAAlBA,kBADM;AAENnB,IAAAA,WAAW,EAAXA,WAFM;AAGNqD,IAAAA,YAAY,EAAZA;AAHM,GAAP;AAKA,CAZD,CA5CuB,CAAT,EAyDVlE,SAzDU,C","sourcesContent":["/**\n * External dependencies\n */\nimport { identity } from 'lodash';\nimport { Text, View, Platform, TouchableWithoutFeedback } from 'react-native';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\nimport { withDispatch, withSelect } from '@wordpress/data';\nimport { compose } from '@wordpress/compose';\nimport { createBlock, isUnmodifiedDefaultBlock } from '@wordpress/blocks';\nimport { KeyboardAwareFlatList, ReadableContentView } from '@wordpress/components';\n\n/**\n * Internal dependencies\n */\nimport styles from './style.scss';\nimport BlockListBlock from './block';\nimport DefaultBlockAppender from '../default-block-appender';\n\nconst innerToolbarHeight = 44;\n\nexport class BlockList extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\tthis.renderItem = this.renderItem.bind( this );\n\t\tthis.renderAddBlockSeparator = this.renderAddBlockSeparator.bind( this );\n\t\tthis.renderBlockListFooter = this.renderBlockListFooter.bind( this );\n\t\tthis.renderDefaultBlockAppender = this.renderDefaultBlockAppender.bind( this );\n\t\tthis.onCaretVerticalPositionChange = this.onCaretVerticalPositionChange.bind( this );\n\t\tthis.scrollViewInnerRef = this.scrollViewInnerRef.bind( this );\n\t\tthis.addBlockToEndOfPost = this.addBlockToEndOfPost.bind( this );\n\t\tthis.shouldFlatListPreventAutomaticScroll = this.shouldFlatListPreventAutomaticScroll.bind( this );\n\t}\n\n\taddBlockToEndOfPost( newBlock ) {\n\t\tthis.props.insertBlock( newBlock, this.props.blockCount );\n\t}\n\n\tblockHolderBorderStyle() {\n\t\treturn this.props.isFullyBordered ? styles.blockHolderFullBordered : styles.blockHolderSemiBordered;\n\t}\n\n\tonCaretVerticalPositionChange( targetId, caretY, previousCaretY ) {\n\t\tKeyboardAwareFlatList.handleCaretVerticalPositionChange( this.scrollViewRef, targetId, caretY, previousCaretY );\n\t}\n\n\tscrollViewInnerRef( ref ) {\n\t\tthis.scrollViewRef = ref;\n\t}\n\n\tshouldFlatListPreventAutomaticScroll() {\n\t\treturn this.props.isBlockInsertionPointVisible;\n\t}\n\n\trenderDefaultBlockAppender() {\n\t\treturn (\n\t\t\t<ReadableContentView>\n\t\t\t\t<DefaultBlockAppender\n\t\t\t\t\trootClientId={ this.props.rootClientId }\n\t\t\t\t\tcontainerStyle={ [\n\t\t\t\t\t\tstyles.blockContainerFocused,\n\t\t\t\t\t\tthis.blockHolderBorderStyle(),\n\t\t\t\t\t\t{ borderColor: 'transparent' },\n\t\t\t\t\t] }\n\t\t\t\t/>\n\t\t\t</ReadableContentView>\n\t\t);\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<View\n\t\t\t\tstyle={ { flex: 1 } }\n\t\t\t\tonAccessibilityEscape={ this.props.clearSelectedBlock }\n\t\t\t>\n\t\t\t\t<KeyboardAwareFlatList\n\t\t\t\t\t{ ...( Platform.OS === 'android' ? { removeClippedSubviews: false } : {} ) } // Disable clipping on Android to fix focus losing. See https://github.com/wordpress-mobile/gutenberg-mobile/pull/741#issuecomment-472746541\n\t\t\t\t\taccessibilityLabel=\"block-list\"\n\t\t\t\t\tinnerRef={ this.scrollViewInnerRef }\n\t\t\t\t\textraScrollHeight={ innerToolbarHeight + 10 }\n\t\t\t\t\tkeyboardShouldPersistTaps=\"always\"\n\t\t\t\t\tstyle={ styles.list }\n\t\t\t\t\tdata={ this.props.blockClientIds }\n\t\t\t\t\textraData={ [ this.props.isFullyBordered ] }\n\t\t\t\t\tkeyExtractor={ identity }\n\t\t\t\t\trenderItem={ this.renderItem }\n\t\t\t\t\tshouldPreventAutomaticScroll={ this.shouldFlatListPreventAutomaticScroll }\n\t\t\t\t\ttitle={ this.props.title }\n\t\t\t\t\tListHeaderComponent={ this.props.header }\n\t\t\t\t\tListEmptyComponent={ this.renderDefaultBlockAppender }\n\t\t\t\t\tListFooterComponent={ this.renderBlockListFooter }\n\t\t\t\t/>\n\t\t\t</View>\n\t\t);\n\t}\n\n\tisReplaceable( block ) {\n\t\tif ( ! block ) {\n\t\t\treturn false;\n\t\t}\n\t\treturn isUnmodifiedDefaultBlock( block );\n\t}\n\n\trenderItem( { item: clientId, index } ) {\n\t\tconst { shouldShowBlockAtIndex, shouldShowInsertionPoint } = this.props;\n\t\treturn (\n\t\t\t<ReadableContentView>\n\t\t\t\t{ shouldShowInsertionPoint( clientId ) && this.renderAddBlockSeparator() }\n\t\t\t\t{ shouldShowBlockAtIndex( index ) && (\n\t\t\t\t\t<BlockListBlock\n\t\t\t\t\t\tkey={ clientId }\n\t\t\t\t\t\tshowTitle={ false }\n\t\t\t\t\t\tclientId={ clientId }\n\t\t\t\t\t\trootClientId={ this.props.rootClientId }\n\t\t\t\t\t\tonCaretVerticalPositionChange={ this.onCaretVerticalPositionChange }\n\t\t\t\t\t\tborderStyle={ this.blockHolderBorderStyle() }\n\t\t\t\t\t\tfocusedBorderColor={ styles.blockHolderFocused.borderColor }\n\t\t\t\t\t/> ) }\n\t\t\t</ReadableContentView>\n\t\t);\n\t}\n\n\trenderAddBlockSeparator() {\n\t\treturn (\n\t\t\t<View style={ styles.containerStyleAddHere } >\n\t\t\t\t<View style={ styles.lineStyleAddHere }></View>\n\t\t\t\t<Text style={ styles.labelStyleAddHere } >{ __( 'ADD BLOCK HERE' ) }</Text>\n\t\t\t\t<View style={ styles.lineStyleAddHere }></View>\n\t\t\t</View>\n\t\t);\n\t}\n\n\trenderBlockListFooter() {\n\t\tconst paragraphBlock = createBlock( 'core/paragraph' );\n\t\treturn (\n\t\t\t<TouchableWithoutFeedback onPress={ () => {\n\t\t\t\tthis.addBlockToEndOfPost( paragraphBlock );\n\t\t\t} } >\n\t\t\t\t<View style={ styles.blockListFooter } />\n\t\t\t</TouchableWithoutFeedback>\n\t\t);\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select, { rootClientId } ) => {\n\t\tconst {\n\t\t\tgetBlockCount,\n\t\t\tgetBlockIndex,\n\t\t\tgetBlockOrder,\n\t\t\tgetSelectedBlockClientId,\n\t\t\tgetBlockInsertionPoint,\n\t\t\tisBlockInsertionPointVisible,\n\t\t} = select( 'core/block-editor' );\n\n\t\tconst selectedBlockClientId = getSelectedBlockClientId();\n\t\tconst blockClientIds = getBlockOrder( rootClientId );\n\t\tconst insertionPoint = getBlockInsertionPoint();\n\t\tconst blockInsertionPointIsVisible = isBlockInsertionPointVisible();\n\t\tconst shouldShowInsertionPoint = ( clientId ) => {\n\t\t\treturn (\n\t\t\t\tblockInsertionPointIsVisible &&\n\t\t\t\tinsertionPoint.rootClientId === rootClientId &&\n\t\t\t\tblockClientIds[ insertionPoint.index ] === clientId\n\t\t\t);\n\t\t};\n\n\t\tconst selectedBlockIndex = getBlockIndex( selectedBlockClientId );\n\t\tconst shouldShowBlockAtIndex = ( index ) => {\n\t\t\tconst shouldHideBlockAtIndex = (\n\t\t\t\tblockInsertionPointIsVisible &&\n\t\t\t\t// if `index` === `insertionPoint.index`, then block is replaceable\n\t\t\t\tindex === insertionPoint.index &&\n\t\t\t\t// only hide selected block\n\t\t\t\tindex === selectedBlockIndex\n\t\t\t);\n\t\t\treturn ! shouldHideBlockAtIndex;\n\t\t};\n\n\t\treturn {\n\t\t\tblockClientIds,\n\t\t\tblockCount: getBlockCount( rootClientId ),\n\t\t\tisBlockInsertionPointVisible: isBlockInsertionPointVisible(),\n\t\t\tshouldShowBlockAtIndex,\n\t\t\tshouldShowInsertionPoint,\n\t\t\tselectedBlockClientId,\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch ) => {\n\t\tconst {\n\t\t\tinsertBlock,\n\t\t\treplaceBlock,\n\t\t\tclearSelectedBlock,\n\t\t} = dispatch( 'core/block-editor' );\n\n\t\treturn {\n\t\t\tclearSelectedBlock,\n\t\t\tinsertBlock,\n\t\t\treplaceBlock,\n\t\t};\n\t} ),\n] )( BlockList );\n\n"]}