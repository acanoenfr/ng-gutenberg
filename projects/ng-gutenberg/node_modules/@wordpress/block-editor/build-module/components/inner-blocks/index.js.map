{"version":3,"sources":["@wordpress/block-editor/src/components/inner-blocks/index.js"],"names":["pick","isEqual","classnames","withViewportMatch","Component","withSelect","withDispatch","synchronizeBlocksWithTemplate","withBlockContentContext","isShallowEqual","compose","ButtonBlockAppender","DefaultBlockAppender","BlockList","withBlockEditContext","TemplatePicker","InnerBlocks","arguments","state","templateInProcess","props","template","updateNestedSettings","templateLock","block","innerBlocks","length","setState","prevProps","hasTemplateChanged","replaceInnerBlocks","nextBlocks","blockListSettings","allowedBlocks","parentLock","newSettings","undefined","isSmallScreen","clientId","hasOverlay","renderAppender","templateOptions","__experimentalTemplateOptions","onSelectTemplateOption","__experimentalOnSelectTemplateOption","allowTemplateOptionSkip","__experimentalAllowTemplateOptionSkip","isPlaceholder","classes","context","select","ownProps","isBlockSelected","hasSelectedInnerBlock","getBlock","getBlockListSettings","getBlockRootClientId","getTemplateLock","rootClientId","name","dispatch","updateBlockListSettings","templateInsertUpdatesSelection","blocks","settings","Content","BlockContent"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { pick, isEqual } from 'lodash';\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { withViewportMatch } from '@wordpress/viewport'; // Temporary click-through disable on desktop.\nimport { Component } from '@wordpress/element';\nimport { withSelect, withDispatch } from '@wordpress/data';\nimport { synchronizeBlocksWithTemplate, withBlockContentContext } from '@wordpress/blocks';\nimport isShallowEqual from '@wordpress/is-shallow-equal';\nimport { compose } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport ButtonBlockAppender from './button-block-appender';\nimport DefaultBlockAppender from './default-block-appender';\n\n/**\n * Internal dependencies\n */\nimport BlockList from '../block-list';\nimport { withBlockEditContext } from '../block-edit/context';\nimport TemplatePicker from './template-picker';\n\nclass InnerBlocks extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\t\tthis.state = {\n\t\t\ttemplateInProcess: !! this.props.template,\n\t\t};\n\t\tthis.updateNestedSettings();\n\t}\n\n\tcomponentDidMount() {\n\t\tconst { templateLock, block } = this.props;\n\t\tconst { innerBlocks } = block;\n\t\t// Only synchronize innerBlocks with template if innerBlocks are empty or a locking all exists directly on the block.\n\t\tif ( innerBlocks.length === 0 || templateLock === 'all' ) {\n\t\t\tthis.synchronizeBlocksWithTemplate();\n\t\t}\n\n\t\tif ( this.state.templateInProcess ) {\n\t\t\tthis.setState( {\n\t\t\t\ttemplateInProcess: false,\n\t\t\t} );\n\t\t}\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tconst { template, block, templateLock } = this.props;\n\t\tconst { innerBlocks } = block;\n\n\t\tthis.updateNestedSettings();\n\t\t// Only synchronize innerBlocks with template if innerBlocks are empty or a locking all exists directly on the block.\n\t\tif ( innerBlocks.length === 0 || templateLock === 'all' ) {\n\t\t\tconst hasTemplateChanged = ! isEqual( template, prevProps.template );\n\t\t\tif ( hasTemplateChanged ) {\n\t\t\t\tthis.synchronizeBlocksWithTemplate();\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Called on mount or when a mismatch exists between the templates and\n\t * inner blocks, synchronizes inner blocks with the template, replacing\n\t * current blocks.\n\t */\n\tsynchronizeBlocksWithTemplate() {\n\t\tconst { template, block, replaceInnerBlocks } = this.props;\n\t\tconst { innerBlocks } = block;\n\n\t\t// Synchronize with templates. If the next set differs, replace.\n\t\tconst nextBlocks = synchronizeBlocksWithTemplate( innerBlocks, template );\n\t\tif ( ! isEqual( nextBlocks, innerBlocks\t) ) {\n\t\t\treplaceInnerBlocks( nextBlocks );\n\t\t}\n\t}\n\n\tupdateNestedSettings() {\n\t\tconst {\n\t\t\tblockListSettings,\n\t\t\tallowedBlocks,\n\t\t\tupdateNestedSettings,\n\t\t\ttemplateLock,\n\t\t\tparentLock,\n\t\t} = this.props;\n\n\t\tconst newSettings = {\n\t\t\tallowedBlocks,\n\t\t\ttemplateLock: templateLock === undefined ? parentLock : templateLock,\n\t\t};\n\n\t\tif ( ! isShallowEqual( blockListSettings, newSettings ) ) {\n\t\t\tupdateNestedSettings( newSettings );\n\t\t}\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tisSmallScreen, // Temporary click-through disable on desktop.\n\t\t\tclientId,\n\t\t\thasOverlay,\n\t\t\trenderAppender,\n\t\t\ttemplate,\n\t\t\t__experimentalTemplateOptions: templateOptions,\n\t\t\t__experimentalOnSelectTemplateOption: onSelectTemplateOption,\n\t\t\t__experimentalAllowTemplateOptionSkip: allowTemplateOptionSkip,\n\t\t} = this.props;\n\t\tconst { templateInProcess } = this.state;\n\n\t\tconst isPlaceholder = template === null && !! templateOptions;\n\n\t\tconst classes = classnames( 'editor-inner-blocks block-editor-inner-blocks', {\n\t\t\t'has-overlay': isSmallScreen && ( hasOverlay && ! isPlaceholder ), // Temporary click-through disable on desktop.\n\t\t} );\n\n\t\treturn (\n\t\t\t<div className={ classes }>\n\t\t\t\t{ ! templateInProcess && (\n\t\t\t\t\tisPlaceholder ?\n\t\t\t\t\t\t<TemplatePicker\n\t\t\t\t\t\t\toptions={ templateOptions }\n\t\t\t\t\t\t\tonSelect={ onSelectTemplateOption }\n\t\t\t\t\t\t\tallowSkip={ allowTemplateOptionSkip }\n\t\t\t\t\t\t/> :\n\t\t\t\t\t\t<BlockList\n\t\t\t\t\t\t\trootClientId={ clientId }\n\t\t\t\t\t\t\trenderAppender={ renderAppender }\n\t\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nInnerBlocks = compose( [\n\twithViewportMatch( { isSmallScreen: '< medium' } ), // Temporary click-through disable on desktop.\n\twithBlockEditContext( ( context ) => pick( context, [ 'clientId' ] ) ),\n\twithSelect( ( select, ownProps ) => {\n\t\tconst {\n\t\t\tisBlockSelected,\n\t\t\thasSelectedInnerBlock,\n\t\t\tgetBlock,\n\t\t\tgetBlockListSettings,\n\t\t\tgetBlockRootClientId,\n\t\t\tgetTemplateLock,\n\t\t} = select( 'core/block-editor' );\n\t\tconst { clientId } = ownProps;\n\t\tconst block = getBlock( clientId );\n\t\tconst rootClientId = getBlockRootClientId( clientId );\n\n\t\treturn {\n\t\t\tblock,\n\t\t\tblockListSettings: getBlockListSettings( clientId ),\n\t\t\thasOverlay: block.name !== 'core/template' && ! isBlockSelected( clientId ) && ! hasSelectedInnerBlock( clientId, true ),\n\t\t\tparentLock: getTemplateLock( rootClientId ),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch, ownProps ) => {\n\t\tconst {\n\t\t\treplaceInnerBlocks,\n\t\t\tupdateBlockListSettings,\n\t\t} = dispatch( 'core/block-editor' );\n\t\tconst { block, clientId, templateInsertUpdatesSelection = true } = ownProps;\n\n\t\treturn {\n\t\t\treplaceInnerBlocks( blocks ) {\n\t\t\t\treplaceInnerBlocks( clientId, blocks, block.innerBlocks.length === 0 && templateInsertUpdatesSelection );\n\t\t\t},\n\t\t\tupdateNestedSettings( settings ) {\n\t\t\t\tdispatch( updateBlockListSettings( clientId, settings ) );\n\t\t\t},\n\t\t};\n\t} ),\n] )( InnerBlocks );\n\n// Expose default appender placeholders as components.\nInnerBlocks.DefaultBlockAppender = DefaultBlockAppender;\nInnerBlocks.ButtonBlockAppender = ButtonBlockAppender;\n\nInnerBlocks.Content = withBlockContentContext(\n\t( { BlockContent } ) => <BlockContent />\n);\n\n/**\n * @see https://github.com/WordPress/gutenberg/blob/master/packages/block-editor/src/components/inner-blocks/README.md\n */\nexport default InnerBlocks;\n"]}