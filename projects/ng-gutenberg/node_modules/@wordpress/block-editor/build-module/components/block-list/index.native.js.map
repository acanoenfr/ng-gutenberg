{"version":3,"sources":["@wordpress/block-editor/src/components/block-list/index.native.js"],"names":["identity","Text","View","Platform","TouchableWithoutFeedback","Component","__","withDispatch","withSelect","compose","createBlock","isUnmodifiedDefaultBlock","KeyboardAwareFlatList","ReadableContentView","styles","BlockListBlock","DefaultBlockAppender","innerToolbarHeight","BlockList","arguments","renderItem","bind","renderAddBlockSeparator","renderBlockListFooter","renderDefaultBlockAppender","onCaretVerticalPositionChange","scrollViewInnerRef","addBlockToEndOfPost","shouldFlatListPreventAutomaticScroll","newBlock","props","insertBlock","blockCount","isFullyBordered","blockHolderFullBordered","blockHolderSemiBordered","targetId","caretY","previousCaretY","handleCaretVerticalPositionChange","scrollViewRef","ref","isBlockInsertionPointVisible","rootClientId","blockContainerFocused","blockHolderBorderStyle","borderColor","flex","clearSelectedBlock","OS","removeClippedSubviews","list","blockClientIds","title","header","block","clientId","item","index","shouldShowBlockAtIndex","shouldShowInsertionPoint","blockHolderFocused","containerStyleAddHere","lineStyleAddHere","labelStyleAddHere","paragraphBlock","blockListFooter","select","getBlockCount","getBlockIndex","getBlockOrder","getSelectedBlockClientId","getBlockInsertionPoint","selectedBlockClientId","insertionPoint","blockInsertionPointIsVisible","selectedBlockIndex","shouldHideBlockAtIndex","dispatch","replaceBlock"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { identity } from 'lodash';\nimport { Text, View, Platform, TouchableWithoutFeedback } from 'react-native';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\nimport { withDispatch, withSelect } from '@wordpress/data';\nimport { compose } from '@wordpress/compose';\nimport { createBlock, isUnmodifiedDefaultBlock } from '@wordpress/blocks';\nimport { KeyboardAwareFlatList, ReadableContentView } from '@wordpress/components';\n\n/**\n * Internal dependencies\n */\nimport styles from './style.scss';\nimport BlockListBlock from './block';\nimport DefaultBlockAppender from '../default-block-appender';\n\nconst innerToolbarHeight = 44;\n\nexport class BlockList extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\tthis.renderItem = this.renderItem.bind( this );\n\t\tthis.renderAddBlockSeparator = this.renderAddBlockSeparator.bind( this );\n\t\tthis.renderBlockListFooter = this.renderBlockListFooter.bind( this );\n\t\tthis.renderDefaultBlockAppender = this.renderDefaultBlockAppender.bind( this );\n\t\tthis.onCaretVerticalPositionChange = this.onCaretVerticalPositionChange.bind( this );\n\t\tthis.scrollViewInnerRef = this.scrollViewInnerRef.bind( this );\n\t\tthis.addBlockToEndOfPost = this.addBlockToEndOfPost.bind( this );\n\t\tthis.shouldFlatListPreventAutomaticScroll = this.shouldFlatListPreventAutomaticScroll.bind( this );\n\t}\n\n\taddBlockToEndOfPost( newBlock ) {\n\t\tthis.props.insertBlock( newBlock, this.props.blockCount );\n\t}\n\n\tblockHolderBorderStyle() {\n\t\treturn this.props.isFullyBordered ? styles.blockHolderFullBordered : styles.blockHolderSemiBordered;\n\t}\n\n\tonCaretVerticalPositionChange( targetId, caretY, previousCaretY ) {\n\t\tKeyboardAwareFlatList.handleCaretVerticalPositionChange( this.scrollViewRef, targetId, caretY, previousCaretY );\n\t}\n\n\tscrollViewInnerRef( ref ) {\n\t\tthis.scrollViewRef = ref;\n\t}\n\n\tshouldFlatListPreventAutomaticScroll() {\n\t\treturn this.props.isBlockInsertionPointVisible;\n\t}\n\n\trenderDefaultBlockAppender() {\n\t\treturn (\n\t\t\t<ReadableContentView>\n\t\t\t\t<DefaultBlockAppender\n\t\t\t\t\trootClientId={ this.props.rootClientId }\n\t\t\t\t\tcontainerStyle={ [\n\t\t\t\t\t\tstyles.blockContainerFocused,\n\t\t\t\t\t\tthis.blockHolderBorderStyle(),\n\t\t\t\t\t\t{ borderColor: 'transparent' },\n\t\t\t\t\t] }\n\t\t\t\t/>\n\t\t\t</ReadableContentView>\n\t\t);\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<View\n\t\t\t\tstyle={ { flex: 1 } }\n\t\t\t\tonAccessibilityEscape={ this.props.clearSelectedBlock }\n\t\t\t>\n\t\t\t\t<KeyboardAwareFlatList\n\t\t\t\t\t{ ...( Platform.OS === 'android' ? { removeClippedSubviews: false } : {} ) } // Disable clipping on Android to fix focus losing. See https://github.com/wordpress-mobile/gutenberg-mobile/pull/741#issuecomment-472746541\n\t\t\t\t\taccessibilityLabel=\"block-list\"\n\t\t\t\t\tinnerRef={ this.scrollViewInnerRef }\n\t\t\t\t\textraScrollHeight={ innerToolbarHeight + 10 }\n\t\t\t\t\tkeyboardShouldPersistTaps=\"always\"\n\t\t\t\t\tstyle={ styles.list }\n\t\t\t\t\tdata={ this.props.blockClientIds }\n\t\t\t\t\textraData={ [ this.props.isFullyBordered ] }\n\t\t\t\t\tkeyExtractor={ identity }\n\t\t\t\t\trenderItem={ this.renderItem }\n\t\t\t\t\tshouldPreventAutomaticScroll={ this.shouldFlatListPreventAutomaticScroll }\n\t\t\t\t\ttitle={ this.props.title }\n\t\t\t\t\tListHeaderComponent={ this.props.header }\n\t\t\t\t\tListEmptyComponent={ this.renderDefaultBlockAppender }\n\t\t\t\t\tListFooterComponent={ this.renderBlockListFooter }\n\t\t\t\t/>\n\t\t\t</View>\n\t\t);\n\t}\n\n\tisReplaceable( block ) {\n\t\tif ( ! block ) {\n\t\t\treturn false;\n\t\t}\n\t\treturn isUnmodifiedDefaultBlock( block );\n\t}\n\n\trenderItem( { item: clientId, index } ) {\n\t\tconst { shouldShowBlockAtIndex, shouldShowInsertionPoint } = this.props;\n\t\treturn (\n\t\t\t<ReadableContentView>\n\t\t\t\t{ shouldShowInsertionPoint( clientId ) && this.renderAddBlockSeparator() }\n\t\t\t\t{ shouldShowBlockAtIndex( index ) && (\n\t\t\t\t\t<BlockListBlock\n\t\t\t\t\t\tkey={ clientId }\n\t\t\t\t\t\tshowTitle={ false }\n\t\t\t\t\t\tclientId={ clientId }\n\t\t\t\t\t\trootClientId={ this.props.rootClientId }\n\t\t\t\t\t\tonCaretVerticalPositionChange={ this.onCaretVerticalPositionChange }\n\t\t\t\t\t\tborderStyle={ this.blockHolderBorderStyle() }\n\t\t\t\t\t\tfocusedBorderColor={ styles.blockHolderFocused.borderColor }\n\t\t\t\t\t/> ) }\n\t\t\t</ReadableContentView>\n\t\t);\n\t}\n\n\trenderAddBlockSeparator() {\n\t\treturn (\n\t\t\t<View style={ styles.containerStyleAddHere } >\n\t\t\t\t<View style={ styles.lineStyleAddHere }></View>\n\t\t\t\t<Text style={ styles.labelStyleAddHere } >{ __( 'ADD BLOCK HERE' ) }</Text>\n\t\t\t\t<View style={ styles.lineStyleAddHere }></View>\n\t\t\t</View>\n\t\t);\n\t}\n\n\trenderBlockListFooter() {\n\t\tconst paragraphBlock = createBlock( 'core/paragraph' );\n\t\treturn (\n\t\t\t<TouchableWithoutFeedback onPress={ () => {\n\t\t\t\tthis.addBlockToEndOfPost( paragraphBlock );\n\t\t\t} } >\n\t\t\t\t<View style={ styles.blockListFooter } />\n\t\t\t</TouchableWithoutFeedback>\n\t\t);\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select, { rootClientId } ) => {\n\t\tconst {\n\t\t\tgetBlockCount,\n\t\t\tgetBlockIndex,\n\t\t\tgetBlockOrder,\n\t\t\tgetSelectedBlockClientId,\n\t\t\tgetBlockInsertionPoint,\n\t\t\tisBlockInsertionPointVisible,\n\t\t} = select( 'core/block-editor' );\n\n\t\tconst selectedBlockClientId = getSelectedBlockClientId();\n\t\tconst blockClientIds = getBlockOrder( rootClientId );\n\t\tconst insertionPoint = getBlockInsertionPoint();\n\t\tconst blockInsertionPointIsVisible = isBlockInsertionPointVisible();\n\t\tconst shouldShowInsertionPoint = ( clientId ) => {\n\t\t\treturn (\n\t\t\t\tblockInsertionPointIsVisible &&\n\t\t\t\tinsertionPoint.rootClientId === rootClientId &&\n\t\t\t\tblockClientIds[ insertionPoint.index ] === clientId\n\t\t\t);\n\t\t};\n\n\t\tconst selectedBlockIndex = getBlockIndex( selectedBlockClientId );\n\t\tconst shouldShowBlockAtIndex = ( index ) => {\n\t\t\tconst shouldHideBlockAtIndex = (\n\t\t\t\tblockInsertionPointIsVisible &&\n\t\t\t\t// if `index` === `insertionPoint.index`, then block is replaceable\n\t\t\t\tindex === insertionPoint.index &&\n\t\t\t\t// only hide selected block\n\t\t\t\tindex === selectedBlockIndex\n\t\t\t);\n\t\t\treturn ! shouldHideBlockAtIndex;\n\t\t};\n\n\t\treturn {\n\t\t\tblockClientIds,\n\t\t\tblockCount: getBlockCount( rootClientId ),\n\t\t\tisBlockInsertionPointVisible: isBlockInsertionPointVisible(),\n\t\t\tshouldShowBlockAtIndex,\n\t\t\tshouldShowInsertionPoint,\n\t\t\tselectedBlockClientId,\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch ) => {\n\t\tconst {\n\t\t\tinsertBlock,\n\t\t\treplaceBlock,\n\t\t\tclearSelectedBlock,\n\t\t} = dispatch( 'core/block-editor' );\n\n\t\treturn {\n\t\t\tclearSelectedBlock,\n\t\t\tinsertBlock,\n\t\t\treplaceBlock,\n\t\t};\n\t} ),\n] )( BlockList );\n\n"]}