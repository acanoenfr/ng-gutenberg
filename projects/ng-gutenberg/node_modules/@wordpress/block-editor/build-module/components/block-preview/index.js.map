{"version":3,"sources":["@wordpress/block-editor/src/components/block-preview/index.js"],"names":["castArray","classnames","Disabled","withSelect","useLayoutEffect","useState","useRef","useReducer","useMemo","BlockEditorProvider","BlockList","getBlockPreviewContainerDOMNode","ScaledBlockPreview","blocks","viewportWidth","padding","previewRef","isReady","setIsReady","previewScale","setPreviewScale","x","y","setPosition","timerId","setTimeout","containerElement","current","length","block","previewElement","clientId","containerElementRect","getBoundingClientRect","width","height","left","top","scaledElementRect","scale","offsetX","offsetY","style","marginTop","window","clearTimeout","previewStyles","transform","visibility","BlockPreview","settings","renderedBlocks","state","recompute","triggerRecompute","select","getSettings"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { castArray } from 'lodash';\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { Disabled } from '@wordpress/components';\nimport { withSelect } from '@wordpress/data';\nimport { useLayoutEffect, useState, useRef, useReducer, useMemo } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport BlockEditorProvider from '../provider';\nimport BlockList from '../block-list';\nimport { getBlockPreviewContainerDOMNode } from '../../utils/dom';\n\nfunction ScaledBlockPreview( { blocks, viewportWidth, padding = 0 } ) {\n\tconst previewRef = useRef( null );\n\n\tconst [ isReady, setIsReady ] = useState( false );\n\tconst [ previewScale, setPreviewScale ] = useState( 1 );\n\tconst [ { x, y }, setPosition ] = useState( { x: 0, y: 0 } );\n\n\t// Dynamically calculate the scale factor\n\tuseLayoutEffect( () => {\n\t\t// Timer - required to account for async render of `BlockEditorProvider`\n\t\tconst timerId = setTimeout( () => {\n\t\t\tconst containerElement = previewRef.current;\n\t\t\tif ( ! containerElement ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// If we're previewing a single block, scale the preview to fit it.\n\t\t\tif ( blocks.length === 1 ) {\n\t\t\t\tconst block = blocks[ 0 ];\n\t\t\t\tconst previewElement = getBlockPreviewContainerDOMNode( block.clientId, containerElement );\n\t\t\t\tif ( ! previewElement ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet containerElementRect = containerElement.getBoundingClientRect();\n\t\t\t\tcontainerElementRect = {\n\t\t\t\t\twidth: containerElementRect.width - ( padding * 2 ),\n\t\t\t\t\theight: containerElementRect.height - ( padding * 2 ),\n\t\t\t\t\tleft: containerElementRect.left,\n\t\t\t\t\ttop: containerElementRect.top,\n\t\t\t\t};\n\t\t\t\tconst scaledElementRect = previewElement.getBoundingClientRect();\n\n\t\t\t\tconst scale = containerElementRect.width / scaledElementRect.width || 1;\n\t\t\t\tconst offsetX = ( -( scaledElementRect.left - containerElementRect.left ) * scale ) + padding;\n\t\t\t\tconst offsetY = ( containerElementRect.height > scaledElementRect.height * scale ) ?\n\t\t\t\t\t( ( containerElementRect.height - ( scaledElementRect.height * scale ) ) / 2 ) + padding : 0;\n\n\t\t\t\tsetPreviewScale( scale );\n\t\t\t\tsetPosition( { x: offsetX, y: offsetY } );\n\n\t\t\t\t// Hack: we need  to reset the scaled elements margins\n\t\t\t\tpreviewElement.style.marginTop = '0';\n\t\t\t} else {\n\t\t\t\tconst containerElementRect = containerElement.getBoundingClientRect();\n\t\t\t\tsetPreviewScale( containerElementRect.width / viewportWidth );\n\t\t\t}\n\n\t\t\tsetIsReady( true );\n\t\t}, 100 );\n\n\t\t// Cleanup\n\t\treturn () => {\n\t\t\tif ( timerId ) {\n\t\t\t\twindow.clearTimeout( timerId );\n\t\t\t}\n\t\t};\n\t}, [] );\n\n\tif ( ! blocks || blocks.length === 0 ) {\n\t\treturn null;\n\t}\n\n\tconst previewStyles = {\n\t\ttransform: `scale(${ previewScale })`,\n\t\tvisibility: isReady ? 'visible' : 'hidden',\n\t\tleft: x,\n\t\ttop: y,\n\t\twidth: viewportWidth,\n\t};\n\n\treturn (\n\t\t<div\n\t\t\tref={ previewRef }\n\t\t\tclassName={ classnames( 'block-editor-block-preview__container editor-styles-wrapper', {\n\t\t\t\t'is-ready': isReady,\n\t\t\t} ) }\n\t\t\taria-hidden\n\t\t>\n\t\t\t<Disabled style={ previewStyles } className=\"block-editor-block-preview__content\">\n\t\t\t\t<BlockList />\n\t\t\t</Disabled>\n\t\t</div>\n\t);\n}\n\nexport function BlockPreview( { blocks, viewportWidth = 700, padding, settings } ) {\n\tconst renderedBlocks = useMemo( () => castArray( blocks ), [ blocks ] );\n\tconst [ recompute, triggerRecompute ] = useReducer( ( state ) => state + 1, 0 );\n\tuseLayoutEffect( triggerRecompute, [ blocks ] );\n\treturn (\n\t\t<BlockEditorProvider\n\t\t\tvalue={ renderedBlocks }\n\t\t\tsettings={ settings }\n\t\t>\n\t\t\t{\n\t\t\t\t/*\n\t\t\t\t * The key prop is used to force recomputing the preview\n\t\t\t\t * by remounting the component, ScaledBlockPreview is not meant to\n\t\t\t\t * be rerendered.\n\t\t\t\t */\n\t\t\t}\n\t\t\t<ScaledBlockPreview\n\t\t\t\tkey={ recompute }\n\t\t\t\tblocks={ renderedBlocks }\n\t\t\t\tviewportWidth={ viewportWidth }\n\t\t\t\tpadding={ padding }\n\t\t\t/>\n\t\t</BlockEditorProvider>\n\t);\n}\n\n/**\n * BlockPreview renders a preview of a block or array of blocks.\n *\n * @see https://github.com/WordPress/gutenberg/blob/master/packages/block-editor/src/components/block-preview/README.md\n *\n * @param {Array|Object} blocks A block instance (object) or an array of blocks to be previewed.\n * @param {number} viewportWidth Width of the preview container in pixels. Controls at what size the blocks will be rendered inside the preview. Default: 700.\n * @return {WPElement} Rendered element.\n */\nexport default withSelect( ( select ) => {\n\treturn {\n\t\tsettings: select( 'core/block-editor' ).getSettings(),\n\t};\n} )( BlockPreview );\n"]}