{"version":3,"sources":["@wordpress/format-library/src/image/index.js"],"names":["ALLOWED_MEDIA_TYPES","name","title","stopKeyPropagation","event","stopPropagation","PopoverAtImage","dependencies","props","image","keywords","object","tagName","className","attributes","style","url","alt","edit","arguments","onChange","bind","onKeyDown","openModal","closeModal","state","modal","width","setState","LEFT","DOWN","RIGHT","UP","BACKSPACE","ENTER","indexOf","keyCode","value","isObjectActive","activeObjectAttributes","id","type","Math","min","open","start","newReplacements","replacements","slice","preventDefault","previousStyle","undefined","replace","Component"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { Path, SVG, TextControl, Popover, IconButton } from '@wordpress/components';\nimport { __ } from '@wordpress/i18n';\nimport { Component, useMemo } from '@wordpress/element';\nimport { insertObject } from '@wordpress/rich-text';\nimport { MediaUpload, RichTextToolbarButton, MediaUploadCheck } from '@wordpress/block-editor';\nimport { LEFT, RIGHT, UP, DOWN, BACKSPACE, ENTER } from '@wordpress/keycodes';\nimport { computeCaretRect } from '@wordpress/dom';\n\nconst ALLOWED_MEDIA_TYPES = [ 'image' ];\n\nconst name = 'core/image';\nconst title = __( 'Inline image' );\n\nconst stopKeyPropagation = ( event ) => event.stopPropagation();\n\nconst PopoverAtImage = ( { dependencies, ...props } ) => {\n\treturn (\n\t\t<Popover\n\t\t\tposition=\"bottom center\"\n\t\t\tfocusOnMount={ false }\n\t\t\tanchorRect={ useMemo( () => computeCaretRect(), dependencies ) }\n\t\t\t{ ...props }\n\t\t/>\n\t);\n};\n\nexport const image = {\n\tname,\n\ttitle,\n\tkeywords: [ __( 'photo' ), __( 'media' ) ],\n\tobject: true,\n\ttagName: 'img',\n\tclassName: null,\n\tattributes: {\n\t\tclassName: 'class',\n\t\tstyle: 'style',\n\t\turl: 'src',\n\t\talt: 'alt',\n\t},\n\tedit: class ImageEdit extends Component {\n\t\tconstructor() {\n\t\t\tsuper( ...arguments );\n\t\t\tthis.onChange = this.onChange.bind( this );\n\t\t\tthis.onKeyDown = this.onKeyDown.bind( this );\n\t\t\tthis.openModal = this.openModal.bind( this );\n\t\t\tthis.closeModal = this.closeModal.bind( this );\n\t\t\tthis.state = {\n\t\t\t\tmodal: false,\n\t\t\t};\n\t\t}\n\n\t\tstatic getDerivedStateFromProps( props, state ) {\n\t\t\tconst { activeObjectAttributes: { style } } = props;\n\n\t\t\tif ( style === state.previousStyle ) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif ( ! style ) {\n\t\t\t\treturn {\n\t\t\t\t\twidth: undefined,\n\t\t\t\t\tpreviousStyle: style,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\twidth: style.replace( /\\D/g, '' ),\n\t\t\t\tpreviousStyle: style,\n\t\t\t};\n\t\t}\n\n\t\tonChange( width ) {\n\t\t\tthis.setState( { width } );\n\t\t}\n\n\t\tonKeyDown( event ) {\n\t\t\tif ( [ LEFT, DOWN, RIGHT, UP, BACKSPACE, ENTER ].indexOf( event.keyCode ) > -1 ) {\n\t\t\t\t// Stop the key event from propagating up to ObserveTyping.startTypingInTextField.\n\t\t\t\tevent.stopPropagation();\n\t\t\t}\n\t\t}\n\n\t\topenModal() {\n\t\t\tthis.setState( { modal: true } );\n\t\t}\n\n\t\tcloseModal() {\n\t\t\tthis.setState( { modal: false } );\n\t\t}\n\n\t\trender() {\n\t\t\tconst { value, onChange, isObjectActive, activeObjectAttributes } = this.props;\n\t\t\tconst { style } = activeObjectAttributes;\n\n\t\t\treturn (\n\t\t\t\t<MediaUploadCheck>\n\t\t\t\t\t<RichTextToolbarButton\n\t\t\t\t\t\ticon={ <SVG xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><Path d=\"M4 16h10c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v9c0 1.1.9 2 2 2zM4 5h10v9H4V5zm14 9v2h4v-2h-4zM2 20h20v-2H2v2zm6.4-8.8L7 9.4 5 12h8l-2.6-3.4-2 2.6z\" /></SVG> }\n\t\t\t\t\t\ttitle={ title }\n\t\t\t\t\t\tonClick={ this.openModal }\n\t\t\t\t\t\tisActive={ isObjectActive }\n\t\t\t\t\t/>\n\t\t\t\t\t{ this.state.modal && <MediaUpload\n\t\t\t\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\n\t\t\t\t\t\tonSelect={ ( { id, url, alt, width } ) => {\n\t\t\t\t\t\t\tthis.closeModal();\n\t\t\t\t\t\t\tonChange( insertObject( value, {\n\t\t\t\t\t\t\t\ttype: name,\n\t\t\t\t\t\t\t\tattributes: {\n\t\t\t\t\t\t\t\t\tclassName: `wp-image-${ id }`,\n\t\t\t\t\t\t\t\t\tstyle: `width: ${ Math.min( width, 150 ) }px;`,\n\t\t\t\t\t\t\t\t\turl,\n\t\t\t\t\t\t\t\t\talt,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t} ) );\n\t\t\t\t\t\t} }\n\t\t\t\t\t\tonClose={ this.closeModal }\n\t\t\t\t\t\trender={ ( { open } ) => {\n\t\t\t\t\t\t\topen();\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t} }\n\t\t\t\t\t/> }\n\t\t\t\t\t{ isObjectActive &&\n\t\t\t\t\t\t<PopoverAtImage\n\t\t\t\t\t\t\t// Reposition Popover when the selection changes or\n\t\t\t\t\t\t\t// when the width changes.\n\t\t\t\t\t\t\tdependencies={ [ style, value.start ] }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{ // Disable reason: KeyPress must be suppressed so the block doesn't hide the toolbar\n\t\t\t\t\t\t\t/* eslint-disable jsx-a11y/no-noninteractive-element-interactions */ }\n\t\t\t\t\t\t\t<form\n\t\t\t\t\t\t\t\tclassName=\"editor-format-toolbar__image-container-content block-editor-format-toolbar__image-container-content\"\n\t\t\t\t\t\t\t\tonKeyPress={ stopKeyPropagation }\n\t\t\t\t\t\t\t\tonKeyDown={ this.onKeyDown }\n\t\t\t\t\t\t\t\tonSubmit={ ( event ) => {\n\t\t\t\t\t\t\t\t\tconst newReplacements = value.replacements.slice();\n\n\t\t\t\t\t\t\t\t\tnewReplacements[ value.start ] = {\n\t\t\t\t\t\t\t\t\t\ttype: name,\n\t\t\t\t\t\t\t\t\t\tattributes: {\n\t\t\t\t\t\t\t\t\t\t\t...activeObjectAttributes,\n\t\t\t\t\t\t\t\t\t\t\tstyle: `width: ${ this.state.width }px;`,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\tonChange( {\n\t\t\t\t\t\t\t\t\t\t...value,\n\t\t\t\t\t\t\t\t\t\treplacements: newReplacements,\n\t\t\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<TextControl\n\t\t\t\t\t\t\t\t\tclassName=\"editor-format-toolbar__image-container-value block-editor-format-toolbar__image-container-value\"\n\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\tlabel={ __( 'Width' ) }\n\t\t\t\t\t\t\t\t\tvalue={ this.state.width }\n\t\t\t\t\t\t\t\t\tmin={ 1 }\n\t\t\t\t\t\t\t\t\tonChange={ this.onChange }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<IconButton icon=\"editor-break\" label={ __( 'Apply' ) } type=\"submit\" />\n\t\t\t\t\t\t\t</form>\n\t\t\t\t\t\t\t{ /* eslint-enable jsx-a11y/no-noninteractive-element-interactions */ }\n\t\t\t\t\t\t</PopoverAtImage>\n\t\t\t\t\t}\n\t\t\t\t</MediaUploadCheck>\n\t\t\t);\n\t\t}\n\t},\n};\n"]}