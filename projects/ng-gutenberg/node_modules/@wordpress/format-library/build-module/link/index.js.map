{"version":3,"sources":["@wordpress/format-library/src/link/index.js"],"names":["__","Component","withSpokenMessages","getTextContent","applyFormat","removeFormat","slice","isCollapsed","isURL","isEmail","RichTextToolbarButton","RichTextShortcut","decodeEntities","InlineLinkUI","name","title","link","tagName","className","attributes","url","target","__unstablePasteRule","value","html","plainText","pastedText","replace","trim","window","console","log","type","edit","arguments","addLink","bind","stopAddingLink","onRemoveFormat","state","addingLink","props","onChange","text","setState","speak","isActive","activeAttributes"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { Component } from '@wordpress/element';\nimport { withSpokenMessages } from '@wordpress/components';\nimport {\n\tgetTextContent,\n\tapplyFormat,\n\tremoveFormat,\n\tslice,\n\tisCollapsed,\n} from '@wordpress/rich-text';\nimport { isURL, isEmail } from '@wordpress/url';\nimport { RichTextToolbarButton, RichTextShortcut } from '@wordpress/block-editor';\nimport { decodeEntities } from '@wordpress/html-entities';\n\n/**\n * Internal dependencies\n */\nimport InlineLinkUI from './inline';\n\nconst name = 'core/link';\nconst title = __( 'Link' );\n\nexport const link = {\n\tname,\n\ttitle,\n\ttagName: 'a',\n\tclassName: null,\n\tattributes: {\n\t\turl: 'href',\n\t\ttarget: 'target',\n\t},\n\t__unstablePasteRule( value, { html, plainText } ) {\n\t\tif ( isCollapsed( value ) ) {\n\t\t\treturn value;\n\t\t}\n\n\t\tconst pastedText = ( html || plainText ).replace( /<[^>]+>/g, '' ).trim();\n\n\t\t// A URL was pasted, turn the selection into a link\n\t\tif ( ! isURL( pastedText ) ) {\n\t\t\treturn value;\n\t\t}\n\n\t\t// Allows us to ask for this information when we get a report.\n\t\twindow.console.log( 'Created link:\\n\\n', pastedText );\n\n\t\treturn applyFormat( value, {\n\t\t\ttype: name,\n\t\t\tattributes: {\n\t\t\t\turl: decodeEntities( pastedText ),\n\t\t\t},\n\t\t} );\n\t},\n\tedit: withSpokenMessages( class LinkEdit extends Component {\n\t\tconstructor() {\n\t\t\tsuper( ...arguments );\n\n\t\t\tthis.addLink = this.addLink.bind( this );\n\t\t\tthis.stopAddingLink = this.stopAddingLink.bind( this );\n\t\t\tthis.onRemoveFormat = this.onRemoveFormat.bind( this );\n\t\t\tthis.state = {\n\t\t\t\taddingLink: false,\n\t\t\t};\n\t\t}\n\n\t\taddLink() {\n\t\t\tconst { value, onChange } = this.props;\n\t\t\tconst text = getTextContent( slice( value ) );\n\n\t\t\tif ( text && isURL( text ) ) {\n\t\t\t\tonChange( applyFormat( value, { type: name, attributes: { url: text } } ) );\n\t\t\t} else if ( text && isEmail( text ) ) {\n\t\t\t\tonChange( applyFormat( value, { type: name, attributes: { url: `mailto:${ text }` } } ) );\n\t\t\t} else {\n\t\t\t\tthis.setState( { addingLink: true } );\n\t\t\t}\n\t\t}\n\n\t\tstopAddingLink() {\n\t\t\tthis.setState( { addingLink: false } );\n\t\t}\n\n\t\tonRemoveFormat() {\n\t\t\tconst { value, onChange, speak } = this.props;\n\n\t\t\tonChange( removeFormat( value, name ) );\n\t\t\tspeak( __( 'Link removed.' ), 'assertive' );\n\t\t}\n\n\t\trender() {\n\t\t\tconst { isActive, activeAttributes, value, onChange } = this.props;\n\n\t\t\treturn (\n\t\t\t\t<>\n\t\t\t\t\t<RichTextShortcut\n\t\t\t\t\t\ttype=\"primary\"\n\t\t\t\t\t\tcharacter=\"k\"\n\t\t\t\t\t\tonUse={ this.addLink }\n\t\t\t\t\t/>\n\t\t\t\t\t<RichTextShortcut\n\t\t\t\t\t\ttype=\"primaryShift\"\n\t\t\t\t\t\tcharacter=\"k\"\n\t\t\t\t\t\tonUse={ this.onRemoveFormat }\n\t\t\t\t\t/>\n\t\t\t\t\t{ isActive && <RichTextToolbarButton\n\t\t\t\t\t\tname=\"link\"\n\t\t\t\t\t\ticon=\"editor-unlink\"\n\t\t\t\t\t\ttitle={ __( 'Unlink' ) }\n\t\t\t\t\t\tonClick={ this.onRemoveFormat }\n\t\t\t\t\t\tisActive={ isActive }\n\t\t\t\t\t\tshortcutType=\"primaryShift\"\n\t\t\t\t\t\tshortcutCharacter=\"k\"\n\t\t\t\t\t/> }\n\t\t\t\t\t{ ! isActive && <RichTextToolbarButton\n\t\t\t\t\t\tname=\"link\"\n\t\t\t\t\t\ticon=\"admin-links\"\n\t\t\t\t\t\ttitle={ title }\n\t\t\t\t\t\tonClick={ this.addLink }\n\t\t\t\t\t\tisActive={ isActive }\n\t\t\t\t\t\tshortcutType=\"primary\"\n\t\t\t\t\t\tshortcutCharacter=\"k\"\n\t\t\t\t\t/> }\n\t\t\t\t\t<InlineLinkUI\n\t\t\t\t\t\taddingLink={ this.state.addingLink }\n\t\t\t\t\t\tstopAddingLink={ this.stopAddingLink }\n\t\t\t\t\t\tisActive={ isActive }\n\t\t\t\t\t\tactiveAttributes={ activeAttributes }\n\t\t\t\t\t\tvalue={ value }\n\t\t\t\t\t\tonChange={ onChange }\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t);\n\t\t}\n\t} ),\n};\n"]}