{"version":3,"sources":["@wordpress/editor/src/components/autosave-monitor/index.js"],"names":["Component","compose","withSelect","withDispatch","AutosaveMonitor","prevProps","props","isDirty","editsReference","isAutosaveable","isAutosaving","didAutosaveForEditsReference","toggleTimer","isPendingSave","interval","shouldThrottle","pendingSave","clearTimeout","setTimeout","autosave","select","ownProps","getReferenceByDistinctEdits","isEditedPostDirty","isEditedPostAutosaveable","isAutosavingPost","getEditorSettings","autosaveInterval","dispatch"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { compose } from '@wordpress/compose';\nimport { withSelect, withDispatch } from '@wordpress/data';\n\nexport class AutosaveMonitor extends Component {\n\tcomponentDidUpdate( prevProps ) {\n\t\tconst { isDirty, editsReference, isAutosaveable, isAutosaving } = this.props;\n\n\t\t// The edits reference is held for comparison to avoid scheduling an\n\t\t// autosave if an edit has not been made since the last autosave\n\t\t// completion. This is assigned when the autosave completes, and reset\n\t\t// when an edit occurs.\n\t\t//\n\t\t// See: https://github.com/WordPress/gutenberg/issues/12318\n\n\t\tif ( editsReference !== prevProps.editsReference ) {\n\t\t\tthis.didAutosaveForEditsReference = false;\n\t\t}\n\n\t\tif ( ! isAutosaving && prevProps.isAutosaving ) {\n\t\t\tthis.didAutosaveForEditsReference = true;\n\t\t}\n\n\t\tif (\n\t\t\tprevProps.isDirty !== isDirty ||\n\t\t\tprevProps.isAutosaveable !== isAutosaveable ||\n\t\t\tprevProps.editsReference !== editsReference\n\t\t) {\n\t\t\tthis.toggleTimer(\n\t\t\t\tisDirty &&\n\t\t\t\tisAutosaveable &&\n\t\t\t\t! this.didAutosaveForEditsReference\n\t\t\t);\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\tthis.toggleTimer( false );\n\t}\n\n\ttoggleTimer( isPendingSave ) {\n\t\tconst { interval, shouldThrottle = false } = this.props;\n\n\t\t// By default, AutosaveMonitor will wait for a pause in editing before\n\t\t// autosaving. In other words, its action is \"debounced\".\n\t\t//\n\t\t// The `shouldThrottle` props allows overriding this behaviour, thus\n\t\t// making the autosave action \"throttled\".\n\t\tif ( ! shouldThrottle && this.pendingSave ) {\n\t\t\tclearTimeout( this.pendingSave );\n\t\t\tdelete this.pendingSave;\n\t\t}\n\n\t\tif ( isPendingSave && ! ( shouldThrottle && this.pendingSave ) ) {\n\t\t\tthis.pendingSave = setTimeout(\n\t\t\t\t() => {\n\t\t\t\t\tthis.props.autosave();\n\t\t\t\t\tdelete this.pendingSave;\n\t\t\t\t},\n\t\t\t\tinterval * 1000\n\t\t\t);\n\t\t}\n\t}\n\n\trender() {\n\t\treturn null;\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select, ownProps ) => {\n\t\tconst {\n\t\t\tgetReferenceByDistinctEdits,\n\t\t} = select( 'core' );\n\n\t\tconst {\n\t\t\tisEditedPostDirty,\n\t\t\tisEditedPostAutosaveable,\n\t\t\tisAutosavingPost,\n\t\t\tgetEditorSettings,\n\t\t} = select( 'core/editor' );\n\n\t\tconst { interval = getEditorSettings().autosaveInterval } = ownProps;\n\n\t\treturn {\n\t\t\tisDirty: isEditedPostDirty(),\n\t\t\tisAutosaveable: isEditedPostAutosaveable(),\n\t\t\teditsReference: getReferenceByDistinctEdits(),\n\t\t\tisAutosaving: isAutosavingPost(),\n\t\t\tinterval,\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch, ownProps ) => ( {\n\t\tautosave() {\n\t\t\tconst { autosave = dispatch( 'core/editor' ).autosave } = ownProps;\n\t\t\tautosave();\n\t\t},\n\t} ) ),\n] )( AutosaveMonitor );\n"]}