{"version":3,"sources":["@wordpress/editor/src/components/provider/index.native.js"],"names":["RNReactNativeGutenbergBridge","subscribeParentGetHtml","subscribeParentToggleHTMLMode","subscribeUpdateHtml","subscribeSetFocusOnTitle","subscribeSetTitle","Component","parse","serialize","getUnregisteredTypeHandlerName","withDispatch","withSelect","compose","EditorProvider","NativeEditorProvider","props","arguments","post","setTitleRef","bind","subscriptionParentGetHtml","serializeToNativeAction","subscriptionParentToggleHTMLMode","toggleMode","subscriptionParentSetTitle","payload","editTitle","title","subscriptionParentUpdateHtml","updateHtmlAction","html","subscriptionParentSetFocusOnTitle","postTitleRef","focus","remove","prevProps","isReady","blocks","isUnsupportedBlock","name","unsupportedBlockNames","filter","map","block","attributes","originalName","editorDidMount","titleRef","mode","getEditedPostContent","hasChanges","raw","content","provideToNative_Html","parsed","resetEditorBlocksWithoutUndoLevel","switchMode","clearSelectedBlock","children","select","isEditorReady","__unstableIsEditorReady","getEditorBlocks","getEditedPostAttribute","getEditorMode","dispatch","editPost","resetEditorBlocks","switchEditorMode","__unstableShouldCreateUndoLevel"],"mappings":";;;;;;;;;;AAAA;;;AAGA,OAAOA,4BAAP,IACCC,sBADD,EAECC,6BAFD,EAGCC,mBAHD,EAICC,wBAJD,EAKCC,iBALD,QAMO,+BANP;AAQA;;;;AAGA,SAASC,SAAT,QAA0B,oBAA1B;AACA,SAASC,KAAT,EAAgBC,SAAhB,EAA2BC,8BAA3B,QAAiE,mBAAjE;AACA,SAASC,YAAT,EAAuBC,UAAvB,QAAyC,iBAAzC;AACA,SAASC,OAAT,QAAwB,oBAAxB;AAEA;;;;AAGA,OAAOC,cAAP,MAA2B,YAA3B;;IAEMC,oB;;;;;AACL,gCAAaC,KAAb,EAAqB;AAAA;;AAAA;;AACpB,+FAAUC,SAAV,GADoB,CAGpB;;AACA,UAAKC,IAAL,GAAYF,KAAK,CAACE,IAAlB;AAEA,UAAKC,WAAL,GAAmB,MAAKA,WAAL,CAAiBC,IAAjB,+BAAnB;AANoB;AAOpB;;;;wCAEmB;AAAA;;AACnB,WAAKC,yBAAL,GAAiCnB,sBAAsB,CAAE,YAAM;AAC9D,QAAA,MAAI,CAACoB,uBAAL;AACA,OAFsD,CAAvD;AAIA,WAAKC,gCAAL,GAAwCpB,6BAA6B,CAAE,YAAM;AAC5E,QAAA,MAAI,CAACqB,UAAL;AACA,OAFoE,CAArE;AAIA,WAAKC,0BAAL,GAAkCnB,iBAAiB,CAAE,UAAEoB,OAAF,EAAe;AACnE,QAAA,MAAI,CAACV,KAAL,CAAWW,SAAX,CAAsBD,OAAO,CAACE,KAA9B;AACA,OAFkD,CAAnD;AAIA,WAAKC,4BAAL,GAAoCzB,mBAAmB,CAAE,UAAEsB,OAAF,EAAe;AACvE,QAAA,MAAI,CAACI,gBAAL,CAAuBJ,OAAO,CAACK,IAA/B;AACA,OAFsD,CAAvD;AAIA,WAAKC,iCAAL,GAAyC3B,wBAAwB,CAAE,YAAM;AACxE,YAAK,MAAI,CAAC4B,YAAV,EAAyB;AACxB,UAAA,MAAI,CAACA,YAAL,CAAkBC,KAAlB;AACA;AACD,OAJgE,CAAjE;AAKA;;;2CAEsB;AACtB,UAAK,KAAKb,yBAAV,EAAsC;AACrC,aAAKA,yBAAL,CAA+Bc,MAA/B;AACA;;AAED,UAAK,KAAKZ,gCAAV,EAA6C;AAC5C,aAAKA,gCAAL,CAAsCY,MAAtC;AACA;;AAED,UAAK,KAAKV,0BAAV,EAAuC;AACtC,aAAKA,0BAAL,CAAgCU,MAAhC;AACA;;AAED,UAAK,KAAKN,4BAAV,EAAyC;AACxC,aAAKA,4BAAL,CAAkCM,MAAlC;AACA;;AAED,UAAK,KAAKH,iCAAV,EAA8C;AAC7C,aAAKA,iCAAL,CAAuCG,MAAvC;AACA;AACD;;;uCAEmBC,S,EAAY;AAC/B,UAAK,CAAEA,SAAS,CAACC,OAAZ,IAAuB,KAAKrB,KAAL,CAAWqB,OAAvC,EAAiD;AAChD,YAAMC,MAAM,GAAG,KAAKtB,KAAL,CAAWsB,MAA1B;;AACA,YAAMC,kBAAkB,GAAG,SAArBA,kBAAqB;AAAA,cAAIC,IAAJ,QAAIA,IAAJ;AAAA,iBAAgBA,IAAI,KAAK9B,8BAA8B,EAAvD;AAAA,SAA3B;;AACA,YAAM+B,qBAAqB,GAAGH,MAAM,CAACI,MAAP,CAAeH,kBAAf,EAAoCI,GAApC,CAAyC,UAAEC,KAAF;AAAA,iBAAaA,KAAK,CAACC,UAAN,CAAiBC,YAA9B;AAAA,SAAzC,CAA9B;AACA7C,QAAAA,4BAA4B,CAAC8C,cAA7B,CAA6CN,qBAA7C;AACA;AACD;;;gCAEYO,Q,EAAW;AACvB,WAAKf,YAAL,GAAoBe,QAApB;AACA;;;8CAEyB;AACzB,UAAK,KAAKhC,KAAL,CAAWiC,IAAX,KAAoB,MAAzB,EAAkC;AACjC,aAAKnB,gBAAL,CAAuB,KAAKd,KAAL,CAAWkC,oBAAX,EAAvB;AACA;;AAED,UAAMnB,IAAI,GAAGtB,SAAS,CAAE,KAAKO,KAAL,CAAWsB,MAAb,CAAtB;AACA,UAAMV,KAAK,GAAG,KAAKZ,KAAL,CAAWY,KAAzB;AAEA,UAAMuB,UAAU,GAAGvB,KAAK,KAAK,KAAKV,IAAL,CAAUU,KAAV,CAAgBwB,GAA1B,IAAiCrB,IAAI,KAAK,KAAKb,IAAL,CAAUmC,OAAV,CAAkBD,GAA/E;AAEAnD,MAAAA,4BAA4B,CAACqD,oBAA7B,CAAmDvB,IAAnD,EAAyDH,KAAzD,EAAgEuB,UAAhE;;AAEA,UAAKA,UAAL,EAAkB;AACjB,aAAKjC,IAAL,CAAUU,KAAV,CAAgBwB,GAAhB,GAAsBxB,KAAtB;AACA,aAAKV,IAAL,CAAUmC,OAAV,CAAkBD,GAAlB,GAAwBrB,IAAxB;AACA;AACD;;;qCAEiBA,I,EAAO;AACxB,UAAMwB,MAAM,GAAG/C,KAAK,CAAEuB,IAAF,CAApB;AACA,WAAKf,KAAL,CAAWwC,iCAAX,CAA8CD,MAA9C;AACA;;;iCAEY;AAAA,wBACiB,KAAKvC,KADtB;AAAA,UACJiC,IADI,eACJA,IADI;AAAA,UACEQ,UADF,eACEA,UADF,EAEZ;;AACA,WAAKnC,uBAAL,GAHY,CAIZ;;AACA,WAAKN,KAAL,CAAW0C,kBAAX;AACAD,MAAAA,UAAU,CAAER,IAAI,KAAK,QAAT,GAAoB,MAApB,GAA6B,QAA/B,CAAV;AACA;;;6BAEQ;AAAA,yBAKJ,KAAKjC,KALD;AAAA,UAEP2C,QAFO,gBAEPA,QAFO;AAAA,UAGPzC,IAHO,gBAGPA,IAHO;AAAA,UAIJF,KAJI;;AAOR,aACC,cAAC,cAAD;AAAgB,QAAA,IAAI,EAAG,KAAKE;AAA5B,SAAwCF,KAAxC,GACG2C,QADH,CADD;AAKA;;;;EAjHiCpD,S;;AAoHnC,eAAeM,OAAO,CAAE,CACvBD,UAAU,CAAE,UAAEgD,MAAF,EAAc;AAAA,gBAMrBA,MAAM,CAAE,aAAF,CANe;AAAA,MAECC,aAFD,WAExBC,uBAFwB;AAAA,MAGxBC,eAHwB,WAGxBA,eAHwB;AAAA,MAIxBC,sBAJwB,WAIxBA,sBAJwB;AAAA,MAKxBd,oBALwB,WAKxBA,oBALwB;;AAAA,iBASrBU,MAAM,CAAE,gBAAF,CATe;AAAA,MAQxBK,aARwB,YAQxBA,aARwB;;AAWzB,SAAO;AACNhB,IAAAA,IAAI,EAAEgB,aAAa,EADb;AAEN5B,IAAAA,OAAO,EAAEwB,aAAa,EAFhB;AAGNvB,IAAAA,MAAM,EAAEyB,eAAe,EAHjB;AAINnC,IAAAA,KAAK,EAAEoC,sBAAsB,CAAE,OAAF,CAJvB;AAKNd,IAAAA,oBAAoB,EAApBA;AALM,GAAP;AAOA,CAlBS,CADa,EAoBvBvC,YAAY,CAAE,UAAEuD,QAAF,EAAgB;AAAA,kBAIzBA,QAAQ,CAAE,aAAF,CAJiB;AAAA,MAE5BC,QAF4B,aAE5BA,QAF4B;AAAA,MAG5BC,iBAH4B,aAG5BA,iBAH4B;;AAAA,mBAOzBF,QAAQ,CAAE,mBAAF,CAPiB;AAAA,MAM5BR,kBAN4B,cAM5BA,kBAN4B;;AAAA,mBAUzBQ,QAAQ,CAAE,gBAAF,CAViB;AAAA,MAS5BG,gBAT4B,cAS5BA,gBAT4B;;AAY7B,SAAO;AACNX,IAAAA,kBAAkB,EAAlBA,kBADM;AAEN/B,IAAAA,SAFM,qBAEKC,KAFL,EAEa;AAClBuC,MAAAA,QAAQ,CAAE;AAAEvC,QAAAA,KAAK,EAALA;AAAF,OAAF,CAAR;AACA,KAJK;AAKN4B,IAAAA,iCALM,6CAK6BlB,MAL7B,EAKsC;AAC3C8B,MAAAA,iBAAiB,CAAE9B,MAAF,EAAU;AAC1BgC,QAAAA,+BAA+B,EAAE;AADP,OAAV,CAAjB;AAGA,KATK;AAUNb,IAAAA,UAVM,sBAUMR,IAVN,EAUa;AAClBoB,MAAAA,gBAAgB,CAAEpB,IAAF,CAAhB;AACA;AAZK,GAAP;AAcA,CA1BW,CApBW,CAAF,CAAP,CA+CVlC,oBA/CU,CAAf","sourcesContent":["/**\n * External dependencies\n */\nimport RNReactNativeGutenbergBridge, {\n\tsubscribeParentGetHtml,\n\tsubscribeParentToggleHTMLMode,\n\tsubscribeUpdateHtml,\n\tsubscribeSetFocusOnTitle,\n\tsubscribeSetTitle,\n} from 'react-native-gutenberg-bridge';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { parse, serialize, getUnregisteredTypeHandlerName } from '@wordpress/blocks';\nimport { withDispatch, withSelect } from '@wordpress/data';\nimport { compose } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport EditorProvider from './index.js';\n\nclass NativeEditorProvider extends Component {\n\tconstructor( props ) {\n\t\tsuper( ...arguments );\n\n\t\t// Keep a local reference to `post` to detect changes\n\t\tthis.post = props.post;\n\n\t\tthis.setTitleRef = this.setTitleRef.bind( this );\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.subscriptionParentGetHtml = subscribeParentGetHtml( () => {\n\t\t\tthis.serializeToNativeAction();\n\t\t} );\n\n\t\tthis.subscriptionParentToggleHTMLMode = subscribeParentToggleHTMLMode( () => {\n\t\t\tthis.toggleMode();\n\t\t} );\n\n\t\tthis.subscriptionParentSetTitle = subscribeSetTitle( ( payload ) => {\n\t\t\tthis.props.editTitle( payload.title );\n\t\t} );\n\n\t\tthis.subscriptionParentUpdateHtml = subscribeUpdateHtml( ( payload ) => {\n\t\t\tthis.updateHtmlAction( payload.html );\n\t\t} );\n\n\t\tthis.subscriptionParentSetFocusOnTitle = subscribeSetFocusOnTitle( () => {\n\t\t\tif ( this.postTitleRef ) {\n\t\t\t\tthis.postTitleRef.focus();\n\t\t\t}\n\t\t} );\n\t}\n\n\tcomponentWillUnmount() {\n\t\tif ( this.subscriptionParentGetHtml ) {\n\t\t\tthis.subscriptionParentGetHtml.remove();\n\t\t}\n\n\t\tif ( this.subscriptionParentToggleHTMLMode ) {\n\t\t\tthis.subscriptionParentToggleHTMLMode.remove();\n\t\t}\n\n\t\tif ( this.subscriptionParentSetTitle ) {\n\t\t\tthis.subscriptionParentSetTitle.remove();\n\t\t}\n\n\t\tif ( this.subscriptionParentUpdateHtml ) {\n\t\t\tthis.subscriptionParentUpdateHtml.remove();\n\t\t}\n\n\t\tif ( this.subscriptionParentSetFocusOnTitle ) {\n\t\t\tthis.subscriptionParentSetFocusOnTitle.remove();\n\t\t}\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tif ( ! prevProps.isReady && this.props.isReady ) {\n\t\t\tconst blocks = this.props.blocks;\n\t\t\tconst isUnsupportedBlock = ( { name } ) => name === getUnregisteredTypeHandlerName();\n\t\t\tconst unsupportedBlockNames = blocks.filter( isUnsupportedBlock ).map( ( block ) => block.attributes.originalName );\n\t\t\tRNReactNativeGutenbergBridge.editorDidMount( unsupportedBlockNames );\n\t\t}\n\t}\n\n\tsetTitleRef( titleRef ) {\n\t\tthis.postTitleRef = titleRef;\n\t}\n\n\tserializeToNativeAction() {\n\t\tif ( this.props.mode === 'text' ) {\n\t\t\tthis.updateHtmlAction( this.props.getEditedPostContent() );\n\t\t}\n\n\t\tconst html = serialize( this.props.blocks );\n\t\tconst title = this.props.title;\n\n\t\tconst hasChanges = title !== this.post.title.raw || html !== this.post.content.raw;\n\n\t\tRNReactNativeGutenbergBridge.provideToNative_Html( html, title, hasChanges );\n\n\t\tif ( hasChanges ) {\n\t\t\tthis.post.title.raw = title;\n\t\t\tthis.post.content.raw = html;\n\t\t}\n\t}\n\n\tupdateHtmlAction( html ) {\n\t\tconst parsed = parse( html );\n\t\tthis.props.resetEditorBlocksWithoutUndoLevel( parsed );\n\t}\n\n\ttoggleMode() {\n\t\tconst { mode, switchMode } = this.props;\n\t\t// refresh html content first\n\t\tthis.serializeToNativeAction();\n\t\t// make sure to blur the selected block and dismiss the keyboard\n\t\tthis.props.clearSelectedBlock();\n\t\tswitchMode( mode === 'visual' ? 'text' : 'visual' );\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tchildren,\n\t\t\tpost, // eslint-disable-line no-unused-vars\n\t\t\t...props\n\t\t} = this.props;\n\n\t\treturn (\n\t\t\t<EditorProvider post={ this.post } { ...props }>\n\t\t\t\t{ children }\n\t\t\t</EditorProvider>\n\t\t);\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select ) => {\n\t\tconst {\n\t\t\t__unstableIsEditorReady: isEditorReady,\n\t\t\tgetEditorBlocks,\n\t\t\tgetEditedPostAttribute,\n\t\t\tgetEditedPostContent,\n\t\t} = select( 'core/editor' );\n\t\tconst {\n\t\t\tgetEditorMode,\n\t\t} = select( 'core/edit-post' );\n\n\t\treturn {\n\t\t\tmode: getEditorMode(),\n\t\t\tisReady: isEditorReady(),\n\t\t\tblocks: getEditorBlocks(),\n\t\t\ttitle: getEditedPostAttribute( 'title' ),\n\t\t\tgetEditedPostContent,\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch ) => {\n\t\tconst {\n\t\t\teditPost,\n\t\t\tresetEditorBlocks,\n\t\t} = dispatch( 'core/editor' );\n\t\tconst {\n\t\t\tclearSelectedBlock,\n\t\t} = dispatch( 'core/block-editor' );\n\t\tconst {\n\t\t\tswitchEditorMode,\n\t\t} = dispatch( 'core/edit-post' );\n\n\t\treturn {\n\t\t\tclearSelectedBlock,\n\t\t\teditTitle( title ) {\n\t\t\t\teditPost( { title } );\n\t\t\t},\n\t\t\tresetEditorBlocksWithoutUndoLevel( blocks ) {\n\t\t\t\tresetEditorBlocks( blocks, {\n\t\t\t\t\t__unstableShouldCreateUndoLevel: false,\n\t\t\t\t} );\n\t\t\t},\n\t\t\tswitchMode( mode ) {\n\t\t\t\tswitchEditorMode( mode );\n\t\t\t},\n\t\t};\n\t} ),\n] )( NativeEditorProvider );\n"]}