{"version":3,"sources":["@wordpress/block-library/src/image/edit.native.js"],"names":["React","View","ImageBackground","Text","TouchableWithoutFeedback","Dimensions","requestMediaImport","mediaUploadSync","requestImageFailedRetryDialog","requestImageUploadCancelDialog","isEmpty","BottomSheet","Icon","Toolbar","ToolbarButton","Caption","MediaPlaceholder","MediaUpload","MEDIA_TYPE_IMAGE","BlockControls","InspectorControls","__","sprintf","isURL","doAction","hasAction","styles","MediaUploadProgress","SvgIcon","SvgIconRetry","LINK_DESTINATION_CUSTOM","LINK_DESTINATION_NONE","IMAGE_ASPECT_RATIO","ImageEdit","props","state","showSettings","isCaptionSelected","finishMediaUploadWithSuccess","bind","finishMediaUploadWithFailure","mediaUploadStateReset","onSelectMediaUploadOption","updateMediaProgress","updateAlt","updateImageURL","onSetLinkDestination","onImagePressed","onClearSettings","onFocusCaption","attributes","setAttributes","id","url","console","warn","indexOf","mediaId","mediaUri","isUploadInProgress","setState","payload","mediaUrl","mediaServerId","newAlt","alt","width","undefined","height","href","linkDestination","onFocus","isRetryIcon","iconRetry","icon","isSelected","onImageSettingsButtonPressed","onImageSettingsClose","getToolbarEditButton","open","getInspectorControls","clearSettingsButton","flex","getIcon","imageContainerHeight","get","getImageComponent","openMediaOptions","getMediaOptions","isUploadFailed","finalWidth","finalHeight","imageWidthWithinContainer","retryMessage","opacity","iconContainer","modalIcon","imageContainer","uri","backgroundColor","uploadFailedText","clientId","caption","onBlur","Component"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport React from 'react';\nimport { View, ImageBackground, Text, TouchableWithoutFeedback, Dimensions } from 'react-native';\nimport {\n\trequestMediaImport,\n\tmediaUploadSync,\n\trequestImageFailedRetryDialog,\n\trequestImageUploadCancelDialog,\n} from 'react-native-gutenberg-bridge';\nimport { isEmpty } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport {\n\tBottomSheet,\n\tIcon,\n\tToolbar,\n\tToolbarButton,\n} from '@wordpress/components';\nimport {\n\tCaption,\n\tMediaPlaceholder,\n\tMediaUpload,\n\tMEDIA_TYPE_IMAGE,\n\tBlockControls,\n\tInspectorControls,\n} from '@wordpress/block-editor';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { isURL } from '@wordpress/url';\nimport { doAction, hasAction } from '@wordpress/hooks';\n\n/**\n * Internal dependencies\n */\nimport styles from './styles.scss';\nimport MediaUploadProgress from './media-upload-progress';\nimport SvgIcon from './icon';\nimport SvgIconRetry from './icon-retry';\n\nconst LINK_DESTINATION_CUSTOM = 'custom';\nconst LINK_DESTINATION_NONE = 'none';\n\n// Default Image ratio 4:3\nconst IMAGE_ASPECT_RATIO = 4 / 3;\n\nclass ImageEdit extends React.Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\n\t\tthis.state = {\n\t\t\tshowSettings: false,\n\t\t\tisCaptionSelected: false,\n\t\t};\n\n\t\tthis.finishMediaUploadWithSuccess = this.finishMediaUploadWithSuccess.bind( this );\n\t\tthis.finishMediaUploadWithFailure = this.finishMediaUploadWithFailure.bind( this );\n\t\tthis.mediaUploadStateReset = this.mediaUploadStateReset.bind( this );\n\t\tthis.onSelectMediaUploadOption = this.onSelectMediaUploadOption.bind( this );\n\t\tthis.updateMediaProgress = this.updateMediaProgress.bind( this );\n\t\tthis.updateAlt = this.updateAlt.bind( this );\n\t\tthis.updateImageURL = this.updateImageURL.bind( this );\n\t\tthis.onSetLinkDestination = this.onSetLinkDestination.bind( this );\n\t\tthis.onImagePressed = this.onImagePressed.bind( this );\n\t\tthis.onClearSettings = this.onClearSettings.bind( this );\n\t\tthis.onFocusCaption = this.onFocusCaption.bind( this );\n\t}\n\n\tcomponentDidMount() {\n\t\tconst { attributes, setAttributes } = this.props;\n\n\t\t// This will warn when we have `id` defined, while `url` is undefined.\n\t\t// This may help track this issue: https://github.com/wordpress-mobile/WordPress-Android/issues/9768\n\t\t// where a cancelled image upload was resulting in a subsequent crash.\n\t\tif ( attributes.id && ! attributes.url ) {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.warn( 'Attributes has id with no url.' );\n\t\t}\n\n\t\tif ( attributes.id && attributes.url && ! isURL( attributes.url ) ) {\n\t\t\tif ( attributes.url.indexOf( 'file:' ) === 0 ) {\n\t\t\t\trequestMediaImport( attributes.url, ( mediaId, mediaUri ) => {\n\t\t\t\t\tif ( mediaUri ) {\n\t\t\t\t\t\tsetAttributes( { url: mediaUri, id: mediaId } );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t\tmediaUploadSync();\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\t// this action will only exist if the user pressed the trash button on the block holder\n\t\tif ( hasAction( 'blocks.onRemoveBlockCheckUpload' ) && this.state.isUploadInProgress ) {\n\t\t\tdoAction( 'blocks.onRemoveBlockCheckUpload', this.props.attributes.id );\n\t\t}\n\t}\n\n\tstatic getDerivedStateFromProps( props, state ) {\n\t\t// Avoid a UI flicker in the toolbar by insuring that isCaptionSelected\n\t\t// is updated immediately any time the isSelected prop becomes false\n\t\treturn {\n\t\t\tisCaptionSelected: props.isSelected && state.isCaptionSelected,\n\t\t};\n\t}\n\n\tonImagePressed() {\n\t\tconst { attributes } = this.props;\n\n\t\tif ( this.state.isUploadInProgress ) {\n\t\t\trequestImageUploadCancelDialog( attributes.id );\n\t\t} else if ( attributes.id && ! isURL( attributes.url ) ) {\n\t\t\trequestImageFailedRetryDialog( attributes.id );\n\t\t}\n\n\t\tthis.setState( {\n\t\t\tisCaptionSelected: false,\n\t\t} );\n\t}\n\n\tupdateMediaProgress( payload ) {\n\t\tconst { setAttributes } = this.props;\n\t\tif ( payload.mediaUrl ) {\n\t\t\tsetAttributes( { url: payload.mediaUrl } );\n\t\t}\n\n\t\tif ( ! this.state.isUploadInProgress ) {\n\t\t\tthis.setState( { isUploadInProgress: true } );\n\t\t}\n\t}\n\n\tfinishMediaUploadWithSuccess( payload ) {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { url: payload.mediaUrl, id: payload.mediaServerId } );\n\t\tthis.setState( { isUploadInProgress: false } );\n\t}\n\n\tfinishMediaUploadWithFailure( payload ) {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { id: payload.mediaId } );\n\t\tthis.setState( { isUploadInProgress: false } );\n\t}\n\n\tmediaUploadStateReset() {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { id: null, url: null } );\n\t\tthis.setState( { isUploadInProgress: false } );\n\t}\n\n\tupdateAlt( newAlt ) {\n\t\tthis.props.setAttributes( { alt: newAlt } );\n\t}\n\n\tupdateImageURL( url ) {\n\t\tthis.props.setAttributes( { url, width: undefined, height: undefined } );\n\t}\n\n\tonSetLinkDestination( href ) {\n\t\tthis.props.setAttributes( {\n\t\t\tlinkDestination: LINK_DESTINATION_CUSTOM,\n\t\t\thref,\n\t\t} );\n\t}\n\n\tonClearSettings() {\n\t\tthis.props.setAttributes( {\n\t\t\talt: '',\n\t\t\tlinkDestination: LINK_DESTINATION_NONE,\n\t\t\thref: undefined,\n\t\t} );\n\t}\n\n\tonSelectMediaUploadOption( mediaId, mediaUrl ) {\n\t\tconst { setAttributes } = this.props;\n\t\tsetAttributes( { url: mediaUrl, id: mediaId } );\n\t}\n\n\tonFocusCaption() {\n\t\tif ( this.props.onFocus ) {\n\t\t\tthis.props.onFocus();\n\t\t}\n\t\tif ( ! this.state.isCaptionSelected ) {\n\t\t\tthis.setState( {\n\t\t\t\tisCaptionSelected: true,\n\t\t\t} );\n\t\t}\n\t}\n\n\tgetIcon( isRetryIcon ) {\n\t\tif ( isRetryIcon ) {\n\t\t\treturn <Icon icon={ SvgIconRetry } { ...styles.iconRetry } />;\n\t\t}\n\n\t\treturn <Icon icon={ SvgIcon } { ...styles.icon } />;\n\t}\n\n\trender() {\n\t\tconst { attributes, isSelected } = this.props;\n\t\tconst { url, height, width, alt, href, id } = attributes;\n\n\t\tconst onImageSettingsButtonPressed = () => {\n\t\t\tthis.setState( { showSettings: true } );\n\t\t};\n\n\t\tconst onImageSettingsClose = () => {\n\t\t\tthis.setState( { showSettings: false } );\n\t\t};\n\n\t\tconst getToolbarEditButton = ( open ) => (\n\t\t\t<BlockControls>\n\t\t\t\t<Toolbar>\n\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\ttitle={ __( 'Edit image' ) }\n\t\t\t\t\t\ticon=\"edit\"\n\t\t\t\t\t\tonClick={ open }\n\t\t\t\t\t/>\n\t\t\t\t</Toolbar>\n\t\t\t</BlockControls>\n\t\t);\n\n\t\tconst getInspectorControls = () => (\n\t\t\t<BottomSheet\n\t\t\t\tisVisible={ this.state.showSettings }\n\t\t\t\tonClose={ onImageSettingsClose }\n\t\t\t\thideHeader\n\t\t\t>\n\t\t\t\t<BottomSheet.Cell\n\t\t\t\t\ticon={ 'admin-links' }\n\t\t\t\t\tlabel={ __( 'Link To' ) }\n\t\t\t\t\tvalue={ href || '' }\n\t\t\t\t\tvaluePlaceholder={ __( 'Add URL' ) }\n\t\t\t\t\tonChangeValue={ this.onSetLinkDestination }\n\t\t\t\t\tautoCapitalize=\"none\"\n\t\t\t\t\tautoCorrect={ false }\n\t\t\t\t\tkeyboardType=\"url\"\n\t\t\t\t/>\n\t\t\t\t<BottomSheet.Cell\n\t\t\t\t\ticon={ 'editor-textcolor' }\n\t\t\t\t\tlabel={ __( 'Alt Text' ) }\n\t\t\t\t\tvalue={ alt || '' }\n\t\t\t\t\tvaluePlaceholder={ __( 'None' ) }\n\t\t\t\t\tseparatorType={ 'fullWidth' }\n\t\t\t\t\tonChangeValue={ this.updateAlt }\n\t\t\t\t/>\n\t\t\t\t<BottomSheet.Cell\n\t\t\t\t\tlabel={ __( 'Clear All Settings' ) }\n\t\t\t\t\tlabelStyle={ styles.clearSettingsButton }\n\t\t\t\t\tseparatorType={ 'none' }\n\t\t\t\t\tonPress={ this.onClearSettings }\n\t\t\t\t/>\n\t\t\t</BottomSheet>\n\t\t);\n\n\t\tif ( ! url ) {\n\t\t\treturn (\n\t\t\t\t<View style={ { flex: 1 } } >\n\t\t\t\t\t<MediaPlaceholder\n\t\t\t\t\t\tmediaType={ MEDIA_TYPE_IMAGE }\n\t\t\t\t\t\tonSelectURL={ this.onSelectMediaUploadOption }\n\t\t\t\t\t\ticon={ this.getIcon( false ) }\n\t\t\t\t\t\tonFocus={ this.props.onFocus }\n\t\t\t\t\t/>\n\t\t\t\t</View>\n\t\t\t);\n\t\t}\n\n\t\tconst imageContainerHeight = Dimensions.get( 'window' ).width / IMAGE_ASPECT_RATIO;\n\t\tconst getImageComponent = ( openMediaOptions, getMediaOptions ) => (\n\t\t\t<TouchableWithoutFeedback\n\t\t\t\taccessible={ ! isSelected }\n\t\t\t\tonPress={ this.onImagePressed }\n\t\t\t\tonLongPress={ openMediaOptions }\n\t\t\t\tdisabled={ ! isSelected }\n\t\t\t>\n\t\t\t\t<View style={ { flex: 1 } }>\n\t\t\t\t\t{ getInspectorControls() }\n\t\t\t\t\t{ getMediaOptions() }\n\t\t\t\t\t{ ( ! this.state.isCaptionSelected ) &&\n\t\t\t\t\t\tgetToolbarEditButton( openMediaOptions )\n\t\t\t\t\t}\n\t\t\t\t\t<InspectorControls>\n\t\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\t\ttitle={ __( 'Image Settings' ) }\n\t\t\t\t\t\t\ticon=\"admin-generic\"\n\t\t\t\t\t\t\tonClick={ onImageSettingsButtonPressed }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</InspectorControls>\n\t\t\t\t\t<MediaUploadProgress\n\t\t\t\t\t\theight={ height }\n\t\t\t\t\t\twidth={ width }\n\t\t\t\t\t\tcoverUrl={ url }\n\t\t\t\t\t\tmediaId={ id }\n\t\t\t\t\t\tonUpdateMediaProgress={ this.updateMediaProgress }\n\t\t\t\t\t\tonFinishMediaUploadWithSuccess={ this.finishMediaUploadWithSuccess }\n\t\t\t\t\t\tonFinishMediaUploadWithFailure={ this.finishMediaUploadWithFailure }\n\t\t\t\t\t\tonMediaUploadStateReset={ this.mediaUploadStateReset }\n\t\t\t\t\t\trenderContent={ ( { isUploadInProgress, isUploadFailed, finalWidth, finalHeight, imageWidthWithinContainer, retryMessage } ) => {\n\t\t\t\t\t\t\tconst opacity = isUploadInProgress ? 0.3 : 1;\n\t\t\t\t\t\t\tconst icon = this.getIcon( isUploadFailed );\n\n\t\t\t\t\t\t\tconst iconContainer = (\n\t\t\t\t\t\t\t\t<View style={ styles.modalIcon }>\n\t\t\t\t\t\t\t\t\t{ icon }\n\t\t\t\t\t\t\t\t</View>\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<View style={ { flex: 1 } } >\n\t\t\t\t\t\t\t\t\t{ ! imageWidthWithinContainer &&\n\t\t\t\t\t\t\t\t\t\t<View style={ [ styles.imageContainer, { height: imageContainerHeight } ] } >\n\t\t\t\t\t\t\t\t\t\t\t{ this.getIcon( false ) }\n\t\t\t\t\t\t\t\t\t\t</View> }\n\t\t\t\t\t\t\t\t\t<ImageBackground\n\t\t\t\t\t\t\t\t\t\taccessible={ true }\n\t\t\t\t\t\t\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\t\t\t\t\t\t\taccessibilityLabel={ alt }\n\t\t\t\t\t\t\t\t\t\taccessibilityHint={ __( 'Double tap and hold to edit' ) }\n\t\t\t\t\t\t\t\t\t\taccessibilityRole={ 'imagebutton' }\n\t\t\t\t\t\t\t\t\t\tstyle={ { width: finalWidth, height: finalHeight, opacity } }\n\t\t\t\t\t\t\t\t\t\tresizeMethod=\"scale\"\n\t\t\t\t\t\t\t\t\t\tsource={ { uri: url } }\n\t\t\t\t\t\t\t\t\t\tkey={ url }\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{ isUploadFailed &&\n\t\t\t\t\t\t\t\t\t\t\t<View style={ [ styles.imageContainer, { flex: 1, backgroundColor: 'rgba(0, 0, 0, 0.5)' } ] } >\n\t\t\t\t\t\t\t\t\t\t\t\t{ iconContainer }\n\t\t\t\t\t\t\t\t\t\t\t\t<Text style={ styles.uploadFailedText }>{ retryMessage }</Text>\n\t\t\t\t\t\t\t\t\t\t\t</View>\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t</ImageBackground>\n\t\t\t\t\t\t\t\t</View>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} }\n\t\t\t\t\t/>\n\t\t\t\t\t<Caption\n\t\t\t\t\t\tclientId={ this.props.clientId }\n\t\t\t\t\t\tisSelected={ this.state.isCaptionSelected }\n\t\t\t\t\t\taccessible={ true }\n\t\t\t\t\t\taccessibilityLabelCreator={ ( caption ) =>\n\t\t\t\t\t\t\tisEmpty( caption ) ?\n\t\t\t\t\t\t\t/* translators: accessibility text. Empty image caption. */\n\t\t\t\t\t\t\t\t( 'Image caption. Empty' ) :\n\t\t\t\t\t\t\t\tsprintf(\n\t\t\t\t\t\t\t\t/* translators: accessibility text. %s: image caption. */\n\t\t\t\t\t\t\t\t\t__( 'Image caption. %s' ),\n\t\t\t\t\t\t\t\t\tcaption )\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonFocus={ this.onFocusCaption }\n\t\t\t\t\t\tonBlur={ this.props.onBlur } // always assign onBlur as props\n\t\t\t\t\t/>\n\t\t\t\t</View>\n\t\t\t</TouchableWithoutFeedback>\n\t\t);\n\n\t\treturn (\n\t\t\t<MediaUpload mediaType={ MEDIA_TYPE_IMAGE }\n\t\t\t\tonSelectURL={ this.onSelectMediaUploadOption }\n\t\t\t\trender={ ( { open, getMediaOptions } ) => {\n\t\t\t\t\treturn getImageComponent( open, getMediaOptions );\n\t\t\t\t} }\n\t\t\t/>\n\t\t);\n\t}\n}\n\nexport default ImageEdit;\n"]}