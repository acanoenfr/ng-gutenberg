{"version":3,"sources":["@wordpress/block-library/src/image/edit.js"],"names":["classnames","find","get","isEmpty","map","last","omit","pick","getBlobByURL","isBlobURL","revokeBlobURL","Button","ButtonGroup","ExternalLink","IconButton","MenuItem","NavigableMenu","PanelBody","Path","Rect","ResizableBox","SelectControl","Spinner","SVG","TextareaControl","TextControl","ToggleControl","Toolbar","withNotices","compose","LEFT","RIGHT","UP","DOWN","BACKSPACE","ENTER","withSelect","withDispatch","BlockAlignmentToolbar","BlockControls","BlockIcon","InspectorControls","MediaPlaceholder","URLPopover","RichText","Component","useCallback","useState","useRef","__","sprintf","getPath","withViewportMatch","speak","createUpgradedEmbedBlock","icon","ImageSize","MIN_SIZE","LINK_DESTINATION_NONE","LINK_DESTINATION_MEDIA","LINK_DESTINATION_ATTACHMENT","LINK_DESTINATION_CUSTOM","NEW_TAB_REL","ALLOWED_MEDIA_TYPES","DEFAULT_SIZE_SLUG","pickRelevantMediaFiles","image","imageProps","url","isTemporaryImage","id","isExternalImage","stopPropagation","event","stopPropagationRelevantKeys","indexOf","keyCode","ImageURLInputUI","advancedOptions","linkDestination","mediaLinks","onChangeUrl","isOpen","setIsOpen","openLinkUI","isEditingLink","setIsEditingLink","urlInput","setUrlInput","startEditLink","stopEditLink","closeLinkUI","autocompleteRef","onClickOutside","autocompleteElement","current","contains","target","onSubmitLinkChange","preventDefault","onLinkRemove","linkEditorValue","urlLabel","title","link","ImageEdit","attributes","arguments","updateAlt","bind","updateAlignment","onFocusCaption","onImageClick","onSelectImage","onSelectURL","updateImage","updateWidth","updateHeight","updateDimensions","onSetHref","onSetLinkClass","onSetLinkRel","onSetNewTab","getFilename","toggleIsEditing","onUploadError","onImageError","getLinkDestinations","state","captionFocused","isEditing","props","mediaUpload","noticeOperations","file","filesList","onFileChange","allowedTypes","onError","message","createErrorNotice","setState","prevProps","prevID","prevURL","isSelected","removeAllNotices","media","setAttributes","undefined","alt","caption","mediaAttributes","additionalAttributes","width","height","sizeSlug","newURL","embedBlock","onReplace","value","linkDestinations","linkDestinationInput","destination","href","linkClass","rel","linkTarget","updatedRel","newAlt","nextAlign","extraUpdatedAttributes","align","parseInt","path","split","source_url","imageSizes","name","slug","label","isLargeViewport","className","maxWidth","noticeUI","isRTL","onResizeStart","onResizeStop","isExternal","editImageIcon","controls","src","labels","instructions","mediaPreview","mediaPlaceholder","classes","isResizable","imageSizeOptions","getImageSizeOptions","getInspectorControls","imageWidth","imageHeight","scale","scaledWidth","Math","round","scaledHeight","isCurrent","sizes","imageWidthWithinContainer","imageHeightWithinContainer","filename","defaultedAlt","img","currentWidth","currentHeight","ratio","minWidth","minHeight","maxWidthBuffer","showRightHandle","showLeftHandle","top","right","bottom","left","direction","elt","delta","dispatch","toggleSelection","select","getMedia","getSettings","__experimentalMediaUpload"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\nimport {\n\tfind,\n\tget,\n\tisEmpty,\n\tmap,\n\tlast,\n\tomit,\n\tpick,\n} from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { getBlobByURL, isBlobURL, revokeBlobURL } from '@wordpress/blob';\nimport {\n\tButton,\n\tButtonGroup,\n\tExternalLink,\n\tIconButton,\n\tMenuItem,\n\tNavigableMenu,\n\tPanelBody,\n\tPath,\n\tRect,\n\tResizableBox,\n\tSelectControl,\n\tSpinner,\n\tSVG,\n\tTextareaControl,\n\tTextControl,\n\tToggleControl,\n\tToolbar,\n\twithNotices,\n} from '@wordpress/components';\nimport { compose } from '@wordpress/compose';\nimport {\n\tLEFT,\n\tRIGHT,\n\tUP,\n\tDOWN,\n\tBACKSPACE,\n\tENTER,\n} from '@wordpress/keycodes';\nimport { withSelect, withDispatch } from '@wordpress/data';\nimport {\n\tBlockAlignmentToolbar,\n\tBlockControls,\n\tBlockIcon,\n\tInspectorControls,\n\tMediaPlaceholder,\n\tURLPopover,\n\tRichText,\n} from '@wordpress/block-editor';\nimport {\n\tComponent,\n\tuseCallback,\n\tuseState,\n\tuseRef,\n} from '@wordpress/element';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { getPath } from '@wordpress/url';\nimport { withViewportMatch } from '@wordpress/viewport';\nimport { speak } from '@wordpress/a11y';\n\n/**\n * Internal dependencies\n */\nimport { createUpgradedEmbedBlock } from '../embed/util';\nimport icon from './icon';\nimport ImageSize from './image-size';\n\n/**\n * Module constants\n */\nconst MIN_SIZE = 20;\nconst LINK_DESTINATION_NONE = 'none';\nconst LINK_DESTINATION_MEDIA = 'media';\nconst LINK_DESTINATION_ATTACHMENT = 'attachment';\nconst LINK_DESTINATION_CUSTOM = 'custom';\nconst NEW_TAB_REL = 'noreferrer noopener';\nconst ALLOWED_MEDIA_TYPES = [ 'image' ];\nconst DEFAULT_SIZE_SLUG = 'large';\n\nexport const pickRelevantMediaFiles = ( image ) => {\n\tconst imageProps = pick( image, [ 'alt', 'id', 'link', 'caption' ] );\n\timageProps.url = get( image, [ 'sizes', 'large', 'url' ] ) || get( image, [ 'media_details', 'sizes', 'large', 'source_url' ] ) || image.url;\n\treturn imageProps;\n};\n\n/**\n * Is the URL a temporary blob URL? A blob URL is one that is used temporarily\n * while the image is being uploaded and will not have an id yet allocated.\n *\n * @param {number=} id The id of the image.\n * @param {string=} url The url of the image.\n *\n * @return {boolean} Is the URL a Blob URL\n */\nconst isTemporaryImage = ( id, url ) => ! id && isBlobURL( url );\n\n/**\n * Is the url for the image hosted externally. An externally hosted image has no id\n * and is not a blob url.\n *\n * @param {number=} id  The id of the image.\n * @param {string=} url The url of the image.\n *\n * @return {boolean} Is the url an externally hosted url?\n */\nconst isExternalImage = ( id, url ) => url && ! id && ! isBlobURL( url );\n\nconst stopPropagation = ( event ) => {\n\tevent.stopPropagation();\n};\n\nconst stopPropagationRelevantKeys = ( event ) => {\n\tif ( [ LEFT, DOWN, RIGHT, UP, BACKSPACE, ENTER ].indexOf( event.keyCode ) > -1 ) {\n\t\t// Stop the key event from propagating up to ObserveTyping.startTypingInTextField.\n\t\tevent.stopPropagation();\n\t}\n};\n\nconst ImageURLInputUI = ( {\n\tadvancedOptions,\n\tlinkDestination,\n\tmediaLinks,\n\tonChangeUrl,\n\turl,\n} ) => {\n\tconst [ isOpen, setIsOpen ] = useState( false );\n\tconst openLinkUI = useCallback( () => {\n\t\tsetIsOpen( true );\n\t} );\n\n\tconst [ isEditingLink, setIsEditingLink ] = useState( false );\n\tconst [ urlInput, setUrlInput ] = useState( null );\n\n\tconst startEditLink = useCallback( () => {\n\t\tif ( linkDestination === LINK_DESTINATION_MEDIA ||\n\t\t\tlinkDestination === LINK_DESTINATION_ATTACHMENT\n\t\t) {\n\t\t\tsetUrlInput( '' );\n\t\t}\n\t\tsetIsEditingLink( true );\n\t} );\n\tconst stopEditLink = useCallback( () => {\n\t\tsetIsEditingLink( false );\n\t} );\n\n\tconst closeLinkUI = useCallback( () => {\n\t\tsetUrlInput( null );\n\t\tstopEditLink();\n\t\tsetIsOpen( false );\n\t} );\n\n\tconst autocompleteRef = useRef( null );\n\n\tconst onClickOutside = useCallback( () => {\n\t\treturn ( event ) => {\n\t\t\t// The autocomplete suggestions list renders in a separate popover (in a portal),\n\t\t\t// so onClickOutside fails to detect that a click on a suggestion occurred in the\n\t\t\t// LinkContainer. Detect clicks on autocomplete suggestions using a ref here, and\n\t\t\t// return to avoid the popover being closed.\n\t\t\tconst autocompleteElement = autocompleteRef.current;\n\t\t\tif ( autocompleteElement && autocompleteElement.contains( event.target ) ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsetIsOpen( false );\n\t\t\tsetUrlInput( null );\n\t\t\tstopEditLink();\n\t\t};\n\t} );\n\n\tconst onSubmitLinkChange = useCallback( () => {\n\t\treturn ( event ) => {\n\t\t\tif ( urlInput ) {\n\t\t\t\tonChangeUrl( urlInput );\n\t\t\t}\n\t\t\tstopEditLink();\n\t\t\tsetUrlInput( null );\n\t\t\tevent.preventDefault();\n\t\t};\n\t} );\n\n\tconst onLinkRemove = useCallback( () => {\n\t\tcloseLinkUI();\n\t\tonChangeUrl( '' );\n\t} );\n\tconst linkEditorValue = urlInput !== null ? urlInput : url;\n\n\tconst urlLabel = (\n\t\tfind( mediaLinks, [ 'linkDestination', linkDestination ] ) || {}\n\t).title;\n\treturn (\n\t\t<>\n\t\t\t<IconButton\n\t\t\t\ticon=\"admin-links\"\n\t\t\t\tclassName=\"components-toolbar__control\"\n\t\t\t\tlabel={ url ? __( 'Edit link' ) : __( 'Insert link' ) }\n\t\t\t\taria-expanded={ isOpen }\n\t\t\t\tonClick={ openLinkUI }\n\t\t\t/>\n\t\t\t{ isOpen && (\n\t\t\t\t<URLPopover\n\t\t\t\t\tonClickOutside={ onClickOutside() }\n\t\t\t\t\tonClose={ closeLinkUI }\n\t\t\t\t\trenderSettings={ () => advancedOptions }\n\t\t\t\t\tadditionalControls={ ! linkEditorValue && (\n\t\t\t\t\t\t<NavigableMenu>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tmap( mediaLinks, ( link ) => (\n\t\t\t\t\t\t\t\t\t<MenuItem\n\t\t\t\t\t\t\t\t\t\tkey={ link.linkDestination }\n\t\t\t\t\t\t\t\t\t\ticon={ link.icon }\n\t\t\t\t\t\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t\t\t\t\t\tsetUrlInput( null );\n\t\t\t\t\t\t\t\t\t\t\tonChangeUrl( link.url );\n\t\t\t\t\t\t\t\t\t\t\tstopEditLink();\n\t\t\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{ link.title }\n\t\t\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t\t\t) )\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t</NavigableMenu>\n\t\t\t\t\t) }\n\t\t\t\t>\n\t\t\t\t\t{ ( ! url || isEditingLink ) && (\n\t\t\t\t\t\t<URLPopover.LinkEditor\n\t\t\t\t\t\t\tclassName=\"editor-format-toolbar__link-container-content block-editor-format-toolbar__link-container-content\"\n\t\t\t\t\t\t\tvalue={ linkEditorValue }\n\t\t\t\t\t\t\tonChangeInputValue={ setUrlInput }\n\t\t\t\t\t\t\tonKeyDown={ stopPropagationRelevantKeys }\n\t\t\t\t\t\t\tonKeyPress={ stopPropagation }\n\t\t\t\t\t\t\tonSubmit={ onSubmitLinkChange() }\n\t\t\t\t\t\t\tautocompleteRef={ autocompleteRef }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\t{ ( url && ! isEditingLink ) && (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<URLPopover.LinkViewer\n\t\t\t\t\t\t\t\tclassName=\"editor-format-toolbar__link-container-content block-editor-format-toolbar__link-container-content\"\n\t\t\t\t\t\t\t\tonKeyPress={ stopPropagation }\n\t\t\t\t\t\t\t\turl={ url }\n\t\t\t\t\t\t\t\tonEditLinkClick={ startEditLink }\n\t\t\t\t\t\t\t\turlLabel={ urlLabel }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\ticon=\"no\"\n\t\t\t\t\t\t\t\tlabel={ __( 'Remove link' ) }\n\t\t\t\t\t\t\t\tonClick={ onLinkRemove }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</>\n\t\t\t\t\t) }\n\t\t\t\t</URLPopover>\n\t\t\t) }\n\t\t</>\n\t);\n};\n\nexport class ImageEdit extends Component {\n\tconstructor( { attributes } ) {\n\t\tsuper( ...arguments );\n\t\tthis.updateAlt = this.updateAlt.bind( this );\n\t\tthis.updateAlignment = this.updateAlignment.bind( this );\n\t\tthis.onFocusCaption = this.onFocusCaption.bind( this );\n\t\tthis.onImageClick = this.onImageClick.bind( this );\n\t\tthis.onSelectImage = this.onSelectImage.bind( this );\n\t\tthis.onSelectURL = this.onSelectURL.bind( this );\n\t\tthis.updateImage = this.updateImage.bind( this );\n\t\tthis.updateWidth = this.updateWidth.bind( this );\n\t\tthis.updateHeight = this.updateHeight.bind( this );\n\t\tthis.updateDimensions = this.updateDimensions.bind( this );\n\t\tthis.onSetHref = this.onSetHref.bind( this );\n\t\tthis.onSetLinkClass = this.onSetLinkClass.bind( this );\n\t\tthis.onSetLinkRel = this.onSetLinkRel.bind( this );\n\t\tthis.onSetNewTab = this.onSetNewTab.bind( this );\n\t\tthis.getFilename = this.getFilename.bind( this );\n\t\tthis.toggleIsEditing = this.toggleIsEditing.bind( this );\n\t\tthis.onUploadError = this.onUploadError.bind( this );\n\t\tthis.onImageError = this.onImageError.bind( this );\n\t\tthis.getLinkDestinations = this.getLinkDestinations.bind( this );\n\n\t\tthis.state = {\n\t\t\tcaptionFocused: false,\n\t\t\tisEditing: ! attributes.url,\n\t\t};\n\t}\n\n\tcomponentDidMount() {\n\t\tconst {\n\t\t\tattributes,\n\t\t\tmediaUpload,\n\t\t\tnoticeOperations,\n\t\t} = this.props;\n\t\tconst { id, url = '' } = attributes;\n\n\t\tif ( isTemporaryImage( id, url ) ) {\n\t\t\tconst file = getBlobByURL( url );\n\n\t\t\tif ( file ) {\n\t\t\t\tmediaUpload( {\n\t\t\t\t\tfilesList: [ file ],\n\t\t\t\t\tonFileChange: ( [ image ] ) => {\n\t\t\t\t\t\tthis.onSelectImage( image );\n\t\t\t\t\t},\n\t\t\t\t\tallowedTypes: ALLOWED_MEDIA_TYPES,\n\t\t\t\t\tonError: ( message ) => {\n\t\t\t\t\t\tnoticeOperations.createErrorNotice( message );\n\t\t\t\t\t\tthis.setState( { isEditing: true } );\n\t\t\t\t\t},\n\t\t\t\t} );\n\t\t\t}\n\t\t}\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tconst { id: prevID, url: prevURL = '' } = prevProps.attributes;\n\t\tconst { id, url = '' } = this.props.attributes;\n\n\t\tif ( isTemporaryImage( prevID, prevURL ) && ! isTemporaryImage( id, url ) ) {\n\t\t\trevokeBlobURL( url );\n\t\t}\n\n\t\tif ( ! this.props.isSelected && prevProps.isSelected && this.state.captionFocused ) {\n\t\t\tthis.setState( {\n\t\t\t\tcaptionFocused: false,\n\t\t\t} );\n\t\t}\n\t}\n\n\tonUploadError( message ) {\n\t\tconst { noticeOperations } = this.props;\n\t\tnoticeOperations.removeAllNotices();\n\t\tnoticeOperations.createErrorNotice( message );\n\t\tthis.setState( {\n\t\t\tisEditing: true,\n\t\t} );\n\t}\n\n\tonSelectImage( media ) {\n\t\tif ( ! media || ! media.url ) {\n\t\t\tthis.props.setAttributes( {\n\t\t\t\turl: undefined,\n\t\t\t\talt: undefined,\n\t\t\t\tid: undefined,\n\t\t\t\tcaption: undefined,\n\t\t\t} );\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setState( {\n\t\t\tisEditing: false,\n\t\t} );\n\n\t\tconst { id, url, alt, caption } = this.props.attributes;\n\n\t\tlet mediaAttributes = pickRelevantMediaFiles( media );\n\n\t\t// If the current image is temporary but an alt or caption text was meanwhile written by the user,\n\t\t// make sure the text is not overwritten.\n\t\tif ( isTemporaryImage( id, url ) ) {\n\t\t\tif ( alt ) {\n\t\t\t\tmediaAttributes = omit( mediaAttributes, [ 'alt' ] );\n\t\t\t}\n\t\t\tif ( caption ) {\n\t\t\t\tmediaAttributes = omit( mediaAttributes, [ 'caption' ] );\n\t\t\t}\n\t\t}\n\n\t\tlet additionalAttributes;\n\t\t// Reset the dimension attributes if changing to a different image.\n\t\tif ( ! media.id || media.id !== id ) {\n\t\t\tadditionalAttributes = {\n\t\t\t\twidth: undefined,\n\t\t\t\theight: undefined,\n\t\t\t\tsizeSlug: DEFAULT_SIZE_SLUG,\n\t\t\t};\n\t\t} else {\n\t\t\t// Keep the same url when selecting the same file, so \"Image Size\" option is not changed.\n\t\t\tadditionalAttributes = { url };\n\t\t}\n\n\t\tthis.props.setAttributes( {\n\t\t\t...mediaAttributes,\n\t\t\t...additionalAttributes,\n\t\t} );\n\t}\n\n\tonSelectURL( newURL ) {\n\t\tconst { url } = this.props.attributes;\n\n\t\tif ( newURL !== url ) {\n\t\t\tthis.props.setAttributes( {\n\t\t\t\turl: newURL,\n\t\t\t\tid: undefined,\n\t\t\t\tsizeSlug: DEFAULT_SIZE_SLUG,\n\t\t\t} );\n\t\t}\n\n\t\tthis.setState( {\n\t\t\tisEditing: false,\n\t\t} );\n\t}\n\n\tonImageError( url ) {\n\t\t// Check if there's an embed block that handles this URL.\n\t\tconst embedBlock = createUpgradedEmbedBlock(\n\t\t\t{ attributes: { url } }\n\t\t);\n\t\tif ( undefined !== embedBlock ) {\n\t\t\tthis.props.onReplace( embedBlock );\n\t\t}\n\t}\n\n\tonSetHref( value ) {\n\t\tconst linkDestinations = this.getLinkDestinations();\n\t\tconst { attributes } = this.props;\n\t\tconst { linkDestination } = attributes;\n\t\tlet linkDestinationInput;\n\t\tif ( ! value ) {\n\t\t\tlinkDestinationInput = LINK_DESTINATION_NONE;\n\t\t} else {\n\t\t\tlinkDestinationInput = (\n\t\t\t\tfind( linkDestinations, ( destination ) => {\n\t\t\t\t\treturn destination.url === value;\n\t\t\t\t} ) ||\n\t\t\t\t{ linkDestination: LINK_DESTINATION_CUSTOM }\n\t\t\t).linkDestination;\n\t\t}\n\t\tif ( linkDestination !== linkDestinationInput ) {\n\t\t\tthis.props.setAttributes( {\n\t\t\t\tlinkDestination: linkDestinationInput,\n\t\t\t\thref: value,\n\t\t\t} );\n\t\t\treturn;\n\t\t}\n\t\tthis.props.setAttributes( { href: value } );\n\t}\n\n\tonSetLinkClass( value ) {\n\t\tthis.props.setAttributes( { linkClass: value } );\n\t}\n\n\tonSetLinkRel( value ) {\n\t\tthis.props.setAttributes( { rel: value } );\n\t}\n\n\tonSetNewTab( value ) {\n\t\tconst { rel } = this.props.attributes;\n\t\tconst linkTarget = value ? '_blank' : undefined;\n\n\t\tlet updatedRel = rel;\n\t\tif ( linkTarget && ! rel ) {\n\t\t\tupdatedRel = NEW_TAB_REL;\n\t\t} else if ( ! linkTarget && rel === NEW_TAB_REL ) {\n\t\t\tupdatedRel = undefined;\n\t\t}\n\n\t\tthis.props.setAttributes( {\n\t\t\tlinkTarget,\n\t\t\trel: updatedRel,\n\t\t} );\n\t}\n\n\tonFocusCaption() {\n\t\tif ( ! this.state.captionFocused ) {\n\t\t\tthis.setState( {\n\t\t\t\tcaptionFocused: true,\n\t\t\t} );\n\t\t}\n\t}\n\n\tonImageClick() {\n\t\tif ( this.state.captionFocused ) {\n\t\t\tthis.setState( {\n\t\t\t\tcaptionFocused: false,\n\t\t\t} );\n\t\t}\n\t}\n\n\tupdateAlt( newAlt ) {\n\t\tthis.props.setAttributes( { alt: newAlt } );\n\t}\n\n\tupdateAlignment( nextAlign ) {\n\t\tconst extraUpdatedAttributes = [ 'wide', 'full' ].indexOf( nextAlign ) !== -1 ?\n\t\t\t{ width: undefined, height: undefined } :\n\t\t\t{};\n\t\tthis.props.setAttributes( { ...extraUpdatedAttributes, align: nextAlign } );\n\t}\n\n\tupdateImage( sizeSlug ) {\n\t\tconst { image } = this.props;\n\n\t\tconst url = get( image, [ 'media_details', 'sizes', sizeSlug, 'source_url' ] );\n\t\tif ( ! url ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tthis.props.setAttributes( {\n\t\t\turl,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t\tsizeSlug,\n\t\t} );\n\t}\n\n\tupdateWidth( width ) {\n\t\tthis.props.setAttributes( { width: parseInt( width, 10 ) } );\n\t}\n\n\tupdateHeight( height ) {\n\t\tthis.props.setAttributes( { height: parseInt( height, 10 ) } );\n\t}\n\n\tupdateDimensions( width = undefined, height = undefined ) {\n\t\treturn () => {\n\t\t\tthis.props.setAttributes( { width, height } );\n\t\t};\n\t}\n\n\tgetFilename( url ) {\n\t\tconst path = getPath( url );\n\t\tif ( path ) {\n\t\t\treturn last( path.split( '/' ) );\n\t\t}\n\t}\n\n\tgetLinkDestinations() {\n\t\treturn [\n\t\t\t{\n\t\t\t\tlinkDestination: LINK_DESTINATION_MEDIA,\n\t\t\t\ttitle: __( 'Media File' ),\n\t\t\t\turl: ( this.props.image && this.props.image.source_url ) ||\n\t\t\t\t\tthis.props.attributes.url,\n\t\t\t\ticon,\n\t\t\t},\n\t\t\t{\n\t\t\t\tlinkDestination: LINK_DESTINATION_ATTACHMENT,\n\t\t\t\ttitle: __( 'Attachment Page' ),\n\t\t\t\turl: this.props.image && this.props.image.link,\n\t\t\t\ticon: <SVG viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><Path d=\"M0 0h24v24H0V0z\" fill=\"none\" /><Path d=\"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z\" /></SVG>,\n\t\t\t},\n\t\t];\n\t}\n\n\ttoggleIsEditing() {\n\t\tthis.setState( {\n\t\t\tisEditing: ! this.state.isEditing,\n\t\t} );\n\t\tif ( this.state.isEditing ) {\n\t\t\tspeak( __( 'You are now viewing the image in the image block.' ) );\n\t\t} else {\n\t\t\tspeak( __( 'You are now editing the image in the image block.' ) );\n\t\t}\n\t}\n\n\tgetImageSizeOptions() {\n\t\tconst { imageSizes } = this.props;\n\t\treturn map( imageSizes, ( { name, slug } ) => ( { value: slug, label: name } ) );\n\t}\n\n\trender() {\n\t\tconst { isEditing } = this.state;\n\t\tconst {\n\t\t\tattributes,\n\t\t\tsetAttributes,\n\t\t\tisLargeViewport,\n\t\t\tisSelected,\n\t\t\tclassName,\n\t\t\tmaxWidth,\n\t\t\tnoticeUI,\n\t\t\tisRTL,\n\t\t\tonResizeStart,\n\t\t\tonResizeStop,\n\t\t} = this.props;\n\t\tconst {\n\t\t\turl,\n\t\t\talt,\n\t\t\tcaption,\n\t\t\talign,\n\t\t\tid,\n\t\t\thref,\n\t\t\trel,\n\t\t\tlinkClass,\n\t\t\tlinkDestination,\n\t\t\twidth,\n\t\t\theight,\n\t\t\tlinkTarget,\n\t\t\tsizeSlug,\n\t\t} = attributes;\n\n\t\tconst isExternal = isExternalImage( id, url );\n\t\tconst editImageIcon = ( <SVG width={ 20 } height={ 20 } viewBox=\"0 0 20 20\"><Rect x={ 11 } y={ 3 } width={ 7 } height={ 5 } rx={ 1 } /><Rect x={ 2 } y={ 12 } width={ 7 } height={ 5 } rx={ 1 } /><Path d=\"M13,12h1a3,3,0,0,1-3,3v2a5,5,0,0,0,5-5h1L15,9Z\" /><Path d=\"M4,8H3l2,3L7,8H6A3,3,0,0,1,9,5V3A5,5,0,0,0,4,8Z\" /></SVG> );\n\t\tconst controls = (\n\t\t\t<BlockControls>\n\t\t\t\t<BlockAlignmentToolbar\n\t\t\t\t\tvalue={ align }\n\t\t\t\t\tonChange={ this.updateAlignment }\n\t\t\t\t/>\n\t\t\t\t{ url && (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<Toolbar>\n\t\t\t\t\t\t\t<IconButton\n\t\t\t\t\t\t\t\tclassName={ classnames( 'components-icon-button components-toolbar__control', { 'is-active': this.state.isEditing } ) }\n\t\t\t\t\t\t\t\tlabel={ __( 'Edit image' ) }\n\t\t\t\t\t\t\t\taria-pressed={ this.state.isEditing }\n\t\t\t\t\t\t\t\tonClick={ this.toggleIsEditing }\n\t\t\t\t\t\t\t\ticon={ editImageIcon }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</Toolbar>\n\t\t\t\t\t\t<Toolbar>\n\t\t\t\t\t\t\t<ImageURLInputUI\n\t\t\t\t\t\t\t\turl={ href || '' }\n\t\t\t\t\t\t\t\tonChangeUrl={ this.onSetHref }\n\t\t\t\t\t\t\t\tmediaLinks={ this.getLinkDestinations() }\n\t\t\t\t\t\t\t\tlinkDestination={ linkDestination }\n\t\t\t\t\t\t\t\tadvancedOptions={\n\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t<ToggleControl\n\t\t\t\t\t\t\t\t\t\t\tlabel={ __( 'Open in New Tab' ) }\n\t\t\t\t\t\t\t\t\t\t\tonChange={ this.onSetNewTab }\n\t\t\t\t\t\t\t\t\t\t\tchecked={ linkTarget === '_blank' } />\n\t\t\t\t\t\t\t\t\t\t<TextControl\n\t\t\t\t\t\t\t\t\t\t\tlabel={ __( 'Link CSS Class' ) }\n\t\t\t\t\t\t\t\t\t\t\tvalue={ linkClass || '' }\n\t\t\t\t\t\t\t\t\t\t\tonKeyPress={ stopPropagation }\n\t\t\t\t\t\t\t\t\t\t\tonKeyDown={ stopPropagationRelevantKeys }\n\t\t\t\t\t\t\t\t\t\t\tonChange={ this.onSetLinkClass }\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<TextControl\n\t\t\t\t\t\t\t\t\t\t\tlabel={ __( 'Link Rel' ) }\n\t\t\t\t\t\t\t\t\t\t\tvalue={ rel || '' }\n\t\t\t\t\t\t\t\t\t\t\tonChange={ this.onSetLinkRel }\n\t\t\t\t\t\t\t\t\t\t\tonKeyPress={ stopPropagation }\n\t\t\t\t\t\t\t\t\t\t\tonKeyDown={ stopPropagationRelevantKeys }\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</Toolbar>\n\t\t\t\t\t</>\n\t\t\t\t) }\n\t\t\t</BlockControls>\n\t\t);\n\t\tconst src = isExternal ? url : undefined;\n\t\tconst labels = {\n\t\t\ttitle: ! url ? __( 'Image' ) : __( 'Edit image' ),\n\t\t\tinstructions: __( 'Upload an image file, pick one from your media library, or add one with a URL.' ),\n\t\t};\n\t\tconst mediaPreview = ( !! url && <img\n\t\t\talt={ __( 'Edit image' ) }\n\t\t\ttitle={ __( 'Edit image' ) }\n\t\t\tclassName={ 'edit-image-preview' }\n\t\t\tsrc={ url }\n\t\t/> );\n\t\tconst mediaPlaceholder = (\n\t\t\t<MediaPlaceholder\n\t\t\t\ticon={ <BlockIcon icon={ icon } /> }\n\t\t\t\tclassName={ className }\n\t\t\t\tlabels={ labels }\n\t\t\t\tonSelect={ this.onSelectImage }\n\t\t\t\tonSelectURL={ this.onSelectURL }\n\t\t\t\tonDoubleClick={ this.toggleIsEditing }\n\t\t\t\tonCancel={ !! url && this.toggleIsEditing }\n\t\t\t\tnotices={ noticeUI }\n\t\t\t\tonError={ this.onUploadError }\n\t\t\t\taccept=\"image/*\"\n\t\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\n\t\t\t\tvalue={ { id, src } }\n\t\t\t\tmediaPreview={ mediaPreview }\n\t\t\t\tdropZoneUIOnly={ ! isEditing && url }\n\t\t\t/>\n\t\t);\n\t\tif ( isEditing || ! url ) {\n\t\t\treturn (\n\t\t\t\t<>\n\t\t\t\t\t{ controls }\n\t\t\t\t\t{ mediaPlaceholder }\n\t\t\t\t</>\n\t\t\t);\n\t\t}\n\n\t\tconst classes = classnames( className, {\n\t\t\t'is-transient': isBlobURL( url ),\n\t\t\t'is-resized': !! width || !! height,\n\t\t\t'is-focused': isSelected,\n\t\t\t[ `size-${ sizeSlug }` ]: sizeSlug,\n\t\t} );\n\n\t\tconst isResizable = [ 'wide', 'full' ].indexOf( align ) === -1 && isLargeViewport;\n\n\t\tconst imageSizeOptions = this.getImageSizeOptions();\n\n\t\tconst getInspectorControls = ( imageWidth, imageHeight ) => (\n\t\t\t<InspectorControls>\n\t\t\t\t<PanelBody title={ __( 'Image Settings' ) }>\n\t\t\t\t\t<TextareaControl\n\t\t\t\t\t\tlabel={ __( 'Alt Text (Alternative Text)' ) }\n\t\t\t\t\t\tvalue={ alt }\n\t\t\t\t\t\tonChange={ this.updateAlt }\n\t\t\t\t\t\thelp={\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<ExternalLink href=\"https://www.w3.org/WAI/tutorials/images/decision-tree\">\n\t\t\t\t\t\t\t\t\t{ __( 'Describe the purpose of the image' ) }\n\t\t\t\t\t\t\t\t</ExternalLink>\n\t\t\t\t\t\t\t\t{ __( 'Leave empty if the image is purely decorative.' ) }\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t\t{ ! isEmpty( imageSizeOptions ) && (\n\t\t\t\t\t\t<SelectControl\n\t\t\t\t\t\t\tlabel={ __( 'Image Size' ) }\n\t\t\t\t\t\t\tvalue={ sizeSlug }\n\t\t\t\t\t\t\toptions={ imageSizeOptions }\n\t\t\t\t\t\t\tonChange={ this.updateImage }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\t{ isResizable && (\n\t\t\t\t\t\t<div className=\"block-library-image__dimensions\">\n\t\t\t\t\t\t\t<p className=\"block-library-image__dimensions__row\">\n\t\t\t\t\t\t\t\t{ __( 'Image Dimensions' ) }\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<div className=\"block-library-image__dimensions__row\">\n\t\t\t\t\t\t\t\t<TextControl\n\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\tclassName=\"block-library-image__dimensions__width\"\n\t\t\t\t\t\t\t\t\tlabel={ __( 'Width' ) }\n\t\t\t\t\t\t\t\t\tvalue={ width || imageWidth || '' }\n\t\t\t\t\t\t\t\t\tmin={ 1 }\n\t\t\t\t\t\t\t\t\tonChange={ this.updateWidth }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<TextControl\n\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\tclassName=\"block-library-image__dimensions__height\"\n\t\t\t\t\t\t\t\t\tlabel={ __( 'Height' ) }\n\t\t\t\t\t\t\t\t\tvalue={ height || imageHeight || '' }\n\t\t\t\t\t\t\t\t\tmin={ 1 }\n\t\t\t\t\t\t\t\t\tonChange={ this.updateHeight }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className=\"block-library-image__dimensions__row\">\n\t\t\t\t\t\t\t\t<ButtonGroup aria-label={ __( 'Image Size' ) }>\n\t\t\t\t\t\t\t\t\t{ [ 25, 50, 75, 100 ].map( ( scale ) => {\n\t\t\t\t\t\t\t\t\t\tconst scaledWidth = Math.round( imageWidth * ( scale / 100 ) );\n\t\t\t\t\t\t\t\t\t\tconst scaledHeight = Math.round( imageHeight * ( scale / 100 ) );\n\n\t\t\t\t\t\t\t\t\t\tconst isCurrent = width === scaledWidth && height === scaledHeight;\n\n\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\tkey={ scale }\n\t\t\t\t\t\t\t\t\t\t\t\tisSmall\n\t\t\t\t\t\t\t\t\t\t\t\tisPrimary={ isCurrent }\n\t\t\t\t\t\t\t\t\t\t\t\taria-pressed={ isCurrent }\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={ this.updateDimensions( scaledWidth, scaledHeight ) }\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{ scale }%\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t} ) }\n\t\t\t\t\t\t\t\t</ButtonGroup>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tisSmall\n\t\t\t\t\t\t\t\t\tonClick={ this.updateDimensions() }\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{ __( 'Reset' ) }\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t) }\n\t\t\t\t</PanelBody>\n\t\t\t</InspectorControls>\n\t\t);\n\n\t\t// Disable reason: Each block can be selected by clicking on it\n\t\t/* eslint-disable jsx-a11y/click-events-have-key-events */\n\t\treturn (\n\t\t\t<>\n\t\t\t\t{ controls }\n\t\t\t\t<figure className={ classes }>\n\t\t\t\t\t<ImageSize src={ url } dirtynessTrigger={ align }>\n\t\t\t\t\t\t{ ( sizes ) => {\n\t\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\t\timageWidthWithinContainer,\n\t\t\t\t\t\t\t\timageHeightWithinContainer,\n\t\t\t\t\t\t\t\timageWidth,\n\t\t\t\t\t\t\t\timageHeight,\n\t\t\t\t\t\t\t} = sizes;\n\n\t\t\t\t\t\t\tconst filename = this.getFilename( url );\n\t\t\t\t\t\t\tlet defaultedAlt;\n\t\t\t\t\t\t\tif ( alt ) {\n\t\t\t\t\t\t\t\tdefaultedAlt = alt;\n\t\t\t\t\t\t\t} else if ( filename ) {\n\t\t\t\t\t\t\t\tdefaultedAlt = sprintf( __( 'This image has an empty alt attribute; its file name is %s' ), filename );\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdefaultedAlt = __( 'This image has an empty alt attribute' );\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst img = (\n\t\t\t\t\t\t\t\t// Disable reason: Image itself is not meant to be interactive, but\n\t\t\t\t\t\t\t\t// should direct focus to block.\n\t\t\t\t\t\t\t\t/* eslint-disable jsx-a11y/no-noninteractive-element-interactions */\n\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\tsrc={ url }\n\t\t\t\t\t\t\t\t\t\talt={ defaultedAlt }\n\t\t\t\t\t\t\t\t\t\tonDoubleClick={ this.toggleIsEditing }\n\t\t\t\t\t\t\t\t\t\tonClick={ this.onImageClick }\n\t\t\t\t\t\t\t\t\t\tonError={ () => this.onImageError( url ) }\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t{ isBlobURL( url ) && <Spinner /> }\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t/* eslint-enable jsx-a11y/no-noninteractive-element-interactions */\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tif ( ! isResizable || ! imageWidthWithinContainer ) {\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t{ getInspectorControls( imageWidth, imageHeight ) }\n\t\t\t\t\t\t\t\t\t\t<div style={ { width, height } }>\n\t\t\t\t\t\t\t\t\t\t\t{ img }\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst currentWidth = width || imageWidthWithinContainer;\n\t\t\t\t\t\t\tconst currentHeight = height || imageHeightWithinContainer;\n\n\t\t\t\t\t\t\tconst ratio = imageWidth / imageHeight;\n\t\t\t\t\t\t\tconst minWidth = imageWidth < imageHeight ? MIN_SIZE : MIN_SIZE * ratio;\n\t\t\t\t\t\t\tconst minHeight = imageHeight < imageWidth ? MIN_SIZE : MIN_SIZE / ratio;\n\n\t\t\t\t\t\t\t// With the current implementation of ResizableBox, an image needs an explicit pixel value for the max-width.\n\t\t\t\t\t\t\t// In absence of being able to set the content-width, this max-width is currently dictated by the vanilla editor style.\n\t\t\t\t\t\t\t// The following variable adds a buffer to this vanilla style, so 3rd party themes have some wiggleroom.\n\t\t\t\t\t\t\t// This does, in most cases, allow you to scale the image beyond the width of the main column, though not infinitely.\n\t\t\t\t\t\t\t// @todo It would be good to revisit this once a content-width variable becomes available.\n\t\t\t\t\t\t\tconst maxWidthBuffer = maxWidth * 2.5;\n\n\t\t\t\t\t\t\tlet showRightHandle = false;\n\t\t\t\t\t\t\tlet showLeftHandle = false;\n\n\t\t\t\t\t\t\t/* eslint-disable no-lonely-if */\n\t\t\t\t\t\t\t// See https://github.com/WordPress/gutenberg/issues/7584.\n\t\t\t\t\t\t\tif ( align === 'center' ) {\n\t\t\t\t\t\t\t\t// When the image is centered, show both handles.\n\t\t\t\t\t\t\t\tshowRightHandle = true;\n\t\t\t\t\t\t\t\tshowLeftHandle = true;\n\t\t\t\t\t\t\t} else if ( isRTL ) {\n\t\t\t\t\t\t\t\t// In RTL mode the image is on the right by default.\n\t\t\t\t\t\t\t\t// Show the right handle and hide the left handle only when it is aligned left.\n\t\t\t\t\t\t\t\t// Otherwise always show the left handle.\n\t\t\t\t\t\t\t\tif ( align === 'left' ) {\n\t\t\t\t\t\t\t\t\tshowRightHandle = true;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tshowLeftHandle = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Show the left handle and hide the right handle only when the image is aligned right.\n\t\t\t\t\t\t\t\t// Otherwise always show the right handle.\n\t\t\t\t\t\t\t\tif ( align === 'right' ) {\n\t\t\t\t\t\t\t\t\tshowLeftHandle = true;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tshowRightHandle = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t/* eslint-enable no-lonely-if */\n\n\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t{ getInspectorControls( imageWidth, imageHeight ) }\n\t\t\t\t\t\t\t\t\t<ResizableBox\n\t\t\t\t\t\t\t\t\t\tsize={ {\n\t\t\t\t\t\t\t\t\t\t\twidth,\n\t\t\t\t\t\t\t\t\t\t\theight,\n\t\t\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\t\t\tminWidth={ minWidth }\n\t\t\t\t\t\t\t\t\t\tmaxWidth={ maxWidthBuffer }\n\t\t\t\t\t\t\t\t\t\tminHeight={ minHeight }\n\t\t\t\t\t\t\t\t\t\tmaxHeight={ maxWidthBuffer / ratio }\n\t\t\t\t\t\t\t\t\t\tlockAspectRatio\n\t\t\t\t\t\t\t\t\t\tenable={ {\n\t\t\t\t\t\t\t\t\t\t\ttop: false,\n\t\t\t\t\t\t\t\t\t\t\tright: showRightHandle,\n\t\t\t\t\t\t\t\t\t\t\tbottom: true,\n\t\t\t\t\t\t\t\t\t\t\tleft: showLeftHandle,\n\t\t\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\t\t\tonResizeStart={ onResizeStart }\n\t\t\t\t\t\t\t\t\t\tonResizeStop={ ( event, direction, elt, delta ) => {\n\t\t\t\t\t\t\t\t\t\t\tonResizeStop();\n\t\t\t\t\t\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\t\t\t\t\t\twidth: parseInt( currentWidth + delta.width, 10 ),\n\t\t\t\t\t\t\t\t\t\t\t\theight: parseInt( currentHeight + delta.height, 10 ),\n\t\t\t\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{ img }\n\t\t\t\t\t\t\t\t\t</ResizableBox>\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} }\n\t\t\t\t\t</ImageSize>\n\t\t\t\t\t{ ( ! RichText.isEmpty( caption ) || isSelected ) && (\n\t\t\t\t\t\t<RichText\n\t\t\t\t\t\t\ttagName=\"figcaption\"\n\t\t\t\t\t\t\tplaceholder={ __( 'Write caption…' ) }\n\t\t\t\t\t\t\tvalue={ caption }\n\t\t\t\t\t\t\tunstableOnFocus={ this.onFocusCaption }\n\t\t\t\t\t\t\tonChange={ ( value ) => setAttributes( { caption: value } ) }\n\t\t\t\t\t\t\tisSelected={ this.state.captionFocused }\n\t\t\t\t\t\t\tinlineToolbar\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t</figure>\n\t\t\t\t{ mediaPlaceholder }\n\t\t\t</>\n\t\t);\n\t\t/* eslint-enable jsx-a11y/click-events-have-key-events */\n\t}\n}\n\nexport default compose( [\n\twithDispatch( ( dispatch ) => {\n\t\tconst { toggleSelection } = dispatch( 'core/block-editor' );\n\n\t\treturn {\n\t\t\tonResizeStart: () => toggleSelection( false ),\n\t\t\tonResizeStop: () => toggleSelection( true ),\n\t\t};\n\t} ),\n\twithSelect( ( select, props ) => {\n\t\tconst { getMedia } = select( 'core' );\n\t\tconst { getSettings } = select( 'core/block-editor' );\n\t\tconst { attributes: { id }, isSelected } = props;\n\t\tconst {\n\t\t\t__experimentalMediaUpload,\n\t\t\timageSizes,\n\t\t\tisRTL,\n\t\t\tmaxWidth,\n\t\t} = getSettings();\n\n\t\treturn {\n\t\t\timage: id && isSelected ? getMedia( id ) : null,\n\t\t\tmaxWidth,\n\t\t\tisRTL,\n\t\t\timageSizes,\n\t\t\tmediaUpload: __experimentalMediaUpload,\n\t\t};\n\t} ),\n\twithViewportMatch( { isLargeViewport: 'medium' } ),\n\twithNotices,\n] )( ImageEdit );\n"]}