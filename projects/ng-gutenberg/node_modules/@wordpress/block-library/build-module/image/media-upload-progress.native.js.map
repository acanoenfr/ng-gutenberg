{"version":3,"sources":["@wordpress/block-library/src/image/media-upload-progress.native.js"],"names":["React","View","subscribeMediaUpload","Spinner","__","ImageSize","styles","MEDIA_UPLOAD_STATE_UPLOADING","MEDIA_UPLOAD_STATE_SUCCEEDED","MEDIA_UPLOAD_STATE_FAILED","MEDIA_UPLOAD_STATE_RESET","MediaUploadProgress","props","state","progress","isUploadInProgress","isUploadFailed","mediaUpload","bind","addMediaUploadListener","removeMediaUploadListener","payload","mediaId","updateMediaProgress","finishMediaUploadWithSuccess","finishMediaUploadWithFailure","mediaUploadStateReset","setState","onUpdateMediaProgress","onFinishMediaUploadWithSuccess","onFinishMediaUploadWithFailure","onMediaUploadStateReset","subscriptionParentMediaUpload","remove","coverUrl","width","height","showSpinner","retryMessage","mediaUploadProgress","sizes","imageWidthWithinContainer","imageHeightWithinContainer","finalHeight","finalWidth","renderContent","Component"],"mappings":";;;;;;;;AAAA;;;AAGA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,IAAT,QAAqB,cAArB;AACA,SACCC,oBADD,QAEO,+BAFP;AAIA;;;;AAGA,SACCC,OADD,QAEO,uBAFP;AAGA,SAASC,EAAT,QAAmB,iBAAnB;AAEA;;;;AAGA,OAAOC,SAAP,MAAsB,cAAtB;AACA,OAAOC,MAAP,MAAmB,eAAnB;AAEA,OAAO,IAAMC,4BAA4B,GAAG,CAArC;AACP,OAAO,IAAMC,4BAA4B,GAAG,CAArC;AACP,OAAO,IAAMC,yBAAyB,GAAG,CAAlC;AACP,OAAO,IAAMC,wBAAwB,GAAG,CAAjC;AAEP,WAAaC,mBAAb;AAAA;AAAA;AAAA;;AACC,+BAAaC,KAAb,EAAqB;AAAA;;AAAA;;AACpB,6FAAOA,KAAP;AAEA,UAAKC,KAAL,GAAa;AACZC,MAAAA,QAAQ,EAAE,CADE;AAEZC,MAAAA,kBAAkB,EAAE,KAFR;AAGZC,MAAAA,cAAc,EAAE;AAHJ,KAAb;AAMA,UAAKC,WAAL,GAAmB,MAAKA,WAAL,CAAiBC,IAAjB,+BAAnB;AAToB;AAUpB;;AAXF;AAAA;AAAA,wCAaqB;AACnB,WAAKC,sBAAL;AACA;AAfF;AAAA;AAAA,2CAiBwB;AACtB,WAAKC,yBAAL;AACA;AAnBF;AAAA;AAAA,gCAqBcC,OArBd,EAqBwB;AAAA,UACdC,OADc,GACF,KAAKV,KADH,CACdU,OADc;;AAGtB,UAAKD,OAAO,CAACC,OAAR,KAAoBA,OAAzB,EAAmC;AAClC;AACA;;AAED,cAASD,OAAO,CAACR,KAAjB;AACC,aAAKN,4BAAL;AACC,eAAKgB,mBAAL,CAA0BF,OAA1B;AACA;;AACD,aAAKb,4BAAL;AACC,eAAKgB,4BAAL,CAAmCH,OAAnC;AACA;;AACD,aAAKZ,yBAAL;AACC,eAAKgB,4BAAL,CAAmCJ,OAAnC;AACA;;AACD,aAAKX,wBAAL;AACC,eAAKgB,qBAAL,CAA4BL,OAA5B;AACA;AAZF;AAcA;AA1CF;AAAA;AAAA,wCA4CsBA,OA5CtB,EA4CgC;AAC9B,WAAKM,QAAL,CAAe;AAAEb,QAAAA,QAAQ,EAAEO,OAAO,CAACP,QAApB;AAA8BC,QAAAA,kBAAkB,EAAE,IAAlD;AAAwDC,QAAAA,cAAc,EAAE;AAAxE,OAAf;;AACA,UAAK,KAAKJ,KAAL,CAAWgB,qBAAhB,EAAwC;AACvC,aAAKhB,KAAL,CAAWgB,qBAAX,CAAkCP,OAAlC;AACA;AACD;AAjDF;AAAA;AAAA,iDAmD+BA,OAnD/B,EAmDyC;AACvC,WAAKM,QAAL,CAAe;AAAEZ,QAAAA,kBAAkB,EAAE;AAAtB,OAAf;;AACA,UAAK,KAAKH,KAAL,CAAWiB,8BAAhB,EAAiD;AAChD,aAAKjB,KAAL,CAAWiB,8BAAX,CAA2CR,OAA3C;AACA;AACD;AAxDF;AAAA;AAAA,iDA0D+BA,OA1D/B,EA0DyC;AACvC,WAAKM,QAAL,CAAe;AAAEZ,QAAAA,kBAAkB,EAAE,KAAtB;AAA6BC,QAAAA,cAAc,EAAE;AAA7C,OAAf;;AACA,UAAK,KAAKJ,KAAL,CAAWkB,8BAAhB,EAAiD;AAChD,aAAKlB,KAAL,CAAWkB,8BAAX,CAA2CT,OAA3C;AACA;AACD;AA/DF;AAAA;AAAA,0CAiEwBA,OAjExB,EAiEkC;AAChC,WAAKM,QAAL,CAAe;AAAEZ,QAAAA,kBAAkB,EAAE,KAAtB;AAA6BC,QAAAA,cAAc,EAAE;AAA7C,OAAf;;AACA,UAAK,KAAKJ,KAAL,CAAWmB,uBAAhB,EAA0C;AACzC,aAAKnB,KAAL,CAAWmB,uBAAX,CAAoCV,OAApC;AACA;AACD;AAtEF;AAAA;AAAA,6CAwE0B;AAAA;;AACxB;AACA,UAAK,KAAKW,6BAAV,EAA0C;AACzC;AACA;;AACD,WAAKA,6BAAL,GAAqC9B,oBAAoB,CAAE,UAAEmB,OAAF,EAAe;AACzE,QAAA,MAAI,CAACJ,WAAL,CAAkBI,OAAlB;AACA,OAFwD,CAAzD;AAGA;AAhFF;AAAA;AAAA,gDAkF6B;AAC3B,UAAK,KAAKW,6BAAV,EAA0C;AACzC,aAAKA,6BAAL,CAAmCC,MAAnC;AACA;AACD;AAtFF;AAAA;AAAA,6BAwFU;AAAA;;AAAA,wBAC4B,KAAKrB,KADjC;AAAA,UACAsB,QADA,eACAA,QADA;AAAA,UACUC,KADV,eACUA,KADV;AAAA,UACiBC,MADjB,eACiBA,MADjB;AAAA,wBAEuC,KAAKvB,KAF5C;AAAA,UAEAE,kBAFA,eAEAA,kBAFA;AAAA,UAEoBC,cAFpB,eAEoBA,cAFpB;AAGR,UAAMqB,WAAW,GAAG,KAAKxB,KAAL,CAAWE,kBAA/B;AACA,UAAMD,QAAQ,GAAG,KAAKD,KAAL,CAAWC,QAAX,GAAsB,GAAvC;;AACA,UAAMwB,YAAY,GAAGlC,EAAE,CAAE,kDAAF,CAAvB;;AAEA,aACC,cAAC,IAAD;AAAM,QAAA,KAAK,EAAGE,MAAM,CAACiC;AAArB,SACGF,WAAW,IAAI,cAAC,OAAD;AAAS,QAAA,QAAQ,EAAGvB;AAApB,QADlB,EAEGoB,QAAQ,IACT,cAAC,SAAD;AAAW,QAAA,GAAG,EAAGA;AAAjB,SACG,UAAEM,KAAF,EAAa;AAAA,YAEbC,yBAFa,GAIVD,KAJU,CAEbC,yBAFa;AAAA,YAGbC,0BAHa,GAIVF,KAJU,CAGbE,0BAHa;AAMd,YAAIC,WAAW,GAAGD,0BAAlB;;AACA,YAAKN,MAAM,GAAG,CAAT,IAAcA,MAAM,GAAGM,0BAA5B,EAAyD;AACxDC,UAAAA,WAAW,GAAGP,MAAd;AACA;;AAED,YAAIQ,UAAU,GAAGH,yBAAjB;;AACA,YAAKN,KAAK,GAAG,CAAR,IAAaA,KAAK,GAAGM,yBAA1B,EAAsD;AACrDG,UAAAA,UAAU,GAAGT,KAAb;AACA;;AACD,eAAS,MAAI,CAACvB,KAAL,CAAWiC,aAAX,CAA0B;AAClC9B,UAAAA,kBAAkB,EAAlBA,kBADkC;AAElCC,UAAAA,cAAc,EAAdA,cAFkC;AAGlC4B,UAAAA,UAAU,EAAVA,UAHkC;AAIlCD,UAAAA,WAAW,EAAXA,WAJkC;AAKlCF,UAAAA,yBAAyB,EAAzBA,yBALkC;AAMlCH,UAAAA,YAAY,EAAZA;AANkC,SAA1B,CAAT;AAQA,OAxBF,CAHF,EA8BG,CAAEJ,QAAF,IAAc,KAAKtB,KAAL,CAAWiC,aAAX,CAA0B;AACzC9B,QAAAA,kBAAkB,EAAlBA,kBADyC;AAEzCC,QAAAA,cAAc,EAAdA,cAFyC;AAGzCsB,QAAAA,YAAY,EAAZA;AAHyC,OAA1B,CA9BjB,CADD;AAsCA;AArIF;;AAAA;AAAA,EAAyCtC,KAAK,CAAC8C,SAA/C;AAwIA,eAAenC,mBAAf","sourcesContent":["/**\n * External dependencies\n */\nimport React from 'react';\nimport { View } from 'react-native';\nimport {\n\tsubscribeMediaUpload,\n} from 'react-native-gutenberg-bridge';\n\n/**\n * WordPress dependencies\n */\nimport {\n\tSpinner,\n} from '@wordpress/components';\nimport { __ } from '@wordpress/i18n';\n\n/**\n * Internal dependencies\n */\nimport ImageSize from './image-size';\nimport styles from './styles.scss';\n\nexport const MEDIA_UPLOAD_STATE_UPLOADING = 1;\nexport const MEDIA_UPLOAD_STATE_SUCCEEDED = 2;\nexport const MEDIA_UPLOAD_STATE_FAILED = 3;\nexport const MEDIA_UPLOAD_STATE_RESET = 4;\n\nexport class MediaUploadProgress extends React.Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\n\t\tthis.state = {\n\t\t\tprogress: 0,\n\t\t\tisUploadInProgress: false,\n\t\t\tisUploadFailed: false,\n\t\t};\n\n\t\tthis.mediaUpload = this.mediaUpload.bind( this );\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.addMediaUploadListener();\n\t}\n\n\tcomponentWillUnmount() {\n\t\tthis.removeMediaUploadListener();\n\t}\n\n\tmediaUpload( payload ) {\n\t\tconst { mediaId } = this.props;\n\n\t\tif ( payload.mediaId !== mediaId ) {\n\t\t\treturn;\n\t\t}\n\n\t\tswitch ( payload.state ) {\n\t\t\tcase MEDIA_UPLOAD_STATE_UPLOADING:\n\t\t\t\tthis.updateMediaProgress( payload );\n\t\t\t\tbreak;\n\t\t\tcase MEDIA_UPLOAD_STATE_SUCCEEDED:\n\t\t\t\tthis.finishMediaUploadWithSuccess( payload );\n\t\t\t\tbreak;\n\t\t\tcase MEDIA_UPLOAD_STATE_FAILED:\n\t\t\t\tthis.finishMediaUploadWithFailure( payload );\n\t\t\t\tbreak;\n\t\t\tcase MEDIA_UPLOAD_STATE_RESET:\n\t\t\t\tthis.mediaUploadStateReset( payload );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tupdateMediaProgress( payload ) {\n\t\tthis.setState( { progress: payload.progress, isUploadInProgress: true, isUploadFailed: false } );\n\t\tif ( this.props.onUpdateMediaProgress ) {\n\t\t\tthis.props.onUpdateMediaProgress( payload );\n\t\t}\n\t}\n\n\tfinishMediaUploadWithSuccess( payload ) {\n\t\tthis.setState( { isUploadInProgress: false } );\n\t\tif ( this.props.onFinishMediaUploadWithSuccess ) {\n\t\t\tthis.props.onFinishMediaUploadWithSuccess( payload );\n\t\t}\n\t}\n\n\tfinishMediaUploadWithFailure( payload ) {\n\t\tthis.setState( { isUploadInProgress: false, isUploadFailed: true } );\n\t\tif ( this.props.onFinishMediaUploadWithFailure ) {\n\t\t\tthis.props.onFinishMediaUploadWithFailure( payload );\n\t\t}\n\t}\n\n\tmediaUploadStateReset( payload ) {\n\t\tthis.setState( { isUploadInProgress: false, isUploadFailed: false } );\n\t\tif ( this.props.onMediaUploadStateReset ) {\n\t\t\tthis.props.onMediaUploadStateReset( payload );\n\t\t}\n\t}\n\n\taddMediaUploadListener() {\n\t\t//if we already have a subscription not worth doing it again\n\t\tif ( this.subscriptionParentMediaUpload ) {\n\t\t\treturn;\n\t\t}\n\t\tthis.subscriptionParentMediaUpload = subscribeMediaUpload( ( payload ) => {\n\t\t\tthis.mediaUpload( payload );\n\t\t} );\n\t}\n\n\tremoveMediaUploadListener() {\n\t\tif ( this.subscriptionParentMediaUpload ) {\n\t\t\tthis.subscriptionParentMediaUpload.remove();\n\t\t}\n\t}\n\n\trender() {\n\t\tconst { coverUrl, width, height } = this.props;\n\t\tconst { isUploadInProgress, isUploadFailed } = this.state;\n\t\tconst showSpinner = this.state.isUploadInProgress;\n\t\tconst progress = this.state.progress * 100;\n\t\tconst retryMessage = __( 'Failed to insert media.\\nPlease tap for options.' );\n\n\t\treturn (\n\t\t\t<View style={ styles.mediaUploadProgress }>\n\t\t\t\t{ showSpinner && <Spinner progress={ progress } /> }\n\t\t\t\t{ coverUrl &&\n\t\t\t\t\t<ImageSize src={ coverUrl } >\n\t\t\t\t\t\t{ ( sizes ) => {\n\t\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\t\timageWidthWithinContainer,\n\t\t\t\t\t\t\t\timageHeightWithinContainer,\n\t\t\t\t\t\t\t} = sizes;\n\n\t\t\t\t\t\t\tlet finalHeight = imageHeightWithinContainer;\n\t\t\t\t\t\t\tif ( height > 0 && height < imageHeightWithinContainer ) {\n\t\t\t\t\t\t\t\tfinalHeight = height;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlet finalWidth = imageWidthWithinContainer;\n\t\t\t\t\t\t\tif ( width > 0 && width < imageWidthWithinContainer ) {\n\t\t\t\t\t\t\t\tfinalWidth = width;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn ( this.props.renderContent( {\n\t\t\t\t\t\t\t\tisUploadInProgress,\n\t\t\t\t\t\t\t\tisUploadFailed,\n\t\t\t\t\t\t\t\tfinalWidth,\n\t\t\t\t\t\t\t\tfinalHeight,\n\t\t\t\t\t\t\t\timageWidthWithinContainer,\n\t\t\t\t\t\t\t\tretryMessage,\n\t\t\t\t\t\t\t} ) );\n\t\t\t\t\t\t} }\n\t\t\t\t\t</ImageSize>\n\t\t\t\t}\n\t\t\t\t{ ! coverUrl && this.props.renderContent( {\n\t\t\t\t\tisUploadInProgress,\n\t\t\t\t\tisUploadFailed,\n\t\t\t\t\tretryMessage,\n\t\t\t\t} ) }\n\t\t\t</View>\n\t\t);\n\t}\n}\n\nexport default MediaUploadProgress;\n"]}