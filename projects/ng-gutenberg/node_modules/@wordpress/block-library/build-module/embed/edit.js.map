{"version":3,"sources":["@wordpress/block-library/src/embed/edit.js"],"names":["createUpgradedEmbedBlock","getClassNames","fallback","getAttributesFromPreview","EmbedControls","EmbedLoading","EmbedPlaceholder","EmbedPreview","classnames","__","sprintf","Component","getEmbedEditComponent","title","icon","responsive","arguments","switchBackToURLInput","bind","setUrl","getMergedAttributes","setMergedAttributes","getResponsiveHelp","toggleResponsive","handleIncomingPreview","state","editingURL","url","props","attributes","preview","onReplace","upgradedBlock","prevProps","hasPreview","undefined","hadPreview","previewChanged","html","switchedPreview","switchedURL","cannotEmbed","fetching","resubmitWithoutTrailingSlash","setState","prevState","replace","event","preventDefault","setAttributes","className","allowResponsive","checked","newAllowResponsive","isSelected","themeSupportsResponsive","tryAgain","label","target","value","previewAttributes","caption","type"],"mappings":";;;;;;;;;AAAA;;;AAGA,SAASA,wBAAT,EAAmCC,aAAnC,EAAkDC,QAAQ,IAARA,SAAlD,EAA4DC,wBAA5D,QAA4F,QAA5F;AACA,OAAOC,aAAP,MAA0B,kBAA1B;AACA,OAAOC,YAAP,MAAyB,iBAAzB;AACA,OAAOC,gBAAP,MAA6B,qBAA7B;AACA,OAAOC,YAAP,MAAyB,iBAAzB;AAEA;;;;AAGA,OAAOC,UAAP,MAAuB,YAAvB;AAEA;;;;AAGA,SAASC,EAAT,EAAaC,OAAb,QAA4B,iBAA5B;AACA,SAASC,SAAT,QAA0B,oBAA1B;AAEA,OAAO,SAASC,qBAAT,CAAgCC,KAAhC,EAAuCC,IAAvC,EAAiE;AAAA,MAApBC,UAAoB,uEAAP,IAAO;AACvE;AAAA;AAAA;AAAA;;AACC,wBAAc;AAAA;;AAAA;;AACb,qFAAUC,SAAV;AACA,cAAKC,oBAAL,GAA4B,MAAKA,oBAAL,CAA0BC,IAA1B,+BAA5B;AACA,cAAKC,MAAL,GAAc,MAAKA,MAAL,CAAYD,IAAZ,+BAAd;AACA,cAAKE,mBAAL,GAA2B,MAAKA,mBAAL,CAAyBF,IAAzB,+BAA3B;AACA,cAAKG,mBAAL,GAA2B,MAAKA,mBAAL,CAAyBH,IAAzB,+BAA3B;AACA,cAAKI,iBAAL,GAAyB,MAAKA,iBAAL,CAAuBJ,IAAvB,+BAAzB;AACA,cAAKK,gBAAL,GAAwB,MAAKA,gBAAL,CAAsBL,IAAtB,+BAAxB;AACA,cAAKM,qBAAL,GAA6B,MAAKA,qBAAL,CAA2BN,IAA3B,+BAA7B;AAEA,cAAKO,KAAL,GAAa;AACZC,UAAAA,UAAU,EAAE,KADA;AAEZC,UAAAA,GAAG,EAAE,MAAKC,KAAL,CAAWC,UAAX,CAAsBF;AAFf,SAAb;;AAKA,YAAK,MAAKC,KAAL,CAAWE,OAAhB,EAA0B;AACzB,gBAAKN,qBAAL;AACA;;AAjBY;AAkBb;;AAnBF;AAAA;AAAA,gDAqByB;AACvB,eAAKH,mBAAL;;AACA,cAAK,KAAKO,KAAL,CAAWG,SAAhB,EAA4B;AAC3B,gBAAMC,aAAa,GAAGhC,wBAAwB,CAC7C,KAAK4B,KADwC,EAE7C,KAAKR,mBAAL,EAF6C,CAA9C;;AAIA,gBAAKY,aAAL,EAAqB;AACpB,mBAAKJ,KAAL,CAAWG,SAAX,CAAsBC,aAAtB;AACA;AACD;AACD;AAhCF;AAAA;AAAA,2CAkCqBC,SAlCrB,EAkCiC;AAC/B,cAAMC,UAAU,GAAGC,SAAS,KAAK,KAAKP,KAAL,CAAWE,OAA5C;AACA,cAAMM,UAAU,GAAGD,SAAS,KAAKF,SAAS,CAACH,OAA3C;AACA,cAAMO,cAAc,GAAGJ,SAAS,CAACH,OAAV,IAAqB,KAAKF,KAAL,CAAWE,OAAhC,IAA2C,KAAKF,KAAL,CAAWE,OAAX,CAAmBQ,IAAnB,KAA4BL,SAAS,CAACH,OAAV,CAAkBQ,IAAhH;AACA,cAAMC,eAAe,GAAGF,cAAc,IAAMH,UAAU,IAAI,CAAEE,UAA5D;AACA,cAAMI,WAAW,GAAG,KAAKZ,KAAL,CAAWC,UAAX,CAAsBF,GAAtB,KAA8BM,SAAS,CAACJ,UAAV,CAAqBF,GAAvE;;AAEA,cAAKY,eAAe,IAAIC,WAAxB,EAAsC;AACrC,gBAAK,KAAKZ,KAAL,CAAWa,WAAhB,EAA8B;AAC7B;AACA,kBAAK,CAAE,KAAKb,KAAL,CAAWc,QAAlB,EAA6B;AAC5B;AACA;AACA,qBAAKC,4BAAL;AACA;;AACD;AACA;;AACD,iBAAKnB,qBAAL;AACA;AACD;AArDF;AAAA;AAAA,uDAuDgC;AAC9B,eAAKoB,QAAL,CAAe,UAAEC,SAAF;AAAA,mBAAmB;AACjClB,cAAAA,GAAG,EAAEkB,SAAS,CAAClB,GAAV,CAAcmB,OAAd,CAAuB,KAAvB,EAA8B,EAA9B;AAD4B,aAAnB;AAAA,WAAf,EAEK,KAAK3B,MAFV;AAGA;AA3DF;AAAA;AAAA,+BA6DS4B,KA7DT,EA6DiB;AACf,cAAKA,KAAL,EAAa;AACZA,YAAAA,KAAK,CAACC,cAAN;AACA;;AAHc,cAIPrB,GAJO,GAIC,KAAKF,KAJN,CAIPE,GAJO;AAAA,cAKPsB,aALO,GAKW,KAAKrB,KALhB,CAKPqB,aALO;AAMf,eAAKL,QAAL,CAAe;AAAElB,YAAAA,UAAU,EAAE;AAAd,WAAf;AACAuB,UAAAA,aAAa,CAAE;AAAEtB,YAAAA,GAAG,EAAHA;AAAF,WAAF,CAAb;AACA;AAED;;;;AAvED;AAAA;AAAA,8CA0EuB;AAAA,cACbG,OADa,GACD,KAAKF,KADJ,CACbE,OADa;AAAA,sCAEkB,KAAKF,KAAL,CAAWC,UAF7B;AAAA,cAEbqB,SAFa,yBAEbA,SAFa;AAAA,cAEFC,eAFE,yBAEFA,eAFE;AAGrB,mCAAY,KAAKvB,KAAL,CAAWC,UAAvB,EAAsC1B,wBAAwB,CAAE2B,OAAF,EAAWjB,KAAX,EAAkBqC,SAAlB,EAA6BnC,UAA7B,EAAyCoC,eAAzC,CAA9D;AACA;AAED;;;;AAhFD;AAAA;AAAA,8CAmFuB;AAAA,cACbF,aADa,GACK,KAAKrB,KADV,CACbqB,aADa;AAErBA,UAAAA,aAAa,CAAE,KAAK7B,mBAAL,EAAF,CAAb;AACA;AAtFF;AAAA;AAAA,+CAwFwB;AACtB,eAAKwB,QAAL,CAAe;AAAElB,YAAAA,UAAU,EAAE;AAAd,WAAf;AACA;AA1FF;AAAA;AAAA,0CA4FoB0B,OA5FpB,EA4F8B;AAC5B,iBAAOA,OAAO,GAAG3C,EAAE,CAAE,wEAAF,CAAL,GAAoFA,EAAE,CAAE,2EAAF,CAApG;AACA;AA9FF;AAAA;AAAA,2CAgGoB;AAAA,uCACqB,KAAKmB,KAAL,CAAWC,UADhC;AAAA,cACVsB,eADU,0BACVA,eADU;AAAA,cACOD,SADP,0BACOA,SADP;AAAA,cAEVZ,IAFU,GAED,KAAKV,KAAL,CAAWE,OAFV,CAEVQ,IAFU;AAGlB,cAAMe,kBAAkB,GAAG,CAAEF,eAA7B;AAEA,eAAKvB,KAAL,CAAWqB,aAAX,CACC;AACCE,YAAAA,eAAe,EAAEE,kBADlB;AAECH,YAAAA,SAAS,EAAEjD,aAAa,CAAEqC,IAAF,EAAQY,SAAR,EAAmBnC,UAAU,IAAIsC,kBAAjC;AAFzB,WADD;AAMA;AA3GF;AAAA;AAAA,iCA6GU;AAAA;;AAAA,4BACoB,KAAK5B,KADzB;AAAA,cACAE,GADA,eACAA,GADA;AAAA,cACKD,UADL,eACKA,UADL;AAAA,4BAEiG,KAAKE,KAFtG;AAAA,cAEAc,QAFA,eAEAA,QAFA;AAAA,cAEUO,aAFV,eAEUA,aAFV;AAAA,cAEyBK,UAFzB,eAEyBA,UAFzB;AAAA,cAEqCxB,OAFrC,eAEqCA,OAFrC;AAAA,cAE8CW,WAF9C,eAE8CA,WAF9C;AAAA,cAE2Dc,uBAF3D,eAE2DA,uBAF3D;AAAA,cAEoFC,QAFpF,eAEoFA,QAFpF;;AAIR,cAAKd,QAAL,EAAgB;AACf,mBACC,cAAC,YAAD,OADD;AAGA,WARO,CAUR;;;AACA,cAAMe,KAAK,GAAG/C,OAAO,CAAED,EAAE,CAAE,QAAF,CAAJ,EAAkBI,KAAlB,CAArB,CAXQ,CAaR;;AACA,cAAK,CAAEiB,OAAF,IAAaW,WAAb,IAA4Bf,UAAjC,EAA8C;AAC7C,mBACC,cAAC,gBAAD;AACC,cAAA,IAAI,EAAGZ,IADR;AAEC,cAAA,KAAK,EAAG2C,KAFT;AAGC,cAAA,QAAQ,EAAG,KAAKtC,MAHjB;AAIC,cAAA,KAAK,EAAGQ,GAJT;AAKC,cAAA,WAAW,EAAGc,WALf;AAMC,cAAA,QAAQ,EAAG,kBAAEM,KAAF;AAAA,uBAAa,MAAI,CAACH,QAAL,CAAe;AAAEjB,kBAAAA,GAAG,EAAEoB,KAAK,CAACW,MAAN,CAAaC;AAApB,iBAAf,CAAb;AAAA,eANZ;AAOC,cAAA,QAAQ,EAAG;AAAA,uBAAMzD,SAAQ,CAAEyB,GAAF,EAAO,MAAI,CAACC,KAAL,CAAWG,SAAlB,CAAd;AAAA,eAPZ;AAQC,cAAA,QAAQ,EAAGyB;AARZ,cADD;AAYA,WA3BO,CA6BR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,cAAMI,iBAAiB,GAAG,KAAKxC,mBAAL,EAA1B;AArCQ,cAsCAyC,OAtCA,GAsCmCD,iBAtCnC,CAsCAC,OAtCA;AAAA,cAsCSC,IAtCT,GAsCmCF,iBAtCnC,CAsCSE,IAtCT;AAAA,cAsCeX,eAtCf,GAsCmCS,iBAtCnC,CAsCeT,eAtCf;AAuCR,cAAMD,SAAS,GAAG1C,UAAU,CAAEoD,iBAAiB,CAACV,SAApB,EAA+B,KAAKtB,KAAL,CAAWsB,SAA1C,CAA5B;AAEA,iBACC,8BACC,cAAC,aAAD;AACC,YAAA,cAAc,EAAGpB,OAAO,IAAI,CAAEW,WAD/B;AAEC,YAAA,uBAAuB,EAAGc,uBAF3B;AAGC,YAAA,uBAAuB,EAAGxC,UAH3B;AAIC,YAAA,eAAe,EAAGoC,eAJnB;AAKC,YAAA,iBAAiB,EAAG,KAAK7B,iBAL1B;AAMC,YAAA,gBAAgB,EAAG,KAAKC,gBANzB;AAOC,YAAA,oBAAoB,EAAG,KAAKN;AAP7B,YADD,EAUC,cAAC,YAAD;AACC,YAAA,OAAO,EAAGa,OADX;AAEC,YAAA,SAAS,EAAGoB,SAFb;AAGC,YAAA,GAAG,EAAGvB,GAHP;AAIC,YAAA,IAAI,EAAGmC,IAJR;AAKC,YAAA,OAAO,EAAGD,OALX;AAMC,YAAA,eAAe,EAAG,yBAAEF,KAAF;AAAA,qBAAaV,aAAa,CAAE;AAAEY,gBAAAA,OAAO,EAAEF;AAAX,eAAF,CAA1B;AAAA,aANnB;AAOC,YAAA,UAAU,EAAGL,UAPd;AAQC,YAAA,IAAI,EAAGxC,IARR;AASC,YAAA,KAAK,EAAG2C;AATT,YAVD,CADD;AAwBA;AA9KF;;AAAA;AAAA,MAAqB9C,SAArB;AAAA;AAgLA","sourcesContent":["/**\n * Internal dependencies\n */\nimport { createUpgradedEmbedBlock, getClassNames, fallback, getAttributesFromPreview } from './util';\nimport EmbedControls from './embed-controls';\nimport EmbedLoading from './embed-loading';\nimport EmbedPlaceholder from './embed-placeholder';\nimport EmbedPreview from './embed-preview';\n\n/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { __, sprintf } from '@wordpress/i18n';\nimport { Component } from '@wordpress/element';\n\nexport function getEmbedEditComponent( title, icon, responsive = true ) {\n\treturn class extends Component {\n\t\tconstructor() {\n\t\t\tsuper( ...arguments );\n\t\t\tthis.switchBackToURLInput = this.switchBackToURLInput.bind( this );\n\t\t\tthis.setUrl = this.setUrl.bind( this );\n\t\t\tthis.getMergedAttributes = this.getMergedAttributes.bind( this );\n\t\t\tthis.setMergedAttributes = this.setMergedAttributes.bind( this );\n\t\t\tthis.getResponsiveHelp = this.getResponsiveHelp.bind( this );\n\t\t\tthis.toggleResponsive = this.toggleResponsive.bind( this );\n\t\t\tthis.handleIncomingPreview = this.handleIncomingPreview.bind( this );\n\n\t\t\tthis.state = {\n\t\t\t\teditingURL: false,\n\t\t\t\turl: this.props.attributes.url,\n\t\t\t};\n\n\t\t\tif ( this.props.preview ) {\n\t\t\t\tthis.handleIncomingPreview();\n\t\t\t}\n\t\t}\n\n\t\thandleIncomingPreview() {\n\t\t\tthis.setMergedAttributes();\n\t\t\tif ( this.props.onReplace ) {\n\t\t\t\tconst upgradedBlock = createUpgradedEmbedBlock(\n\t\t\t\t\tthis.props,\n\t\t\t\t\tthis.getMergedAttributes()\n\t\t\t\t);\n\t\t\t\tif ( upgradedBlock ) {\n\t\t\t\t\tthis.props.onReplace( upgradedBlock );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tcomponentDidUpdate( prevProps ) {\n\t\t\tconst hasPreview = undefined !== this.props.preview;\n\t\t\tconst hadPreview = undefined !== prevProps.preview;\n\t\t\tconst previewChanged = prevProps.preview && this.props.preview && this.props.preview.html !== prevProps.preview.html;\n\t\t\tconst switchedPreview = previewChanged || ( hasPreview && ! hadPreview );\n\t\t\tconst switchedURL = this.props.attributes.url !== prevProps.attributes.url;\n\n\t\t\tif ( switchedPreview || switchedURL ) {\n\t\t\t\tif ( this.props.cannotEmbed ) {\n\t\t\t\t\t// We either have a new preview or a new URL, but we can't embed it.\n\t\t\t\t\tif ( ! this.props.fetching ) {\n\t\t\t\t\t\t// If we're not fetching the preview, then we know it can't be embedded, so try\n\t\t\t\t\t\t// removing any trailing slash, and resubmit.\n\t\t\t\t\t\tthis.resubmitWithoutTrailingSlash();\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.handleIncomingPreview();\n\t\t\t}\n\t\t}\n\n\t\tresubmitWithoutTrailingSlash() {\n\t\t\tthis.setState( ( prevState ) => ( {\n\t\t\t\turl: prevState.url.replace( /\\/$/, '' ),\n\t\t\t} ), this.setUrl );\n\t\t}\n\n\t\tsetUrl( event ) {\n\t\t\tif ( event ) {\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t\tconst { url } = this.state;\n\t\t\tconst { setAttributes } = this.props;\n\t\t\tthis.setState( { editingURL: false } );\n\t\t\tsetAttributes( { url } );\n\t\t}\n\n\t\t/***\n\t\t * @return {Object} Attributes derived from the preview, merged with the current attributes.\n\t\t */\n\t\tgetMergedAttributes() {\n\t\t\tconst { preview } = this.props;\n\t\t\tconst { className, allowResponsive } = this.props.attributes;\n\t\t\treturn { ...this.props.attributes, ...getAttributesFromPreview( preview, title, className, responsive, allowResponsive ) };\n\t\t}\n\n\t\t/***\n\t\t * Sets block attributes based on the current attributes and preview data.\n\t\t */\n\t\tsetMergedAttributes() {\n\t\t\tconst { setAttributes } = this.props;\n\t\t\tsetAttributes( this.getMergedAttributes() );\n\t\t}\n\n\t\tswitchBackToURLInput() {\n\t\t\tthis.setState( { editingURL: true } );\n\t\t}\n\n\t\tgetResponsiveHelp( checked ) {\n\t\t\treturn checked ? __( 'This embed will preserve its aspect ratio when the browser is resized.' ) : __( 'This embed may not preserve its aspect ratio when the browser is resized.' );\n\t\t}\n\n\t\ttoggleResponsive() {\n\t\t\tconst { allowResponsive, className } = this.props.attributes;\n\t\t\tconst { html } = this.props.preview;\n\t\t\tconst newAllowResponsive = ! allowResponsive;\n\n\t\t\tthis.props.setAttributes(\n\t\t\t\t{\n\t\t\t\t\tallowResponsive: newAllowResponsive,\n\t\t\t\t\tclassName: getClassNames( html, className, responsive && newAllowResponsive ),\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\trender() {\n\t\t\tconst { url, editingURL } = this.state;\n\t\t\tconst { fetching, setAttributes, isSelected, preview, cannotEmbed, themeSupportsResponsive, tryAgain } = this.props;\n\n\t\t\tif ( fetching ) {\n\t\t\t\treturn (\n\t\t\t\t\t<EmbedLoading />\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// translators: %s: type of embed e.g: \"YouTube\", \"Twitter\", etc. \"Embed\" is used when no specific type exists\n\t\t\tconst label = sprintf( __( '%s URL' ), title );\n\n\t\t\t// No preview, or we can't embed the current URL, or we've clicked the edit button.\n\t\t\tif ( ! preview || cannotEmbed || editingURL ) {\n\t\t\t\treturn (\n\t\t\t\t\t<EmbedPlaceholder\n\t\t\t\t\t\ticon={ icon }\n\t\t\t\t\t\tlabel={ label }\n\t\t\t\t\t\tonSubmit={ this.setUrl }\n\t\t\t\t\t\tvalue={ url }\n\t\t\t\t\t\tcannotEmbed={ cannotEmbed }\n\t\t\t\t\t\tonChange={ ( event ) => this.setState( { url: event.target.value } ) }\n\t\t\t\t\t\tfallback={ () => fallback( url, this.props.onReplace ) }\n\t\t\t\t\t\ttryAgain={ tryAgain }\n\t\t\t\t\t/>\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Even though we set attributes that get derived from the preview,\n\t\t\t// we don't access them directly because for the initial render,\n\t\t\t// the `setAttributes` call will not have taken effect. If we're\n\t\t\t// rendering responsive content, setting the responsive classes\n\t\t\t// after the preview has been rendered can result in unwanted\n\t\t\t// clipping or scrollbars. The `getAttributesFromPreview` function\n\t\t\t// that `getMergedAttributes` uses is memoized so that we're not\n\t\t\t// calculating them on every render.\n\t\t\tconst previewAttributes = this.getMergedAttributes();\n\t\t\tconst { caption, type, allowResponsive } = previewAttributes;\n\t\t\tconst className = classnames( previewAttributes.className, this.props.className );\n\n\t\t\treturn (\n\t\t\t\t<>\n\t\t\t\t\t<EmbedControls\n\t\t\t\t\t\tshowEditButton={ preview && ! cannotEmbed }\n\t\t\t\t\t\tthemeSupportsResponsive={ themeSupportsResponsive }\n\t\t\t\t\t\tblockSupportsResponsive={ responsive }\n\t\t\t\t\t\tallowResponsive={ allowResponsive }\n\t\t\t\t\t\tgetResponsiveHelp={ this.getResponsiveHelp }\n\t\t\t\t\t\ttoggleResponsive={ this.toggleResponsive }\n\t\t\t\t\t\tswitchBackToURLInput={ this.switchBackToURLInput }\n\t\t\t\t\t/>\n\t\t\t\t\t<EmbedPreview\n\t\t\t\t\t\tpreview={ preview }\n\t\t\t\t\t\tclassName={ className }\n\t\t\t\t\t\turl={ url }\n\t\t\t\t\t\ttype={ type }\n\t\t\t\t\t\tcaption={ caption }\n\t\t\t\t\t\tonCaptionChange={ ( value ) => setAttributes( { caption: value } ) }\n\t\t\t\t\t\tisSelected={ isSelected }\n\t\t\t\t\t\ticon={ icon }\n\t\t\t\t\t\tlabel={ label }\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t);\n\t\t}\n\t};\n}\n"]}