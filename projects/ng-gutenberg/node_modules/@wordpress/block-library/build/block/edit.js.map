{"version":3,"sources":["@wordpress/block-library/src/block/edit.js"],"names":["ReusableBlockEdit","reusableBlock","arguments","startEditing","bind","stopEditing","setBlocks","setTitle","save","state","isEditing","isTemporary","title","blocks","content","props","fetchReusableBlock","prevProps","setState","onChange","onSave","isSelected","isFetching","isSaving","canUpdateBlock","settings","element","Component","select","ownProps","getReusableBlock","__experimentalGetReusableBlock","isFetchingReusableBlock","__experimentalIsFetchingReusableBlock","isSavingReusableBlock","__experimentalIsSavingReusableBlock","canUser","__experimentalGetParsedReusableBlock","getSettings","ref","attributes","id","dispatch","fetchReusableBlocks","__experimentalFetchReusableBlocks","updateReusableBlock","__experimentalUpdateReusableBlock","saveReusableBlock","__experimentalSaveReusableBlock"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { partial } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { Placeholder, Spinner, Disabled } from '@wordpress/components';\nimport {\n\twithSelect,\n\twithDispatch,\n} from '@wordpress/data';\nimport { __ } from '@wordpress/i18n';\nimport {\n\tBlockEditorProvider,\n\tBlockList,\n\tWritingFlow,\n} from '@wordpress/block-editor';\nimport { compose } from '@wordpress/compose';\nimport { parse, serialize } from '@wordpress/blocks';\n\n/**\n * Internal dependencies\n */\nimport ReusableBlockEditPanel from './edit-panel';\nimport ReusableBlockIndicator from './indicator';\n\nclass ReusableBlockEdit extends Component {\n\tconstructor( { reusableBlock } ) {\n\t\tsuper( ...arguments );\n\n\t\tthis.startEditing = this.startEditing.bind( this );\n\t\tthis.stopEditing = this.stopEditing.bind( this );\n\t\tthis.setBlocks = this.setBlocks.bind( this );\n\t\tthis.setTitle = this.setTitle.bind( this );\n\t\tthis.save = this.save.bind( this );\n\n\t\tif ( reusableBlock ) {\n\t\t\t// Start in edit mode when we're working with a newly created reusable block\n\t\t\tthis.state = {\n\t\t\t\tisEditing: reusableBlock.isTemporary,\n\t\t\t\ttitle: reusableBlock.title,\n\t\t\t\tblocks: parse( reusableBlock.content ),\n\t\t\t};\n\t\t} else {\n\t\t\t// Start in preview mode when we're working with an existing reusable block\n\t\t\tthis.state = {\n\t\t\t\tisEditing: false,\n\t\t\t\ttitle: null,\n\t\t\t\tblocks: [],\n\t\t\t};\n\t\t}\n\t}\n\n\tcomponentDidMount() {\n\t\tif ( ! this.props.reusableBlock ) {\n\t\t\tthis.props.fetchReusableBlock();\n\t\t}\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tif ( prevProps.reusableBlock !== this.props.reusableBlock && this.state.title === null ) {\n\t\t\tthis.setState( {\n\t\t\t\ttitle: this.props.reusableBlock.title,\n\t\t\t\tblocks: parse( this.props.reusableBlock.content ),\n\t\t\t} );\n\t\t}\n\t}\n\n\tstartEditing() {\n\t\tconst { reusableBlock } = this.props;\n\t\tthis.setState( {\n\t\t\tisEditing: true,\n\t\t\ttitle: reusableBlock.title,\n\t\t\tblocks: parse( reusableBlock.content ),\n\t\t} );\n\t}\n\n\tstopEditing() {\n\t\tthis.setState( {\n\t\t\tisEditing: false,\n\t\t\ttitle: null,\n\t\t\tblocks: [],\n\t\t} );\n\t}\n\n\tsetBlocks( blocks ) {\n\t\tthis.setState( { blocks } );\n\t}\n\n\tsetTitle( title ) {\n\t\tthis.setState( { title } );\n\t}\n\n\tsave() {\n\t\tconst { onChange, onSave } = this.props;\n\t\tconst { blocks, title } = this.state;\n\t\tconst content = serialize( blocks );\n\t\tonChange( { title, content } );\n\t\tonSave();\n\n\t\tthis.stopEditing();\n\t}\n\n\trender() {\n\t\tconst { isSelected, reusableBlock, isFetching, isSaving, canUpdateBlock, settings } = this.props;\n\t\tconst { isEditing, title, blocks } = this.state;\n\n\t\tif ( ! reusableBlock && isFetching ) {\n\t\t\treturn <Placeholder><Spinner /></Placeholder>;\n\t\t}\n\n\t\tif ( ! reusableBlock ) {\n\t\t\treturn <Placeholder>{ __( 'Block has been deleted or is unavailable.' ) }</Placeholder>;\n\t\t}\n\n\t\tlet element = (\n\t\t\t<BlockEditorProvider\n\t\t\t\tsettings={ settings }\n\t\t\t\tvalue={ blocks }\n\t\t\t\tonChange={ this.setBlocks }\n\t\t\t\tonInput={ this.setBlocks }\n\t\t\t>\n\t\t\t\t<WritingFlow>\n\t\t\t\t\t<BlockList />\n\t\t\t\t</WritingFlow>\n\t\t\t</BlockEditorProvider>\n\t\t);\n\n\t\tif ( ! isEditing ) {\n\t\t\telement = <Disabled>{ element }</Disabled>;\n\t\t}\n\n\t\treturn (\n\t\t\t<div className=\"block-library-block__reusable-block-container\">\n\t\t\t\t{ ( isSelected || isEditing ) && (\n\t\t\t\t\t<ReusableBlockEditPanel\n\t\t\t\t\t\tisEditing={ isEditing }\n\t\t\t\t\t\ttitle={ title !== null ? title : reusableBlock.title }\n\t\t\t\t\t\tisSaving={ isSaving && ! reusableBlock.isTemporary }\n\t\t\t\t\t\tisEditDisabled={ ! canUpdateBlock }\n\t\t\t\t\t\tonEdit={ this.startEditing }\n\t\t\t\t\t\tonChangeTitle={ this.setTitle }\n\t\t\t\t\t\tonSave={ this.save }\n\t\t\t\t\t\tonCancel={ this.stopEditing }\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t\t{ ! isSelected && ! isEditing && <ReusableBlockIndicator title={ reusableBlock.title } /> }\n\t\t\t\t{ element }\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select, ownProps ) => {\n\t\tconst {\n\t\t\t__experimentalGetReusableBlock: getReusableBlock,\n\t\t\t__experimentalIsFetchingReusableBlock: isFetchingReusableBlock,\n\t\t\t__experimentalIsSavingReusableBlock: isSavingReusableBlock,\n\t\t} = select( 'core/editor' );\n\t\tconst { canUser } = select( 'core' );\n\t\tconst {\n\t\t\t__experimentalGetParsedReusableBlock,\n\t\t\tgetSettings,\n\t\t} = select( 'core/block-editor' );\n\t\tconst { ref } = ownProps.attributes;\n\t\tconst reusableBlock = getReusableBlock( ref );\n\n\t\treturn {\n\t\t\treusableBlock,\n\t\t\tisFetching: isFetchingReusableBlock( ref ),\n\t\t\tisSaving: isSavingReusableBlock( ref ),\n\t\t\tblocks: reusableBlock ? __experimentalGetParsedReusableBlock( reusableBlock.id ) : null,\n\t\t\tcanUpdateBlock: !! reusableBlock && ! reusableBlock.isTemporary && !! canUser( 'update', 'blocks', ref ),\n\t\t\tsettings: getSettings(),\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch, ownProps ) => {\n\t\tconst {\n\t\t\t__experimentalFetchReusableBlocks: fetchReusableBlocks,\n\t\t\t__experimentalUpdateReusableBlock: updateReusableBlock,\n\t\t\t__experimentalSaveReusableBlock: saveReusableBlock,\n\t\t} = dispatch( 'core/editor' );\n\t\tconst { ref } = ownProps.attributes;\n\n\t\treturn {\n\t\t\tfetchReusableBlock: partial( fetchReusableBlocks, ref ),\n\t\t\tonChange: partial( updateReusableBlock, ref ),\n\t\t\tonSave: partial( saveReusableBlock, ref ),\n\t\t};\n\t} ),\n] )( ReusableBlockEdit );\n"]}