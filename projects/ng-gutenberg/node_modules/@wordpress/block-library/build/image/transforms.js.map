{"version":3,"sources":["@wordpress/block-library/src/image/transforms.js"],"names":["stripFirstImage","attributes","shortcode","document","implementation","createHTMLDocument","body","innerHTML","content","nodeToRemove","querySelector","parentNode","removeChild","trim","getFirstAnchorAttributeFormHTML","html","attributeName","firstElementChild","nodeName","getAttribute","undefined","imageSchema","img","classes","schema","figure","require","children","a","figcaption","transforms","from","type","isMatch","node","transform","className","alignMatches","exec","align","idMatches","id","Number","anchorElement","linkDestination","href","rel","linkClass","outerHTML","files","length","indexOf","file","url","tag","source","attribute","selector","alt","caption","named","parseInt","replace"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { createBlobURL } from '@wordpress/blob';\nimport {\n\tcreateBlock,\n\tgetBlockAttributes,\n\tgetPhrasingContentSchema,\n} from '@wordpress/blocks';\n\nexport function stripFirstImage( attributes, { shortcode } ) {\n\tconst { body } = document.implementation.createHTMLDocument( '' );\n\n\tbody.innerHTML = shortcode.content;\n\n\tlet nodeToRemove = body.querySelector( 'img' );\n\n\t// if an image has parents, find the topmost node to remove\n\twhile ( nodeToRemove && nodeToRemove.parentNode && nodeToRemove.parentNode !== body ) {\n\t\tnodeToRemove = nodeToRemove.parentNode;\n\t}\n\n\tif ( nodeToRemove ) {\n\t\tnodeToRemove.parentNode.removeChild( nodeToRemove );\n\t}\n\n\treturn body.innerHTML.trim();\n}\n\nfunction getFirstAnchorAttributeFormHTML( html, attributeName ) {\n\tconst { body } = document.implementation.createHTMLDocument( '' );\n\n\tbody.innerHTML = html;\n\n\tconst { firstElementChild } = body;\n\n\tif (\n\t\tfirstElementChild &&\n\t\tfirstElementChild.nodeName === 'A'\n\t) {\n\t\treturn firstElementChild.getAttribute( attributeName ) || undefined;\n\t}\n}\n\nconst imageSchema = {\n\timg: {\n\t\tattributes: [ 'src', 'alt' ],\n\t\tclasses: [ 'alignleft', 'aligncenter', 'alignright', 'alignnone', /^wp-image-\\d+$/ ],\n\t},\n};\n\nconst schema = {\n\tfigure: {\n\t\trequire: [ 'img' ],\n\t\tchildren: {\n\t\t\t...imageSchema,\n\t\t\ta: {\n\t\t\t\tattributes: [ 'href', 'rel', 'target' ],\n\t\t\t\tchildren: imageSchema,\n\t\t\t},\n\t\t\tfigcaption: {\n\t\t\t\tchildren: getPhrasingContentSchema(),\n\t\t\t},\n\t\t},\n\t},\n};\n\nconst transforms = {\n\tfrom: [\n\t\t{\n\t\t\ttype: 'raw',\n\t\t\tisMatch: ( node ) => node.nodeName === 'FIGURE' && !! node.querySelector( 'img' ),\n\t\t\tschema,\n\t\t\ttransform: ( node ) => {\n\t\t\t\t// Search both figure and image classes. Alignment could be\n\t\t\t\t// set on either. ID is set on the image.\n\t\t\t\tconst className = node.className + ' ' + node.querySelector( 'img' ).className;\n\t\t\t\tconst alignMatches = /(?:^|\\s)align(left|center|right)(?:$|\\s)/.exec( className );\n\t\t\t\tconst align = alignMatches ? alignMatches[ 1 ] : undefined;\n\t\t\t\tconst idMatches = /(?:^|\\s)wp-image-(\\d+)(?:$|\\s)/.exec( className );\n\t\t\t\tconst id = idMatches ? Number( idMatches[ 1 ] ) : undefined;\n\t\t\t\tconst anchorElement = node.querySelector( 'a' );\n\t\t\t\tconst linkDestination = anchorElement && anchorElement.href ? 'custom' : undefined;\n\t\t\t\tconst href = anchorElement && anchorElement.href ? anchorElement.href : undefined;\n\t\t\t\tconst rel = anchorElement && anchorElement.rel ? anchorElement.rel : undefined;\n\t\t\t\tconst linkClass = anchorElement && anchorElement.className ? anchorElement.className : undefined;\n\t\t\t\tconst attributes = getBlockAttributes( 'core/image', node.outerHTML, { align, id, linkDestination, href, rel, linkClass } );\n\t\t\t\treturn createBlock( 'core/image', attributes );\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\ttype: 'files',\n\t\t\tisMatch( files ) {\n\t\t\t\treturn files.length === 1 && files[ 0 ].type.indexOf( 'image/' ) === 0;\n\t\t\t},\n\t\t\ttransform( files ) {\n\t\t\t\tconst file = files[ 0 ];\n\t\t\t\t// We don't need to upload the media directly here\n\t\t\t\t// It's already done as part of the `componentDidMount`\n\t\t\t\t// int the image block\n\t\t\t\treturn createBlock( 'core/image', {\n\t\t\t\t\turl: createBlobURL( file ),\n\t\t\t\t} );\n\t\t\t},\n\t\t},\n\t\t{\n\t\t\ttype: 'shortcode',\n\t\t\ttag: 'caption',\n\t\t\tattributes: {\n\t\t\t\turl: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tsource: 'attribute',\n\t\t\t\t\tattribute: 'src',\n\t\t\t\t\tselector: 'img',\n\t\t\t\t},\n\t\t\t\talt: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tsource: 'attribute',\n\t\t\t\t\tattribute: 'alt',\n\t\t\t\t\tselector: 'img',\n\t\t\t\t},\n\t\t\t\tcaption: {\n\t\t\t\t\tshortcode: stripFirstImage,\n\t\t\t\t},\n\t\t\t\thref: {\n\t\t\t\t\tshortcode: ( attributes, { shortcode } ) => {\n\t\t\t\t\t\treturn getFirstAnchorAttributeFormHTML( shortcode.content, 'href' );\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\trel: {\n\t\t\t\t\tshortcode: ( attributes, { shortcode } ) => {\n\t\t\t\t\t\treturn getFirstAnchorAttributeFormHTML( shortcode.content, 'rel' );\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tlinkClass: {\n\t\t\t\t\tshortcode: ( attributes, { shortcode } ) => {\n\t\t\t\t\t\treturn getFirstAnchorAttributeFormHTML( shortcode.content, 'class' );\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tid: {\n\t\t\t\t\ttype: 'number',\n\t\t\t\t\tshortcode: ( { named: { id } } ) => {\n\t\t\t\t\t\tif ( ! id ) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn parseInt( id.replace( 'attachment_', '' ), 10 );\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\talign: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tshortcode: ( { named: { align = 'alignnone' } } ) => {\n\t\t\t\t\t\treturn align.replace( 'align', '' );\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t],\n};\n\nexport default transforms;\n"]}