{"version":3,"sources":["@wordpress/block-library/src/gallery/gallery-image.js"],"names":["GalleryImage","arguments","onSelectImage","bind","onSelectCaption","onRemoveImage","bindContainer","state","captionSelected","ref","container","setState","props","isSelected","onSelect","event","document","activeElement","BACKSPACE","DELETE","indexOf","keyCode","stopPropagation","preventDefault","onRemove","prevProps","image","url","setAttributes","source_url","alt","alt_text","id","linkTo","link","isFirstItem","isLastItem","caption","onMoveForward","onMoveBackward","ariaLabel","href","img","className","leftArrow","undefined","rightArrow","newCaption","Component","select","ownProps","getMedia"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { IconButton, Spinner } from '@wordpress/components';\nimport { __ } from '@wordpress/i18n';\nimport { BACKSPACE, DELETE } from '@wordpress/keycodes';\nimport { withSelect } from '@wordpress/data';\nimport { RichText } from '@wordpress/block-editor';\nimport { isBlobURL } from '@wordpress/blob';\n\n/**\n * Internal dependencies\n */\nimport { leftArrow, rightArrow } from './icons';\n\nclass GalleryImage extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\tthis.onSelectImage = this.onSelectImage.bind( this );\n\t\tthis.onSelectCaption = this.onSelectCaption.bind( this );\n\t\tthis.onRemoveImage = this.onRemoveImage.bind( this );\n\t\tthis.bindContainer = this.bindContainer.bind( this );\n\n\t\tthis.state = {\n\t\t\tcaptionSelected: false,\n\t\t};\n\t}\n\n\tbindContainer( ref ) {\n\t\tthis.container = ref;\n\t}\n\n\tonSelectCaption() {\n\t\tif ( ! this.state.captionSelected ) {\n\t\t\tthis.setState( {\n\t\t\t\tcaptionSelected: true,\n\t\t\t} );\n\t\t}\n\n\t\tif ( ! this.props.isSelected ) {\n\t\t\tthis.props.onSelect();\n\t\t}\n\t}\n\n\tonSelectImage() {\n\t\tif ( ! this.props.isSelected ) {\n\t\t\tthis.props.onSelect();\n\t\t}\n\n\t\tif ( this.state.captionSelected ) {\n\t\t\tthis.setState( {\n\t\t\t\tcaptionSelected: false,\n\t\t\t} );\n\t\t}\n\t}\n\n\tonRemoveImage( event ) {\n\t\tif (\n\t\t\tthis.container === document.activeElement &&\n\t\t\tthis.props.isSelected && [ BACKSPACE, DELETE ].indexOf( event.keyCode ) !== -1\n\t\t) {\n\t\t\tevent.stopPropagation();\n\t\t\tevent.preventDefault();\n\t\t\tthis.props.onRemove();\n\t\t}\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tconst { isSelected, image, url } = this.props;\n\t\tif ( image && ! url ) {\n\t\t\tthis.props.setAttributes( {\n\t\t\t\turl: image.source_url,\n\t\t\t\talt: image.alt_text,\n\t\t\t} );\n\t\t}\n\n\t\t// unselect the caption so when the user selects other image and comeback\n\t\t// the caption is not immediately selected\n\t\tif ( this.state.captionSelected && ! isSelected && prevProps.isSelected ) {\n\t\t\tthis.setState( {\n\t\t\t\tcaptionSelected: false,\n\t\t\t} );\n\t\t}\n\t}\n\n\trender() {\n\t\tconst { url, alt, id, linkTo, link, isFirstItem, isLastItem, isSelected, caption, onRemove, onMoveForward, onMoveBackward, setAttributes, 'aria-label': ariaLabel } = this.props;\n\n\t\tlet href;\n\n\t\tswitch ( linkTo ) {\n\t\t\tcase 'media':\n\t\t\t\thref = url;\n\t\t\t\tbreak;\n\t\t\tcase 'attachment':\n\t\t\t\thref = link;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tconst img = (\n\t\t\t// Disable reason: Image itself is not meant to be interactive, but should\n\t\t\t// direct image selection and unfocus caption fields.\n\t\t\t/* eslint-disable jsx-a11y/no-noninteractive-element-interactions */\n\t\t\t<>\n\t\t\t\t<img\n\t\t\t\t\tsrc={ url }\n\t\t\t\t\talt={ alt }\n\t\t\t\t\tdata-id={ id }\n\t\t\t\t\tonClick={ this.onSelectImage }\n\t\t\t\t\tonFocus={ this.onSelectImage }\n\t\t\t\t\tonKeyDown={ this.onRemoveImage }\n\t\t\t\t\ttabIndex=\"0\"\n\t\t\t\t\taria-label={ ariaLabel }\n\t\t\t\t\tref={ this.bindContainer }\n\t\t\t\t/>\n\t\t\t\t{ isBlobURL( url ) && <Spinner /> }\n\t\t\t</>\n\t\t\t/* eslint-enable jsx-a11y/no-noninteractive-element-interactions */\n\t\t);\n\n\t\tconst className = classnames( {\n\t\t\t'is-selected': isSelected,\n\t\t\t'is-transient': isBlobURL( url ),\n\t\t} );\n\n\t\treturn (\n\t\t\t<figure className={ className }>\n\t\t\t\t{ href ? <a href={ href }>{ img }</a> : img }\n\t\t\t\t<div className=\"block-library-gallery-item__move-menu\">\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ticon={ leftArrow }\n\t\t\t\t\t\tonClick={ isFirstItem ? undefined : onMoveBackward }\n\t\t\t\t\t\tclassName=\"blocks-gallery-item__move-backward\"\n\t\t\t\t\t\tlabel={ __( 'Move image backward' ) }\n\t\t\t\t\t\taria-disabled={ isFirstItem }\n\t\t\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\t\t/>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ticon={ rightArrow }\n\t\t\t\t\t\tonClick={ isLastItem ? undefined : onMoveForward }\n\t\t\t\t\t\tclassName=\"blocks-gallery-item__move-forward\"\n\t\t\t\t\t\tlabel={ __( 'Move image forward' ) }\n\t\t\t\t\t\taria-disabled={ isLastItem }\n\t\t\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"block-library-gallery-item__inline-menu\">\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\ticon=\"no-alt\"\n\t\t\t\t\t\tonClick={ onRemove }\n\t\t\t\t\t\tclassName=\"blocks-gallery-item__remove\"\n\t\t\t\t\t\tlabel={ __( 'Remove image' ) }\n\t\t\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t{ ( isSelected || caption ) && (\n\t\t\t\t\t<RichText\n\t\t\t\t\t\ttagName=\"figcaption\"\n\t\t\t\t\t\tplaceholder={ isSelected ? __( 'Write captionâ€¦' ) : null }\n\t\t\t\t\t\tvalue={ caption }\n\t\t\t\t\t\tisSelected={ this.state.captionSelected }\n\t\t\t\t\t\tonChange={ ( newCaption ) => setAttributes( { caption: newCaption } ) }\n\t\t\t\t\t\tunstableOnFocus={ this.onSelectCaption }\n\t\t\t\t\t\tinlineToolbar\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t</figure>\n\t\t);\n\t}\n}\n\nexport default withSelect( ( select, ownProps ) => {\n\tconst { getMedia } = select( 'core' );\n\tconst { id } = ownProps;\n\n\treturn {\n\t\timage: id ? getMedia( id ) : null,\n\t};\n} )( GalleryImage );\n"]}