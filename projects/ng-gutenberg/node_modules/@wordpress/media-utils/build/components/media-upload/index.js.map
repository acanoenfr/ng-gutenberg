{"version":3,"sources":["@wordpress/media-utils/src/components/media-upload/index.js"],"names":["window","wp","getFeaturedImageMediaFrame","media","view","MediaFrame","Select","extend","featuredImageToolbar","toolbar","createSelectToolbar","text","l10n","setFeaturedImage","state","options","createStates","on","states","add","controller","FeaturedImage","getGalleryDetailsMediaFrame","Post","Library","id","title","createGalleryTitle","priority","filterable","multiple","editable","library","query","type","GalleryEdit","selection","editing","menu","displaySettings","GalleryAdd","slimImageObject","img","attrSet","getAttachmentsCollection","ids","order","orderby","post__in","posts_per_page","MediaUpload","allowedTypes","gallery","unstableFeaturedImageFlow","modalClass","arguments","openModal","bind","onOpen","onSelect","onUpdate","onClose","buildAndSetGalleryFrame","frameConfig","frame","$el","addClass","buildAndSetFeatureImageFrame","initializeListeners","props","addToGallery","value","lastGalleryValue","remove","currentState","GalleryDetailsMediaFrame","attachments","model","Selection","models","toJSON","mimeType","featuredImageFrame","selections","selectedImages","get","length","map","attachment","updateCollection","forEach","more","frameContent","content","collection","toArray","trigger","mirroring","_hasMore","open","render","Component"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { castArray, defaults, pick } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\n\nconst { wp } = window;\n\nconst getFeaturedImageMediaFrame = () => {\n\treturn wp.media.view.MediaFrame.Select.extend( {\n\t\t/**\n\t\t * Enables the Set Featured Image Button.\n\t\t *\n\t\t * @param {Object} toolbar toolbar for featured image state\n\t\t * @return {void}\n\t\t */\n\t\tfeaturedImageToolbar( toolbar ) {\n\t\t\tthis.createSelectToolbar( toolbar, {\n\t\t\t\ttext: wp.media.view.l10n.setFeaturedImage,\n\t\t\t\tstate: this.options.state,\n\t\t\t} );\n\t\t},\n\n\t\t/**\n\t\t * Create the default states.\n\t\t *\n\t\t * @return {void}\n\t\t */\n\t\tcreateStates: function createStates() {\n\t\t\tthis.on( 'toolbar:create:featured-image', this.featuredImageToolbar, this );\n\t\t\tthis.states.add( [\n\t\t\t\tnew wp.media.controller.FeaturedImage(),\n\t\t\t] );\n\t\t},\n\t} );\n};\n\n// Getter for the sake of unit tests.\nconst getGalleryDetailsMediaFrame = () => {\n\t/**\n\t * Custom gallery details frame.\n\t *\n\t * @see https://github.com/xwp/wp-core-media-widgets/blob/905edbccfc2a623b73a93dac803c5335519d7837/wp-admin/js/widgets/media-gallery-widget.js\n\t * @class GalleryDetailsMediaFrame\n\t * @class\n\t */\n\treturn wp.media.view.MediaFrame.Post.extend( {\n\n\t\t/**\n\t\t * Create the default states.\n\t\t *\n\t\t * @return {void}\n\t\t */\n\t\tcreateStates: function createStates() {\n\t\t\tthis.states.add( [\n\t\t\t\tnew wp.media.controller.Library( {\n\t\t\t\t\tid: 'gallery',\n\t\t\t\t\ttitle: wp.media.view.l10n.createGalleryTitle,\n\t\t\t\t\tpriority: 40,\n\t\t\t\t\ttoolbar: 'main-gallery',\n\t\t\t\t\tfilterable: 'uploaded',\n\t\t\t\t\tmultiple: 'add',\n\t\t\t\t\teditable: false,\n\n\t\t\t\t\tlibrary: wp.media.query( defaults( {\n\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t}, this.options.library ) ),\n\t\t\t\t} ),\n\n\t\t\t\tnew wp.media.controller.GalleryEdit( {\n\t\t\t\t\tlibrary: this.options.selection,\n\t\t\t\t\tediting: this.options.editing,\n\t\t\t\t\tmenu: 'gallery',\n\t\t\t\t\tdisplaySettings: false,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t} ),\n\n\t\t\t\tnew wp.media.controller.GalleryAdd(),\n\t\t\t] );\n\t\t},\n\t} );\n};\n\n// the media library image object contains numerous attributes\n// we only need this set to display the image in the library\nconst slimImageObject = ( img ) => {\n\tconst attrSet = [ 'sizes', 'mime', 'type', 'subtype', 'id', 'url', 'alt', 'link', 'caption' ];\n\treturn pick( img, attrSet );\n};\n\nconst getAttachmentsCollection = ( ids ) => {\n\treturn wp.media.query( {\n\t\torder: 'ASC',\n\t\torderby: 'post__in',\n\t\tpost__in: ids,\n\t\tposts_per_page: -1,\n\t\tquery: true,\n\t\ttype: 'image',\n\t} );\n};\n\nclass MediaUpload extends Component {\n\tconstructor( {\n\t\tallowedTypes,\n\t\tgallery = false,\n\t\tunstableFeaturedImageFlow = false,\n\t\tmodalClass,\n\t\tmultiple = false,\n\t\ttitle = __( 'Select or Upload Media' ),\n\t} ) {\n\t\tsuper( ...arguments );\n\t\tthis.openModal = this.openModal.bind( this );\n\t\tthis.onOpen = this.onOpen.bind( this );\n\t\tthis.onSelect = this.onSelect.bind( this );\n\t\tthis.onUpdate = this.onUpdate.bind( this );\n\t\tthis.onClose = this.onClose.bind( this );\n\n\t\tif ( gallery ) {\n\t\t\tthis.buildAndSetGalleryFrame();\n\t\t} else {\n\t\t\tconst frameConfig = {\n\t\t\t\ttitle,\n\t\t\t\tmultiple,\n\t\t\t};\n\t\t\tif ( !! allowedTypes ) {\n\t\t\t\tframeConfig.library = { type: allowedTypes };\n\t\t\t}\n\n\t\t\tthis.frame = wp.media( frameConfig );\n\t\t}\n\n\t\tif ( modalClass ) {\n\t\t\tthis.frame.$el.addClass( modalClass );\n\t\t}\n\n\t\tif ( unstableFeaturedImageFlow ) {\n\t\t\tthis.buildAndSetFeatureImageFrame();\n\t\t}\n\n\t\tthis.initializeListeners();\n\t}\n\n\tinitializeListeners() {\n\t\t// When an image is selected in the media frame...\n\t\tthis.frame.on( 'select', this.onSelect );\n\t\tthis.frame.on( 'update', this.onUpdate );\n\t\tthis.frame.on( 'open', this.onOpen );\n\t\tthis.frame.on( 'close', this.onClose );\n\t}\n\n\tbuildAndSetGalleryFrame() {\n\t\tconst {\n\t\t\taddToGallery = false,\n\t\t\tallowedTypes,\n\t\t\tmultiple = false,\n\t\t\tvalue = null,\n\t\t} = this.props;\n\t\t// If the value did not changed there is no need to rebuild the frame,\n\t\t// we can continue to use the existing one.\n\t\tif ( value === this.lastGalleryValue ) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.lastGalleryValue = value;\n\n\t\t// If a frame already existed remove it.\n\t\tif ( this.frame ) {\n\t\t\tthis.frame.remove();\n\t\t}\n\t\tlet currentState;\n\t\tif ( addToGallery ) {\n\t\t\tcurrentState = 'gallery-library';\n\t\t} else {\n\t\t\tcurrentState = value ? 'gallery-edit' : 'gallery';\n\t\t}\n\t\tif ( ! this.GalleryDetailsMediaFrame ) {\n\t\t\tthis.GalleryDetailsMediaFrame = getGalleryDetailsMediaFrame();\n\t\t}\n\n\t\tconst attachments = getAttachmentsCollection( value );\n\t\tconst selection = new wp.media.model.Selection( attachments.models, {\n\t\t\tprops: attachments.props.toJSON(),\n\t\t\tmultiple,\n\t\t} );\n\t\tthis.frame = new this.GalleryDetailsMediaFrame( {\n\t\t\tmimeType: allowedTypes,\n\t\t\tstate: currentState,\n\t\t\tmultiple,\n\t\t\tselection,\n\t\t\tediting: ( value ) ? true : false,\n\t\t} );\n\t\twp.media.frame = this.frame;\n\t\tthis.initializeListeners();\n\t}\n\n\tbuildAndSetFeatureImageFrame() {\n\t\tconst featuredImageFrame = getFeaturedImageMediaFrame();\n\t\tconst attachments = getAttachmentsCollection( this.props.value );\n\t\tconst selection = new wp.media.model.Selection( attachments.models, {\n\t\t\tprops: attachments.props.toJSON(),\n\t\t} );\n\t\tthis.frame = new featuredImageFrame( {\n\t\t\tmimeType: this.props.allowedTypes,\n\t\t\tstate: 'featured-image',\n\t\t\tmultiple: this.props.multiple,\n\t\t\tselection,\n\t\t\tediting: ( this.props.value ) ? true : false,\n\t\t} );\n\t\twp.media.frame = this.frame;\n\t}\n\n\tcomponentWillUnmount() {\n\t\tthis.frame.remove();\n\t}\n\n\tonUpdate( selections ) {\n\t\tconst { onSelect, multiple = false } = this.props;\n\t\tconst state = this.frame.state();\n\t\tconst selectedImages = selections || state.get( 'selection' );\n\n\t\tif ( ! selectedImages || ! selectedImages.models.length ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( multiple ) {\n\t\t\tonSelect( selectedImages.models.map( ( model ) => slimImageObject( model.toJSON() ) ) );\n\t\t} else {\n\t\t\tonSelect( slimImageObject( ( selectedImages.models[ 0 ].toJSON() ) ) );\n\t\t}\n\t}\n\n\tonSelect() {\n\t\tconst { onSelect, multiple = false } = this.props;\n\t\t// Get media attachment details from the frame state\n\t\tconst attachment = this.frame.state().get( 'selection' ).toJSON();\n\t\tonSelect(\n\t\t\tmultiple ?\n\t\t\t\tattachment :\n\t\t\t\tattachment[ 0 ]\n\t\t);\n\t}\n\n\tonOpen() {\n\t\tthis.updateCollection();\n\n\t\tif ( ! this.props.value ) {\n\t\t\treturn;\n\t\t}\n\t\tif ( ! this.props.gallery ) {\n\t\t\tconst selection = this.frame.state().get( 'selection' );\n\t\t\tcastArray( this.props.value ).forEach( ( id ) => {\n\t\t\t\tselection.add( wp.media.attachment( id ) );\n\t\t\t} );\n\t\t}\n\n\t\t// load the images so they are available in the media modal.\n\t\tgetAttachmentsCollection( castArray( this.props.value ) ).more();\n\t}\n\n\tonClose() {\n\t\tconst { onClose } = this.props;\n\n\t\tif ( onClose ) {\n\t\t\tonClose();\n\t\t}\n\t}\n\n\tupdateCollection() {\n\t\tconst frameContent = this.frame.content.get();\n\t\tif ( frameContent && frameContent.collection ) {\n\t\t\tconst collection = frameContent.collection;\n\n\t\t\t// clean all attachments we have in memory.\n\t\t\tcollection.toArray().forEach( ( model ) => model.trigger( 'destroy', model ) );\n\n\t\t\t// reset has more flag, if library had small amount of items all items may have been loaded before.\n\t\t\tcollection.mirroring._hasMore = true;\n\n\t\t\t// request items\n\t\t\tcollection.more();\n\t\t}\n\t}\n\n\topenModal() {\n\t\tif (\n\t\t\tthis.props.gallery &&\n\t\t\tthis.props.value &&\n\t\t\tthis.props.value.length > 0\n\t\t) {\n\t\t\tthis.buildAndSetGalleryFrame();\n\t\t}\n\t\tthis.frame.open();\n\t}\n\n\trender() {\n\t\treturn this.props.render( { open: this.openModal } );\n\t}\n}\n\nexport default MediaUpload;\n\n"]}